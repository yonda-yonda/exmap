"use strict";(self.webpackChunkexmap=self.webpackChunkexmap||[]).push([[447],{41603:function(e,t,n){n.r(t),n.d(t,{default:function(){return $}});var a=n(15861),r=n(93433),i=n(87757),l=n.n(i),o=n(67294),c=n(2055),m=n(8177),u=n(10532),s=n(49308),d=n(85616),p=n(94382),E=n(4320),g=n(10026),f=n(76968),h=n(13827),v=n(14439),x=n(91570),Z=n(64682),b=n(32990),y=n(34649),w=n(41939),M=n(38737),S=n(54101),R=n(97391),_=n(45505),k=n(51842),L=n(96534),C=n(18559),j=n(97326),I=n(94578),O=n(77059),P=n(28971),z=n(50832),D=n(85338),q=n(27053);function F(e,t){var n=[(e[2]-e[0])/2+e[0],(e[3]-e[1])/2+e[1]],a=[(e[0]-n[0])*Math.cos(t)-(e[3]-n[1])*Math.sin(t),(e[0]-n[0])*Math.sin(t)+(e[3]-n[1])*Math.cos(t)],r=[(e[0]-n[0])*Math.cos(t)-(e[1]-n[1])*Math.sin(t),(e[0]-n[0])*Math.sin(t)+(e[1]-n[1])*Math.cos(t)],i=[(e[2]-n[0])*Math.cos(t)-(e[1]-n[1])*Math.sin(t),(e[2]-n[0])*Math.sin(t)+(e[1]-n[1])*Math.cos(t)],l=[(e[2]-n[0])*Math.cos(t)-(e[3]-n[1])*Math.sin(t),(e[2]-n[0])*Math.sin(t)+(e[3]-n[1])*Math.cos(t)];return[Math.min(a[0],r[0],i[0],l[0])+n[0],Math.min(a[1],r[1],i[1],l[1])+n[1],Math.max(a[0],r[0],i[0],l[0])+n[0],Math.max(a[1],r[1],i[1],l[1])+n[1]]}function G(e,t,n,a){for(var r=void 0!==t?t:P.e,i=(0,z.Cr)(e),l=(0,z.dz)(e),o=(0,D.Pq)(void 0!==n?n:P.S),c=a&&a>0?a:Math.max(l/o[0],i/o[1]),m=r+1,u=new Array(m),s=0;s<m;++s)u[s]=c/Math.pow(2,s+1);return u}var A=function(e){function t(t){var n,a=t||{},r=a.tileSize?a.tileSize:P.S,i=[-180,-90,180,90],l=new q.Z({extent:i,tileSize:r,minZoom:t.minZoom,resolutions:G(i,t.maxZoom,r,360/r)}),o=void 0===a.imageSmoothing||a.imageSmoothing;if(void 0!==a.interpolate&&(o=a.interpolate),n=e.call(this,{state:M.Z.LOADING,attributions:a.attributions,cacheSize:a.cacheSize,crossOrigin:a.crossOrigin,interpolate:o,opaque:a.opaque,projection:"EPSG:4326",reprojectionErrorThreshold:a.reprojectionErrorThreshold,tileGrid:l,tileLoadFunction:function(e,t){var a=t.split(",").map(Number),i=a[0],l=a[1],o=a[2],c=document.createElement("canvas");c.width=r,c.height=r;var m=c.getContext("2d");if(m&&n.context_){var u,s,d=function(e,t,n){var a=180/Math.pow(2,e);return[t*a-180,90-n*a,a]}(i,l,o),p=d[0],E=d[1],g=d[2],f=n.imageExtent_,h=f[0],v=f[1],x=f[2],Z=f[3],b=p,y=p+g,w=E-g,M=E;h<-180&&0<y?(b-=360,y-=360):180<x&&b<0&&(b+=360,y+=360),u=[h,v,x,Z],s=[b,w,y,M],Math.max(u[0],s[0])<=Math.min(u[2],s[2])&&Math.max(u[1],s[1])<=Math.min(u[3],s[3])||e.setState(O.Z.EMPTY);var S=[(x-h)/n.context_.canvas.width,(Z-v)/n.context_.canvas.height],R=[(y-b)/r,(M-w)/r],_=[Math.max(b,h),Math.max(v,w)],k=[Math.min(y,x),Math.min(Z,M)],L=[Math.round((_[0]-b)/R[0]),Math.round((M-k[1])/R[1]),Math.round((k[0]-b)/R[0]),Math.round((M-_[1])/R[1])],C=[Math.round((_[0]-h)/S[0]),Math.round((Z-k[1])/S[1]),Math.round((k[0]-h)/S[0]),Math.round((Z-_[1])/S[1])],j=[C[2]-C[0],C[3]-C[1]],I=[L[2]-L[0],L[3]-L[1]];if(Math.min.apply(Math,j.concat(I))<=0)e.setState(O.Z.EMPTY);else{var P=document.createElement("canvas");P.width=j[0],P.height=j[1];var z=P.getContext("2d");z&&(z.clearRect(0,0,j[0],j[1]),z.putImageData(n.context_.getImageData(C[0],C[1],j[0],j[1]),0,0),m.drawImage(P,0,0,j[0],j[1],L[0],L[1],I[0],I[1])),e.getImage().src=c.toDataURL()}}else e.setState(O.Z.ERROR)},tilePixelRatio:a.tilePixelRatio,url:"{z},{x},{y}",wrapX:void 0===a.wrapX||a.wrapX,transition:a.transition,attributionsCollapsible:a.attributionsCollapsible})||this,n.imageExtent_=[1/0,1/0,-1/0,-1/0],Array.isArray(a.imageExtent)&&a.imageExtent.length>3&&(n.imageExtent_=a.imageExtent),n.imageExtent_[0]<-360||360<n.imageExtent_[0]||n.imageExtent_[1]<-90||90<n.imageExtent_[1]||n.imageExtent_[2]<-360||360<n.imageExtent_[2]||n.imageExtent_[3]<-90||90<n.imageExtent_[3]||n.imageExtent_[2]<=n.imageExtent_[0]||n.imageExtent_[0]-n.imageExtent_[2]>360)throw new Error("invalid extent.");var c=0;a.rotate&&(c=a.rotate,n.imageExtent_=F(n.imageExtent_,c));var m=document.createElement("canvas"),u=m.getContext("2d");if(!u)return n.context_=null,(0,j.Z)(n);u.imageSmoothingEnabled=void 0===o||o,n.context_=u;var s=new Image;s.crossOrigin=a.crossOrigin||"",s.addEventListener("load",(function(){var e=F([0,0,s.width,s.height],c),t=e[2]-e[0],a=e[3]-e[1];m.width=t,m.height=a,u.save(),u.translate(t/2,a/2),u.rotate(-c),u.drawImage(s,-s.width/2,-s.height/2),u.restore(),n.setState(M.Z.READY)})),s.addEventListener("error",(function(){n.setState(M.Z.ERROR)}));try{s.src=a.url}catch(d){console.log(1111111)}return n}return(0,I.Z)(t,e),t}(n(31669).Z),N=(0,w.Z)("div")({fontSize:"12px"}),U=(0,w.Z)("div")({overflow:"hidden"}),T=(0,w.Z)(s.Z)({overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}),V=(0,w.Z)(U)({flex:"1 1 auto"}),Y=(0,w.Z)("div")({flex:"0 0 auto"}),W=(0,w.Z)("ul")({listStyle:"none",margin:0,padding:0,"& > li":{marginTop:"5px","&:firstChild":{marginTop:0}}}),Q={type:"file",files:"",url:"",extent:""},X=(0,w.Z)("div")({position:"absolute",top:0,left:0,padding:"2px 4px",fontSize:10,pointerEvents:"none"}),$=function(){var e,t,n=(0,L.e)(),i=o.useRef(null),w=o.useRef(null),j=o.useState([]),I=j[0],O=j[1],P=o.useState(null),z=P[0],D=P[1],q=o.useState(),F=q[0],G=q[1],U=(0,C.H)({defaultItems:[],mode:"topbottom",drop:function(e,t){e.index!==t.index&&O((function(n){if(t.index<0||e.index<0||e.index>n.length-1||t.index>n.length-1)return n;var a=(0,r.Z)(n),i=a[e.index];return a.splice(e.index,1),a.splice(t.index,0,i),a}))}}),$=(0,m.cI)({mode:"onSubmit",criteriaMode:"all",defaultValues:Q}),H=$.control,J=$.handleSubmit,B=$.register,K=$.reset,ee=$.watch,te=$.setValue,ne=$.formState.errors,ae=o.useCallback((function(e){O((function(t){var a=(0,r.Z)(t),i=a.findIndex((function(t){return e===t.id})),l=a[i];return l&&(l.source.revoke&&URL.revokeObjectURL(l.source.url),n.map)?(n.map.removeLayer(l.layer),a.splice(i,1),a):a}))}),[n.map]),re=U.reset;o.useEffect((function(){var e=0;I.forEach((function(t){t.layer.setZIndex(e++)})),re((0,r.Z)(I))}),[I,re]);var ie=o.useCallback(function(){var e=(0,a.Z)(l().mark((function e(t,n,a){var i,o,c,m;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:G(!0);try{i=new A({url:a.url,imageExtent:a.extent,crossOrigin:"anonymous"}),o=i.getState(),c=function(){var e=new S.Z({source:i});t.addLayer(e),O((function(t){return[].concat((0,r.Z)(t),[{id:n,layer:e,source:a,error:null}])}));var l=a.extent;if(l){var o=(0,R.$A)(l,"EPSG:4326","EPSG:3857");o[0]>o[2]&&(o[2]+=2*(0,k.default)("EPSG:4326","EPSG:3857",[180,0])[0]),t.getView().fit(o,{padding:[40,20,40,20],maxZoom:20})}},o===M.Z.READY?(c(),G(!1)):(m=function e(){var t=i.getState();t===M.Z.ERROR&&(i.removeEventListener("change",e),D("FailedLoadSource"),G(!1)),t===M.Z.READY&&(i.removeEventListener("change",e),c(),G(!1))},i.addEventListener("change",m))}catch(l){G(!1)}case 2:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),[]),le=o.useCallback((function(e){var t=e.source,a=e.id;n.map&&ie(n.map,a,t)}),[n.map,ie]);o.useEffect((function(){!1===F&&K()}),[F,K]);var oe=o.useCallback((function(e){for(var t=e.extent.split(",").map((function(e){return Number(e)})),n=0;n<t.length;n++){var a=t[n];if("number"!=typeof a||a-a!=0)return void D("InvalidExtent")}if(t[0]>t[2]||t[1]>t[3])D("ReversedExtent");else{var r="",i=null;switch(e.type){case"file":if(!(e.files instanceof FileList))break;var l=e.files[0];r+=l.name,i={url:URL.createObjectURL(l),revoke:!0,name:l.name,extent:t};break;case"url":var o=e.url;r+=o,i={url:o,revoke:!1,name:o.split("/").pop()||"",extent:t}}if(r+=t.join(","),i){if(I.findIndex((function(e){return r===e.id}))>=0)return void D("Duplicate");le({id:r,source:i})}}}),[le,I]),ce=ee(),me=o.useCallback((function(){te("type","url"),te("url","../image/rect.png"),te("extent","0,0,10,10"),D(null)}),[te,D]);return o.useEffect((function(){var e=null;return n.map&&w.current&&(e=new _.Z({coordinateFormat:function(e){return e?"lon: "+e[0].toFixed(4)+", lat: "+e[1].toFixed(4):""},projection:"EPSG:4326",className:"",target:w.current}),n.map.addControl(e)),function(){n.map&&e&&n.map.removeControl(e)}}),[n.map]),o.createElement(o.Fragment,null,o.createElement(u.ZP,null),o.createElement(c.Helmet,null,o.createElement("title",null,"Display Image"),o.createElement("meta",{name:"description",content:"Display Image on map."}),o.createElement("link",{rel:"canonical",href:"https://yonda-yonda.github.io/exmap/picture"}),o.createElement("link",{rel:"icon",type:"image/x-icon",href:"https://github.githubassets.com/favicon.ico"}),o.createElement("link",{rel:"stylesheet",href:"https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"}),o.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),o.createElement("meta",{name:"twitter:title",content:"Display Image"}),o.createElement("meta",{name:"twitter:description",content:"PNG, JPEG, SVGを表示します"}),o.createElement("meta",{property:"og:url",content:"https://yonda-yonda.github.io/exmap/picture"}),o.createElement("meta",{name:"twitter:image",content:"https://yonda-yonda.github.io/exmap/image/twitter_picture.png"})),o.createElement(d.Z,null,o.createElement(s.Z,{variant:"h2",component:"h1"},"Display Image"),o.createElement(p.Z,{my:4,spacing:4},o.createElement("div",null,o.createElement(E.ZP,{container:!0,spacing:2},o.createElement(E.ZP,{item:!0,xs:9},o.createElement("div",{style:{position:"relative"},ref:i},o.createElement("div",{ref:n.ref,style:{width:"100%",height:"340px"}}),o.createElement(X,{ref:w}))),o.createElement(E.ZP,{item:!0,xs:3},I.length>0?o.createElement(W,null,U.items.map((function(e){return o.createElement("li",Object.assign({key:e.key,ref:e.ref},e.trigger),o.createElement(p.Z,{direction:"row",spacing:1,justifyContent:"space-between",alignItems:"center"},o.createElement(V,null,o.createElement(g.Z,{title:o.createElement(s.Z,Object.assign({variant:"caption",display:"block"},e.propagation),e.value.source.name),arrow:!0,placement:"left"},o.createElement(T,{variant:"body2"},e.value.source.name))),o.createElement(Y,e.propagation,o.createElement(f.Z,{size:"small",variant:"outlined",onClick:function(){ae(e.value.id)}},"REMOVE"))))}))):o.createElement(s.Z,null,"Nothing to display.")))),o.createElement("div",null,o.createElement("form",{onSubmit:J(oe)},o.createElement(p.Z,{spacing:2},o.createElement("div",null,o.createElement(f.Z,{variant:"outlined",onClick:me,size:"small"},"sample")),o.createElement(m.Qr,{control:H,name:"type",render:function(e){var t=e.field;return o.createElement(h.Z,{fullWidth:!0},o.createElement(v.Z,Object.assign({row:!0},t),o.createElement(x.Z,{value:"file",control:o.createElement(Z.Z,{size:"small"}),label:"Local File"}),o.createElement(x.Z,{value:"url",control:o.createElement(Z.Z,{size:"small"}),label:"URL"})))}}),"file"===ce.type&&o.createElement(h.Z,{component:"fieldset",error:!(null==ne||!ne.files),fullWidth:!0},o.createElement("input",Object.assign({},B("files",{required:!0,validate:{length:function(e){return e instanceof FileList&&1===e.length}}}),{disabled:F,accept:".webp,.png,.jpeg,.jpg,.gif,image/webp,image/png,image/jpeg,image/svg+xml,image/gif",type:"file"})),"required"===(null==ne||null===(e=ne.files)||void 0===e?void 0:e.type)&&o.createElement(b.Z,null,"Required. ",o.createElement("br",null),"ファイルを選択してください。"),"length"===(null==ne||null===(t=ne.files)||void 0===t?void 0:t.type)&&o.createElement(b.Z,null,"Required. ",o.createElement("br",null),"ファイルを1つ選択してください。")),"url"===ce.type&&o.createElement(m.Qr,{control:H,name:"url",render:function(e){var t=e.field,n=e.fieldState,a=n.invalid,r=n.error;return o.createElement(h.Z,{component:"fieldset",error:a,fullWidth:!0},o.createElement(y.Z,Object.assign({},t,{label:"url",size:"small",error:a,placeholder:"https://",disabled:F})),"required"===(null==r?void 0:r.type)&&o.createElement(b.Z,null,"Required. ",o.createElement("br",null),"必須です。入力してください。"),"pattern"===(null==r?void 0:r.type)&&o.createElement(b.Z,null,"Not matched URL pattern.",o.createElement("br",null),"URLの形式が正しくありません。"))},rules:{required:!0,pattern:/(^(https?):\/\/[^ "]+$|(^\.+\/))/}}),o.createElement(N,null,"support: .webp, .png, .jpeg, .jpg, .gif"),o.createElement(p.Z,{direction:"row",spacing:4,sx:{mt:2,mb:1}},o.createElement(m.Qr,{control:H,name:"extent",render:function(e){var t=e.field,n=e.fieldState,a=n.invalid,r=n.error;return o.createElement(h.Z,{component:"fieldset",error:a,fullWidth:!0},o.createElement(y.Z,Object.assign({},t,{label:"Extent",size:"small",error:a,placeholder:"left laongitude, bottom latitude, right longitude, top latitude"})),"required"===(null==r?void 0:r.type)&&o.createElement(b.Z,null,"Required. ",o.createElement("br",null),"必須です。入力してください。"),"pattern"===(null==r?void 0:r.type)&&o.createElement(b.Z,null,"Must be left bottom and right top coordinates separated by commas.",o.createElement("br",null),"カンマ区切りで左下経度,左下緯度,右上経度,右上緯度を入力してください。"))},rules:{required:!0,pattern:/^(\+|-|\.|\d|e|E|,|\s)*$/}}))),o.createElement(h.Z,{error:!!z,sx:{mt:3}},o.createElement("div",null,o.createElement(f.Z,{variant:"contained",type:"submit",disabled:F,onClick:function(){D(null)}},"Add Layer")),"Duplicate"===z&&o.createElement(b.Z,{sx:{ml:0}},"Duplicate Layer. ",o.createElement("br",null),"すでに同じレイヤーが存在します。"),"InvalidExtent"===z&&o.createElement(b.Z,{sx:{ml:0}},"Extent includes Non-numbers. ",o.createElement("br",null),"Extentに数字以外の値が入力されています。"),"ReversedExtent"===z&&o.createElement(b.Z,{sx:{ml:0}},"Some values of Extent are reversed. ",o.createElement("br",null),"Extentに大小が逆の値が含まれています。"),"FailedLoadSource"===z&&o.createElement(b.Z,{sx:{ml:0}},"Failed to load source. ",o.createElement("br",null),"ファイルの読み込みに失敗しました。")))))))}}}]);
//# sourceMappingURL=component---src-pages-picture-index-tsx-21a3a19bad6e68c835af.js.map