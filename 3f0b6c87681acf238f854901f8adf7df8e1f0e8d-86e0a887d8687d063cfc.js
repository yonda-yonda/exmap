"use strict";(self.webpackChunkexmap=self.webpackChunkexmap||[]).push([[804],{1485:function(e,t,r){r.d(t,{Z:function(){return it}});var n=r(15370),o=r(3286),i=r(4591),a=r(38737),s=r(76785),u=r(77059),l=r(31690),f=r(50008),c=r(47037),h=r(19413),p=r(42991),g=34962,_=34963,d=35044,T=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function v(e,t){for(var r=(0,p.f0)({preserveDrawingBuffer:!0},t),n=T.length,o=0;o<n;++o)try{var i=e.getContext(T[o],r);if(i)return i}catch(a){}return null}var m=r(34093),E=d,y=function(){function e(e,t){this.array=null,this.type=e,(0,m.h)(e===g||e===_,62),this.usage=void 0!==t?t:E}return e.prototype.ofSize=function(e){this.array=new(x(this.type))(e)},e.prototype.fromArray=function(e){var t=x(this.type);this.array=t.from?t.from(e):new t(e)},e.prototype.fromArrayBuffer=function(e){this.array=new(x(this.type))(e)},e.prototype.getType=function(){return this.type},e.prototype.getArray=function(){return this.array},e.prototype.getUsage=function(){return this.usage},e.prototype.getSize=function(){return this.array?this.array.length:0},e}();function x(e){switch(e){case g:return Float32Array;case _:return Uint32Array;default:return Float32Array}}var R,b=y,S=r(85338),A=(R=function(e,t){return R=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},R(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}R(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});function L(e,t,r){var n=r?e.LINEAR:e.NEAREST;e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,n)}function C(e,t,r,n,o,i){var a=e.getGL();L(a,t,i);var s,u,l=r.byteLength/n[1],f=1;switch(l%8==0?f=8:l%4==0?f=4:l%2==0&&(f=2),o){case 1:s=a.LUMINANCE;break;case 2:s=a.LUMINANCE_ALPHA;break;case 3:s=a.RGB;break;case 4:s=a.RGBA;break;default:throw new Error("Unsupported number of bands: "+o)}r instanceof Float32Array?(u=a.FLOAT,e.getExtension("OES_texture_float"),e.getExtension("OES_texture_float_linear")):u=a.UNSIGNED_BYTE;var c=a.getParameter(a.UNPACK_ALIGNMENT);a.pixelStorei(a.UNPACK_ALIGNMENT,f),a.texImage2D(a.TEXTURE_2D,0,s,n[0],n[1],0,s,u,r),a.pixelStorei(a.UNPACK_ALIGNMENT,c)}var w=function(e){function t(t,r,n){var o=e.call(this)||this;o.tile,o.textures=[],o.handleTileChange_=o.handleTileChange_.bind(o),o.size=(0,S.Pq)(r.getTileSize(t.tileCoord[0])),o.bandCount=NaN,o.helper_=n;var i=new b(g,d);return i.fromArray([0,1,1,1,1,0,0,0]),n.flushBufferData(i),o.coords=i,o.setTile(t),o}return A(t,e),t.prototype.setTile=function(e){e!==this.tile&&(this.tile&&this.tile.removeEventListener(f.Z.CHANGE,this.handleTileChange_),this.tile=e,this.textures.length=0,this.loaded=e.getState()===u.Z.LOADED,this.loaded?this.uploadTile_():e.addEventListener(f.Z.CHANGE,this.handleTileChange_))},t.prototype.uploadTile_=function(){var e=this.helper_,t=e.getGL(),r=this.tile;if(r instanceof c.Z||r instanceof h.Z){var n=t.createTexture();return this.textures.push(n),this.bandCount=4,void function(e,t,r,n){L(e,t,n),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,r)}(t,n,r.getImage(),r.interpolate)}var o=r.getData(),i=o instanceof Float32Array,a=this.size[0]*this.size[1],s=i?Float32Array:Uint8Array,u=s.BYTES_PER_ELEMENT,l=o.byteLength/this.size[1];this.bandCount=Math.floor(l/u/this.size[0]);var f=Math.ceil(this.bandCount/4);if(1===f){n=t.createTexture();return this.textures.push(n),void C(e,n,o,this.size,this.bandCount,r.interpolate)}for(var p=new Array(f),g=0;g<f;++g){n=t.createTexture();this.textures.push(n);var _=g<f-1?4:this.bandCount%4;p[g]=new s(a*_)}for(var d=0,T=0,v=this.size[0]*this.bandCount,m=0;m<this.size[1];++m){for(var E=0;E<v;++E){var y=o[T+E],x=Math.floor(d/this.bandCount),R=E%this.bandCount;(b=p[g=Math.floor(R/4)])[x*(_=b.length/a)+R%4]=y,++d}T+=l/u}for(g=0;g<f;++g){var b;n=this.textures[g],_=(b=p[g]).length/a;C(e,n,b,this.size,_,r.interpolate)}},t.prototype.handleTileChange_=function(){this.tile.getState()===u.Z.LOADED&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(f.Z.CHANGE))},t.prototype.disposeInternal=function(){var e=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var t=0;t<this.textures.length;++t)e.deleteTexture(this.textures[t]);this.tile.removeEventListener(f.Z.CHANGE,this.handleTileChange_)},t}(l.Z),P=r(74237),U=r(23343),G=r(26239),D="webglcontextlost",O="webglcontextrestored",N=r(35925),M=r(90399),F=function(){function e(e){this.gl_=e.webGlContext;var t=this.gl_;this.scaleRatio_=e.scaleRatio||1,this.renderTargetTexture_=t.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=t.createFramebuffer();var r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,e.vertexShader||"\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n"),t.compileShader(r);var n=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(n,e.fragmentShader||"\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n  uniform float u_opacity;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n"),t.compileShader(n),this.renderTargetProgram_=t.createProgram(),t.attachShader(this.renderTargetProgram_,r),t.attachShader(this.renderTargetProgram_,n),t.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),t.STATIC_DRAW),this.renderTargetAttribLocation_=t.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=t.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],e.uniforms&&Object.keys(e.uniforms).forEach(function(r){this.uniforms_.push({value:e.uniforms[r],location:t.getUniformLocation(this.renderTargetProgram_,r)})}.bind(this))}return e.prototype.getGL=function(){return this.gl_},e.prototype.init=function(e){var t=this.getGL(),r=[t.drawingBufferWidth*this.scaleRatio_,t.drawingBufferHeight*this.scaleRatio_];if(t.bindFramebuffer(t.FRAMEBUFFER,this.getFrameBuffer()),t.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;var n=t.RGBA,o=t.RGBA,i=t.UNSIGNED_BYTE;t.bindTexture(t.TEXTURE_2D,this.renderTargetTexture_),t.texImage2D(t.TEXTURE_2D,0,n,r[0],r[1],0,o,i,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.renderTargetTexture_,0)}},e.prototype.apply=function(e,t,r,n){var o=this.getGL(),i=e.size;if(o.bindFramebuffer(o.FRAMEBUFFER,t?t.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!t){var a=(0,M.sq)(o.canvas);if(!e.renderTargets[a]){var s=o.getContextAttributes();s&&s.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT)),e.renderTargets[a]=!0}}o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,i[0],i[1]),o.uniform1i(this.renderTargetTextureLocation_,0);var u=e.layerStatesArray[e.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,u),this.applyUniforms(e),r&&r(o,e),o.drawArrays(o.TRIANGLES,0,6),n&&n(o,e)},e.prototype.getFrameBuffer=function(){return this.frameBuffer_},e.prototype.applyUniforms=function(e){var t,r=this.getGL(),n=1;this.uniforms_.forEach((function(o){if((t="function"==typeof o.value?o.value(e):o.value)instanceof HTMLCanvasElement||t instanceof ImageData)o.texture||(o.texture=r.createTexture()),r.activeTexture(r["TEXTURE"+n]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),t instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,t.width,t.height,0,r.UNSIGNED_BYTE,new Uint8Array(t.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t),r.uniform1i(o.location,n++);else if(Array.isArray(t))switch(t.length){case 2:return void r.uniform2f(o.location,t[0],t[1]);case 3:return void r.uniform3f(o.location,t[0],t[1],t[2]);case 4:return void r.uniform4f(o.location,t[0],t[1],t[2],t[3]);default:return}else"number"==typeof t&&r.uniform1f(o.location,t)}))},e}(),B=F,I=r(27083);function X(e,t){return e[0]=t[0],e[1]=t[1],e[4]=t[2],e[5]=t[3],e[12]=t[4],e[13]=t[5],e}var z=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),Z="u_offsetScaleMatrix",j="u_offsetRotateMatrix",H="u_time",V="u_zoom",k="u_resolution",W=5121,Y=5123,K=5125,q=5126,J={};function Q(e){return"shared/"+e}var $=0;var ee=function(e){function t(t){var r,n=e.call(this)||this,o=t||{};n.boundHandleWebGLContextLost_=n.handleWebGLContextLost.bind(n),n.boundHandleWebGLContextRestored_=n.handleWebGLContextRestored.bind(n),n.canvasCacheKey_=o.canvasCacheKey?Q(o.canvasCacheKey):(r="unique/"+$,$+=1,r),n.canvas_=function(e){var t=J[e];if(!t){var r=document.createElement("canvas");r.style.position="absolute",r.style.left="0",t={users:0,canvas:r},J[e]=t}return t.users+=1,t.canvas}(n.canvasCacheKey_),n.gl_=v(n.canvas_),n.bufferCache_={},n.extensionCache_={},n.currentProgram_=null,n.canvas_.addEventListener(D,n.boundHandleWebGLContextLost_),n.canvas_.addEventListener(O,n.boundHandleWebGLContextRestored_),n.offsetRotateMatrix_=(0,I.Ue)(),n.offsetScaleMatrix_=(0,I.Ue)(),n.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.uniformLocations_={},n.attribLocations_={},n.uniforms_=[],o.uniforms&&n.setUniforms(o.uniforms);var i=n.getGL();return n.postProcessPasses_=o.postProcesses?o.postProcesses.map((function(e){return new B({webGlContext:i,scaleRatio:e.scaleRatio,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms})})):[new B({webGlContext:i})],n.shaderCompileErrors_=null,n.startTime_=Date.now(),n}return z(t,e),t.prototype.setUniforms=function(e){for(var t in this.uniforms_=[],e)this.uniforms_.push({name:t,value:e[t]});this.uniformLocations_={}},t.prototype.canvasCacheKeyMatches=function(e){return this.canvasCacheKey_===Q(e)},t.prototype.getExtension=function(e){if(e in this.extensionCache_)return this.extensionCache_[e];var t=this.gl_.getExtension(e);return this.extensionCache_[e]=t,t},t.prototype.bindBuffer=function(e){var t=this.getGL(),r=(0,M.sq)(e),n=this.bufferCache_[r];n||(n={buffer:e,webGlBuffer:t.createBuffer()},this.bufferCache_[r]=n);t.bindBuffer(e.getType(),n.webGlBuffer)},t.prototype.flushBufferData=function(e){var t=this.getGL();this.bindBuffer(e),t.bufferData(e.getType(),e.getArray(),e.getUsage())},t.prototype.deleteBuffer=function(e){var t=this.getGL(),r=(0,M.sq)(e),n=this.bufferCache_[r];n&&!t.isContextLost()&&t.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[r]},t.prototype.disposeInternal=function(){this.canvas_.removeEventListener(D,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(O,this.boundHandleWebGLContextRestored_),function(e){var t=J[e];if(t&&(t.users-=1,!(t.users>0))){var r=v(t.canvas).getExtension("WEBGL_lose_context");r&&r.loseContext(),delete J[e]}}(this.canvasCacheKey_),delete this.gl_,delete this.canvas_},t.prototype.prepareDraw=function(e,t){var r=this.getGL(),n=this.getCanvas(),o=e.size,i=e.pixelRatio;n.width=o[0]*i,n.height=o[1]*i,n.style.width=o[0]+"px",n.style.height=o[1]+"px",r.useProgram(this.currentProgram_);for(var a=this.postProcessPasses_.length-1;a>=0;a--)this.postProcessPasses_[a].init(e);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,t?r.ZERO:r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.prepareDrawToRenderTarget=function(e,t,r){var n=this.getGL(),o=t.getSize();n.bindFramebuffer(n.FRAMEBUFFER,t.getFramebuffer()),n.viewport(0,0,o[0],o[1]),n.bindTexture(n.TEXTURE_2D,t.getTexture()),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,r?n.ZERO:n.ONE_MINUS_SRC_ALPHA),n.useProgram(this.currentProgram_),this.applyFrameState(e),this.applyUniforms(e)},t.prototype.drawElements=function(e,t){var r=this.getGL();this.getExtension("OES_element_index_uint");var n=r.UNSIGNED_INT,o=t-e,i=4*e;r.drawElements(r.TRIANGLES,o,n,i)},t.prototype.finalizeDraw=function(e,t,r){for(var n=0,o=this.postProcessPasses_.length;n<o;n++)n===o-1?this.postProcessPasses_[n].apply(e,null,t,r):this.postProcessPasses_[n].apply(e,this.postProcessPasses_[n+1])},t.prototype.getCanvas=function(){return this.canvas_},t.prototype.getGL=function(){return this.gl_},t.prototype.applyFrameState=function(e){var t=e.size,r=e.viewState.rotation,n=(0,I.mc)(this.offsetScaleMatrix_);(0,I.bA)(n,2/t[0],2/t[1]);var o=(0,I.mc)(this.offsetRotateMatrix_);0!==r&&(0,I.U1)(o,-r),this.setUniformMatrixValue(Z,X(this.tmpMat4_,n)),this.setUniformMatrixValue(j,X(this.tmpMat4_,o)),this.setUniformFloatValue(H,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(V,e.viewState.zoom),this.setUniformFloatValue(k,e.viewState.resolution)},t.prototype.applyUniforms=function(e){var t,r=this.getGL(),n=0;this.uniforms_.forEach(function(o){if((t="function"==typeof o.value?o.value(e):o.value)instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof ImageData)o.texture||(o.prevValue=void 0,o.texture=r.createTexture()),r.activeTexture(r["TEXTURE"+n]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(!(t instanceof HTMLImageElement)||t.complete)&&o.prevValue!==t&&(o.prevValue=t,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,t)),r.uniform1i(this.getUniformLocation(o.name),n++);else if(Array.isArray(t)&&6===t.length)this.setUniformMatrixValue(o.name,X(this.tmpMat4_,t));else if(Array.isArray(t)&&t.length<=4)switch(t.length){case 2:return void r.uniform2f(this.getUniformLocation(o.name),t[0],t[1]);case 3:return void r.uniform3f(this.getUniformLocation(o.name),t[0],t[1],t[2]);case 4:return void r.uniform4f(this.getUniformLocation(o.name),t[0],t[1],t[2],t[3]);default:return}else"number"==typeof t&&r.uniform1f(this.getUniformLocation(o.name),t)}.bind(this))},t.prototype.useProgram=function(e){return e!=this.currentProgram_&&(this.getGL().useProgram(e),this.currentProgram_=e,this.uniformLocations_={},this.attribLocations_={},!0)},t.prototype.compileShader=function(e,t){var r=this.getGL(),n=r.createShader(t);return r.shaderSource(n,e),r.compileShader(n),n},t.prototype.getProgram=function(e,t){var r=this.getGL(),n=this.compileShader(e,r.FRAGMENT_SHADER),o=this.compileShader(t,r.VERTEX_SHADER),i=r.createProgram();if(r.attachShader(i,n),r.attachShader(i,o),r.linkProgram(i),!r.getShaderParameter(n,r.COMPILE_STATUS)){var a="Fragment shader compliation failed: "+r.getShaderInfoLog(n);throw new Error(a)}if(r.deleteShader(n),!r.getShaderParameter(o,r.COMPILE_STATUS)){a="Vertex shader compilation failed: "+r.getShaderInfoLog(o);throw new Error(a)}if(r.deleteShader(o),!r.getProgramParameter(i,r.LINK_STATUS)){a="GL program linking failed: "+r.getShaderInfoLog(o);throw new Error(a)}return i},t.prototype.getUniformLocation=function(e){return void 0===this.uniformLocations_[e]&&(this.uniformLocations_[e]=this.getGL().getUniformLocation(this.currentProgram_,e)),this.uniformLocations_[e]},t.prototype.getAttributeLocation=function(e){return void 0===this.attribLocations_[e]&&(this.attribLocations_[e]=this.getGL().getAttribLocation(this.currentProgram_,e)),this.attribLocations_[e]},t.prototype.makeProjectionTransform=function(e,t){var r=e.size,n=e.viewState.rotation,o=e.viewState.resolution,i=e.viewState.center;return(0,I.mc)(t),(0,I.qC)(t,0,0,2/(o*r[0]),2/(o*r[1]),-n,-i[0],-i[1]),t},t.prototype.setUniformFloatValue=function(e,t){this.getGL().uniform1f(this.getUniformLocation(e),t)},t.prototype.setUniformMatrixValue=function(e,t){this.getGL().uniformMatrix4fv(this.getUniformLocation(e),!1,t)},t.prototype.enableAttributeArray_=function(e,t,r,n,o){var i=this.getAttributeLocation(e);i<0||(this.getGL().enableVertexAttribArray(i),this.getGL().vertexAttribPointer(i,t,r,!1,n,o))},t.prototype.enableAttributes=function(e){for(var t=function(e){for(var t=0,r=0;r<e.length;r++){var n=e[r];t+=n.size*te(n.type)}return t}(e),r=0,n=0;n<e.length;n++){var o=e[n];this.enableAttributeArray_(o.name,o.size,o.type||5126,t,r),r+=o.size*te(o.type)}},t.prototype.handleWebGLContextLost=function(){(0,p.ZH)(this.bufferCache_),this.currentProgram_=null},t.prototype.handleWebGLContextRestored=function(){},t.prototype.createTexture=function(e,t,r){var n=this.getGL(),o=r||n.createTexture(),i=n.RGBA,a=n.RGBA,s=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,o),t?n.texImage2D(n.TEXTURE_2D,0,i,a,s,t):n.texImage2D(n.TEXTURE_2D,0,i,e[0],e[1],0,a,s,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),o},t}(N.Z);function te(e){switch(e){case W:return Uint8Array.BYTES_PER_ELEMENT;case Y:return Uint16Array.BYTES_PER_ELEMENT;case K:return Uint32Array.BYTES_PER_ELEMENT;default:return Float32Array.BYTES_PER_ELEMENT}}var re=ee,ne=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),oe=function(e){function t(t,r){var n=e.call(this,t)||this,i=r||{};return n.inversePixelTransform_=(0,I.Ue)(),n.postProcesses_=i.postProcesses,n.uniforms_=i.uniforms,n.helper,t.addChangeListener(o.Z.MAP,n.removeHelper_.bind(n)),n.dispatchPreComposeEvent=n.dispatchPreComposeEvent.bind(n),n.dispatchPostComposeEvent=n.dispatchPostComposeEvent.bind(n),n}return ne(t,e),t.prototype.dispatchPreComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(G.Z.PRECOMPOSE)){var n=new U.Z(G.Z.PRECOMPOSE,void 0,t,e);r.dispatchEvent(n)}},t.prototype.dispatchPostComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(G.Z.POSTCOMPOSE)){var n=new U.Z(G.Z.POSTCOMPOSE,void 0,t,e);r.dispatchEvent(n)}},t.prototype.reset=function(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)},t.prototype.removeHelper_=function(){this.helper&&(this.helper.dispose(),delete this.helper)},t.prototype.prepareFrame=function(e){if(this.getLayer().getSource()){for(var r=!0,n=-1,o=void 0,i=0,a=e.layerStatesArray.length;i<a;i++){var s=e.layerStatesArray[i].layer,u=s.getRenderer();if(u instanceof t){var l=s.getClassName();if((r||l!==o)&&(n+=1,r=!1),o=l,u===this)break}else r=!0}var f="map/"+e.mapId+"/group/"+n;this.helper&&this.helper.canvasCacheKeyMatches(f)||(this.helper&&this.helper.dispose(),this.helper=new re({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:f}),o&&(this.helper.getCanvas().className=o),this.afterHelperCreated())}return this.prepareFrameInternal(e)},t.prototype.afterHelperCreated=function(){},t.prototype.prepareFrameInternal=function(e){return!0},t.prototype.disposeInternal=function(){this.removeHelper_(),e.prototype.disposeInternal.call(this)},t.prototype.dispatchRenderEvent_=function(e,t,r){var n=this.getLayer();if(n.hasListener(e)){(0,I.qC)(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);var o=new U.Z(e,this.inversePixelTransform_,r,t);n.dispatchEvent(o)}},t.prototype.preRender=function(e,t){this.dispatchRenderEvent_(G.Z.PRERENDER,e,t)},t.prototype.postRender=function(e,t){this.dispatchRenderEvent_(G.Z.POSTRENDER,e,t)},t}(P.Z);var ie=oe,ae=r(79998),se=r(97391),ue=r(50832),le=r(28312),fe=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ce="u_tileTextures",he="u_tileTransform",pe="u_transitionAlpha",ge="u_depth",_e="u_texturePixelWidth",de="u_texturePixelHeight",Te="u_resolution",ve="u_zoom",me="a_textureCoord",Ee=[{name:me,size:2,type:q}],ye={};function xe(e){return 2*(1-1/(e+1))-1}function Re(e,t,r){r in e||(e[r]=[]),e[r].push(t)}function be(e,t){var r=e.layerStatesArray[e.layerIndex];r.extent&&(t=(0,ue.Ed)(t,(0,se.dY)(r.extent,e.viewState.projection)));var n=r.layer.getSource();if(!n.getWrapX()){var o=n.tileGrid.getExtent();o&&(t=(0,ue.Ed)(t,o))}return t}var Se=function(e){function t(t,r){var n=e.call(this,t,{uniforms:r.uniforms})||this;n.tileTransform_=(0,I.Ue)(),n.tempMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.tempTileRange_=new s.Z(0,0,0,0),n.tempTileCoord_=(0,ae.T9)(0,0,0),n.tempSize_=[0,0],n.program_,n.vertexShader_=r.vertexShader,n.fragmentShader_=r.fragmentShader,n.indices_=new b(_,d),n.indices_.fromArray([0,1,3,1,2,3]);var o=void 0!==r.cacheSize?r.cacheSize:512;return n.tileTextureCache_=new i.Z(o),n.paletteTextures_=r.paletteTextures||[],n}return fe(t,e),t.prototype.reset=function(t){e.prototype.reset.call(this,{uniforms:t.uniforms}),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))},t.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)},t.prototype.isDrawableTile_=function(e){var t=this.getLayer(),r=e.getState(),n=t.getUseInterimTilesOnError();return r==u.Z.LOADED||r==u.Z.EMPTY||r==u.Z.ERROR&&!n},t.prototype.prepareFrameInternal=function(e){var t=this.getLayer().getSource();return!!t&&(!(0,ue.xb)(be(e,e.extent))&&t.getState()===a.Z.READY)},t.prototype.enqueueTiles=function(e,t,r,n){var o=e.viewState,i=this.getLayer().getSource(),a=i.getTileGridForProjection(o.projection),s=this.tileTextureCache_,l=a.getTileRangeForExtentAndZ(t,r,this.tempTileRange_),f=(0,M.sq)(i);f in e.wantedTiles||(e.wantedTiles[f]={});for(var c=e.wantedTiles[f],h=a.getResolution(r),p=l.minX;p<=l.maxX;++p)for(var g=l.minY;g<=l.maxY;++g){var _=(0,ae.T9)(r,p,g,this.tempTileCoord_),d=(0,ae.km)(_),T=void 0,v=void 0;if(s.containsKey(d)&&(v=(T=s.get(d)).tile),!T||T.tile.key!==i.getKey())if(v=i.getTile(r,p,g,e.pixelRatio,o.projection),T)if(this.isDrawableTile_(v))T.setTile(v);else{var m=v.getInterimTile();T.setTile(m)}else T=new w(v,a,this.helper),s.set(d,T);Re(n,T,r);var E=v.getKey();c[E]=!0,v.getState()===u.Z.IDLE&&(e.tileQueue.isKeyQueued(E)||e.tileQueue.enqueue([v,f,a.getTileCoordCenter(_),h]))}},t.prototype.renderFrame=function(e){var t=this.helper.getGL();this.preRender(t,e);var r=e.viewState,n=this.getLayer().getSource(),o=n.getTileGridForProjection(r.projection),i=be(e,e.extent),a=o.getZForResolution(r.resolution,n.zDirection),s={};if(e.nextExtent){var u=o.getZForResolution(r.nextResolution,n.zDirection),l=be(e,e.nextExtent);this.enqueueTiles(e,l,u,s)}this.enqueueTiles(e,i,a,s);for(var f={},c=(0,M.sq)(this),h=e.time,p=!1,g=s[a],_=0,d=g.length;_<d;++_){var T=(N=(J=g[_]).tile).tileCoord;if(J.loaded){if(1===(F=N.getAlpha(c,h))){N.endTransition(c);continue}p=!0,f[B=(0,ae.km)(T)]=F}if(!this.findAltTiles_(o,T,a+1,s))for(var v=o.getMinZoom(),m=a-1;m>=v;--m){if(this.findAltTiles_(o,T,m,s))break}}this.helper.useProgram(this.program_),this.helper.prepareDraw(e,!p);for(var E=Object.keys(s).map(Number).sort(le.kK),y=r.center[0],x=r.center[1],R=0,b=E.length;R<b;++R){var A=E[R],L=o.getResolution(A),C=(0,S.Pq)(o.getTileSize(A),this.tempSize_),w=o.getOrigin(A),P=(y-w[0])/(C[0]*L),U=(w[1]-x)/(C[1]*L),G=r.resolution/L,D=xe(A),O=s[A];for(_=0,d=O.length;_<d;++_){if((J=O[_]).loaded){T=(N=J.tile).tileCoord;var N,F,B=(0,ae.km)(T),z=T[1],Z=T[2];(0,I.qC)(this.tileTransform_,0,0,2/(e.size[0]*G/C[0]),-2/(e.size[1]*G/C[1]),r.rotation,-(P-z),-(U-Z)),this.helper.setUniformMatrixValue(he,X(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(J.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Ee);for(var j=0;j<J.textures.length;){var H="TEXTURE"+j,V=ce+"["+j+"]";t.activeTexture(t[H]),t.bindTexture(t.TEXTURE_2D,J.textures[j]),t.uniform1i(this.helper.getUniformLocation(V),j),++j}for(var k=0;k<this.paletteTextures_.length;++k){var W=this.paletteTextures_[k];t.activeTexture(t["TEXTURE"+j]);var Y=W.getTexture(t);t.bindTexture(t.TEXTURE_2D,Y),t.uniform1i(this.helper.getUniformLocation(W.name),j),++j}(F=B in f?f[B]:1)<1&&(e.animate=!0),this.helper.setUniformFloatValue(pe,F),this.helper.setUniformFloatValue(ge,D),this.helper.setUniformFloatValue(_e,C[0]),this.helper.setUniformFloatValue(de,C[1]),this.helper.setUniformFloatValue(Te,r.resolution),this.helper.setUniformFloatValue(ve,r.zoom),this.helper.drawElements(0,this.indices_.getSize())}}}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);for(var K=this.helper.getCanvas(),q=this.tileTextureCache_;q.canExpireCache();){var J;(J=q.pop()).dispose()}return e.postRenderFunctions.push((function(e,t){n.expireCache(t.viewState.projection,ye)})),this.postRender(t,e),K},t.prototype.findAltTiles_=function(e,t,r,n){var o=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!o)return!1;for(var i=!0,a=this.tileTextureCache_,s=o.minX;s<=o.maxX;++s)for(var u=o.minY;u<=o.maxY;++u){var l=(0,ae.lg)(r,s,u),f=!1;if(a.containsKey(l)){var c=a.get(l);c.loaded&&(Re(n,c,r),f=!0)}f||(i=!1)}return i},t.prototype.disposeInternal=function(){var t=this.helper,r=t.getGL();t.deleteBuffer(this.indices_),delete this.indices_,r.deleteProgram(this.program_),delete this.program_;var n=this.tileTextureCache_;n.forEach((function(e){e.dispose()})),n.clear(),delete this.tileTextureCache_,e.prototype.disposeInternal.call(this)},t}(ie);Se.prototype.getLayer;var Ae=Se,Le=function(){function e(e,t){this.name=e,this.data=t,this.texture_=null}return e.prototype.getTexture=function(e){if(!this.texture_){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,this.data.length/4,1,0,e.RGBA,e.UNSIGNED_BYTE,this.data),this.texture_=t}return this.texture_},e}(),Ce=r(45482),we=r(40125),Pe=1,Ue=2,Ge=4,De=8,Oe=16,Ne=31,Me=0,Fe={};function Be(e){if("number"==typeof e)return Pe;if("boolean"==typeof e)return De;if("string"==typeof e)return(0,Ce.e1)(e)?Ge|Ue:Ue;if(!Array.isArray(e))throw new Error("Unhandled value type: "+JSON.stringify(e));var t=e;if(t.every((function(e){return"number"==typeof e})))return 3===t.length||4===t.length?Ge|Oe:Oe;if("string"!=typeof t[0])throw new Error("Expected an expression operator but received: "+JSON.stringify(t));var r=Fe[t[0]];if(void 0===r)throw new Error("Unrecognized expression operator: "+JSON.stringify(t));return r.getReturnType(t.slice(1))}function Ie(e){var t=e.toString();return-1===t.indexOf(".")?t+".0":t}function Xe(e){if(e.length<2||e.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return"vec"+e.length+"("+e.map(Ie).join(", ")+")"}function ze(e,t){return void 0===e.stringLiteralsMap[t]&&(e.stringLiteralsMap[t]=Object.keys(e.stringLiteralsMap).length),e.stringLiteralsMap[t]}function Ze(e,t,r){if(Array.isArray(t)&&"string"==typeof t[0]){var n=Fe[t[0]];if(void 0===n)throw new Error("Unrecognized expression operator: "+JSON.stringify(t));return n.toGlsl(e,t.slice(1),r)}var o=Be(t);if((o&Pe)>0)return Ie(t);if((o&De)>0)return t.toString();if((o&Ue)>0&&(void 0===r||r==Ue))return function(e,t){return Ie(ze(e,t))}(e,t.toString());if((o&Ge)>0&&(void 0===r||r==Ge))return function(e){var t=(0,Ce._2)(e).slice();return t.length<4&&t.push(1),Xe(t.map((function(e,t){return t<3?e/255:e})))}(t);if((o&Oe)>0)return Xe(t);throw new Error("Unexpected expression "+t+" (expected type "+r+")")}function je(e){if(!(Be(e)&Pe))throw new Error("A numeric value was expected, got "+JSON.stringify(e)+" instead")}function He(e){for(var t=0;t<e.length;t++)je(e[t])}function Ve(e){if(!(Be(e)&Ue))throw new Error("A string value was expected, got "+JSON.stringify(e)+" instead")}function ke(e){if(!(Be(e)&De))throw new Error("A boolean value was expected, got "+JSON.stringify(e)+" instead")}function We(e,t){if(e.length!==t)throw new Error("Exactly "+t+" arguments were expected, got "+e.length+" instead")}function Ye(e,t){if(e.length<t)throw new Error("At least "+t+" arguments were expected, got "+e.length+" instead")}function Ke(e,t){if(e.length>t)throw new Error("At most "+t+" arguments were expected, got "+e.length+" instead")}function qe(e){if(e.length%2!=0)throw new Error("An even amount of arguments was expected, got "+e+" instead")}function Je(e,t){if(r=t,(0,we.k3)(r)%1!=0)throw new Error("Could not infer only one type from the following expression: "+JSON.stringify(e));var r}function Qe(e){return"u_var_"+e}Fe.get={getReturnType:function(e){return Ne},toGlsl:function(e,t){We(t,1),Ve(t[0]);var r=t[0].toString();return-1===e.attributes.indexOf(r)&&e.attributes.push(r),(e.inFragmentShader?"v_":"a_")+r}},Fe.var={getReturnType:function(e){return Ne},toGlsl:function(e,t){We(t,1),Ve(t[0]);var r=t[0].toString();return-1===e.variables.indexOf(r)&&e.variables.push(r),Qe(r)}};Fe.palette={getReturnType:function(e){return Ge},toGlsl:function(e,t){We(t,2),je(t[0]);var r=Ze(e,t[0]),n=t[1];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");for(var o=n.length,i=new Uint8Array(4*o),a=0;a<o;a++){var s=n[a],u=void 0;if("string"==typeof s)u=(0,Ce.mL)(s);else{if(!Array.isArray(s))throw new Error("The second argument of palette must be an array of strings or colors");var l=s.length;if(4===l)u=s;else{if(3!==l)throw new Error("Expected palette color to have 3 or 4 values, got "+l);u=[s[0],s[1],s[2],1]}}var f=4*a;i[f]=u[0],i[f+1]=u[1],i[f+2]=u[2],i[f+3]=255*u[3]}e.paletteTextures||(e.paletteTextures=[]);var c="u_paletteTextures["+e.paletteTextures.length+"]",h=new Le(c,i);return e.paletteTextures.push(h),"texture2D("+c+", vec2(("+r+" + 0.5) / "+o+".0, 0.5))"}};var $e="getBandValue";function et(e){return{getReturnType:function(e){return De},toGlsl:function(t,r){We(r,2);for(var n=Ne,o=0;o<r.length;o++)n&=Be(r[o]);if(n===Me)throw new Error("All arguments should be of compatible type, got "+JSON.stringify(r)+" instead");return n&=~Ge,"("+Ze(t,r[0],n)+" "+e+" "+Ze(t,r[1],n)+")"}}}function tt(e){return{getReturnType:function(e){return De},toGlsl:function(t,r){Ye(r,2);for(var n=0;n<r.length;n++)ke(r[n]);return"("+r.map((function(e){return Ze(t,e)})).join(" "+e+" ")+")"}}}Fe.band={getReturnType:function(e){return Pe},toGlsl:function(e,t){Ye(t,1),Ke(t,3);var r=t[0];if(!($e in e.functions)){for(var n="",o=e.bandCount||1,i=0;i<o;i++){var a=Math.floor(i/4),s=i%4;s===o-1&&1===s&&(s=3),n+="\n          if (band == "+(i+1)+".0) {\n            return texture2D("+(ce+"["+a+"]")+", v_textureCoord + vec2(dx, dy))["+s+"];\n          }\n        "}e.functions.getBandValue="\n        float getBandValue(float band, float xOffset, float yOffset) {\n          float dx = xOffset / "+_e+";\n          float dy = yOffset / "+de+";\n          "+n+"\n        }\n      "}return"getBandValue("+Ze(e,r)+", "+Ze(e,t[1]||0)+", "+Ze(e,t[2]||0)+")"}},Fe.time={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,0),"u_time"}},Fe.zoom={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,0),"u_zoom"}},Fe.resolution={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,0),"u_resolution"}},Fe["*"]={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,2),He(t),"("+Ze(e,t[0])+" * "+Ze(e,t[1])+")"}},Fe["/"]={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,2),He(t),"("+Ze(e,t[0])+" / "+Ze(e,t[1])+")"}},Fe["+"]={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,2),He(t),"("+Ze(e,t[0])+" + "+Ze(e,t[1])+")"}},Fe["-"]={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,2),He(t),"("+Ze(e,t[0])+" - "+Ze(e,t[1])+")"}},Fe.clamp={getReturnType:function(e){return Pe},toGlsl:function(e,t){We(t,3),He(t);var r=Ze(e,t[1]),n=Ze(e,t[2]);return"clamp("+Ze(e,t[0])+", "+r+", "+n+")"}},Fe["%"]={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,2),He(t),"mod("+Ze(e,t[0])+", "+Ze(e,t[1])+")"}},Fe["^"]={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,2),He(t),"pow("+Ze(e,t[0])+", "+Ze(e,t[1])+")"}},Fe.abs={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,1),He(t),"abs("+Ze(e,t[0])+")"}},Fe.sin={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,1),He(t),"sin("+Ze(e,t[0])+")"}},Fe.cos={getReturnType:function(e){return Pe},toGlsl:function(e,t){return We(t,1),He(t),"cos("+Ze(e,t[0])+")"}},Fe.atan={getReturnType:function(e){return Pe},toGlsl:function(e,t){return Ye(t,1),Ke(t,2),He(t),2===t.length?"atan("+Ze(e,t[0])+", "+Ze(e,t[1])+")":"atan("+Ze(e,t[0])+")"}},Fe[">"]={getReturnType:function(e){return De},toGlsl:function(e,t){return We(t,2),He(t),"("+Ze(e,t[0])+" > "+Ze(e,t[1])+")"}},Fe[">="]={getReturnType:function(e){return De},toGlsl:function(e,t){return We(t,2),He(t),"("+Ze(e,t[0])+" >= "+Ze(e,t[1])+")"}},Fe["<"]={getReturnType:function(e){return De},toGlsl:function(e,t){return We(t,2),He(t),"("+Ze(e,t[0])+" < "+Ze(e,t[1])+")"}},Fe["<="]={getReturnType:function(e){return De},toGlsl:function(e,t){return We(t,2),He(t),"("+Ze(e,t[0])+" <= "+Ze(e,t[1])+")"}},Fe["=="]=et("=="),Fe["!="]=et("!="),Fe["!"]={getReturnType:function(e){return De},toGlsl:function(e,t){return We(t,1),ke(t[0]),"(!"+Ze(e,t[0])+")"}},Fe.all=tt("&&"),Fe.any=tt("||"),Fe.between={getReturnType:function(e){return De},toGlsl:function(e,t){We(t,3),He(t);var r=Ze(e,t[1]),n=Ze(e,t[2]),o=Ze(e,t[0]);return"("+o+" >= "+r+" && "+o+" <= "+n+")"}},Fe.array={getReturnType:function(e){return Oe},toGlsl:function(e,t){Ye(t,2),Ke(t,4),He(t);var r=t.map((function(t){return Ze(e,t,Pe)}));return"vec"+t.length+"("+r.join(", ")+")"}},Fe.color={getReturnType:function(e){return Ge},toGlsl:function(e,t){Ye(t,3),Ke(t,4),He(t);var r=t;3===t.length&&r.push(1);var n=t.map((function(t,r){return Ze(e,t,Pe)+(r<3?" / 255.0":"")}));return"vec"+t.length+"("+n.join(", ")+")"}},Fe.interpolate={getReturnType:function(e){for(var t=Ge|Pe,r=3;r<e.length;r+=2)t&=Be(e[r]);return t},toGlsl:function(e,t,r){qe(t),Ye(t,6);var n,o=t[0];switch(o[0]){case"linear":n=1;break;case"exponential":n=o[1];break;default:n=null}if(!n)throw new Error('Invalid interpolation type for "interpolate" operator, received: '+JSON.stringify(o));var i=void 0!==r?r:Ne,a=Fe.interpolate.getReturnType(t)&i;Je(t,a);for(var s=Ze(e,t[1]),u=Ie(n),l="",f=2;f<t.length-2;f+=2){var c=Ze(e,t[f]),h=l||Ze(e,t[f+1],a),p=Ze(e,t[f+2]);l="mix("+h+", "+Ze(e,t[f+3],a)+", pow(clamp(("+s+" - "+c+") / ("+p+" - "+c+"), 0.0, 1.0), "+u+"))"}return l}},Fe.match={getReturnType:function(e){for(var t=Ne,r=2;r<e.length;r+=2)t&=Be(e[r]);return t&=Be(e[e.length-1])},toGlsl:function(e,t,r){qe(t),Ye(t,4);var n=void 0!==r?r:Ne,o=Fe.match.getReturnType(t)&n;Je(t,o);for(var i=Ze(e,t[0]),a=Ze(e,t[t.length-1],o),s=null,u=t.length-3;u>=1;u-=2){s="("+i+" == "+Ze(e,t[u])+" ? "+Ze(e,t[u+1],o)+" : "+(s||a)+")"}return s}},Fe.case={getReturnType:function(e){for(var t=Ne,r=1;r<e.length;r+=2)t&=Be(e[r]);return t&=Be(e[e.length-1])},toGlsl:function(e,t,r){!function(e){if(e.length%2==0)throw new Error("An odd amount of arguments was expected, got "+e+" instead")}(t),Ye(t,3);var n=void 0!==r?r:Ne,o=Fe.case.getReturnType(t)&n;Je(t,o);for(var i=0;i<t.length-1;i+=2)ke(t[i]);var a=Ze(e,t[t.length-1],o),s=null;for(i=t.length-3;i>=0;i-=2){s="("+Ze(e,t[i])+" ? "+Ze(e,t[i+1],o)+" : "+(s||a)+")"}return s}};var rt=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function nt(e,t){var r="\n    attribute vec2 "+me+";\n    uniform mat4 "+he+";\n    uniform float "+ge+";\n\n    varying vec2 v_textureCoord;\n\n    void main() {\n      v_textureCoord = "+me+";\n      gl_Position = "+he+" * vec4("+me+", "+ge+", 1.0);\n    }\n  ",n={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:t},o=[];if(void 0!==e.color){var i=Ze(n,e.color,Ge);o.push("color = "+i+";")}if(void 0!==e.contrast){var a=Ze(n,e.contrast,Pe);o.push("color.rgb = clamp(("+a+" + 1.0) * color.rgb - ("+a+" / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(void 0!==e.exposure){var s=Ze(n,e.exposure,Pe);o.push("color.rgb = clamp(("+s+" + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}if(void 0!==e.saturation){var u=Ze(n,e.saturation,Pe);o.push("\n      float saturation = "+u+" + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    ")}if(void 0!==e.gamma){var l=Ze(n,e.gamma,Pe);o.push("color.rgb = pow(color.rgb, vec3(1.0 / "+l+"));")}if(void 0!==e.brightness){var f=Ze(n,e.brightness,Pe);o.push("color.rgb = clamp(color.rgb + "+f+", vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));")}var c={},h=n.variables.length;if(h>1&&!e.variables)throw new Error("Missing variables in style (expected "+n.variables+")");for(var p=function(t){var r=n.variables[t];if(!(r in e.variables))throw new Error("Missing '"+r+"' in style variables");var o=Qe(r);c[o]=function(){var t=e.variables[r];return"string"==typeof t&&(t=ze(n,t)),void 0!==t?t:-9999999}},g=0;g<h;++g)p(g);var _=Object.keys(c).map((function(e){return"uniform float "+e+";"})),d=Math.ceil(t/4);_.push("uniform sampler2D "+ce+"["+d+"];"),n.paletteTextures&&_.push("uniform sampler2D u_paletteTextures["+n.paletteTextures.length+"];");var T=Object.keys(n.functions).map((function(e){return n.functions[e]}));return{vertexShader:r,fragmentShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    uniform float "+pe+";\n    uniform float "+_e+";\n    uniform float "+de+";\n    uniform float "+Te+";\n    uniform float "+ve+";\n\n    "+_.join("\n")+"\n\n    "+T.join("\n")+"\n\n    void main() {\n      vec4 color = texture2D("+ce+"[0],  v_textureCoord);\n\n      "+o.join("\n")+"\n\n      if (color.a == 0.0) {\n        discard;\n      }\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= "+pe+";\n    }",uniforms:c,paletteTextures:n.paletteTextures}}var ot=function(e){function t(t){var r=this,n=t?(0,p.f0)({},t):{},i=n.style||{};delete n.style;var a=n.cacheSize;return delete n.cacheSize,(r=e.call(this,n)||this).style_=i,r.cacheSize_=a,r.styleVariables_=r.style_.variables||{},r.addChangeListener(o.Z.SOURCE,r.handleSourceUpdate_),r}return rt(t,e),t.prototype.handleSourceUpdate_=function(){this.setStyle(this.style_)},t.prototype.getSourceBandCount_=function(){var e=this.getSource();return e&&"bandCount"in e?e.bandCount:4},t.prototype.createRenderer=function(){var e=nt(this.style_,this.getSourceBandCount_());return new Ae(this,{vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,cacheSize:this.cacheSize_,paletteTextures:e.paletteTextures})},t.prototype.setStyle=function(e){this.style_=e;var t=nt(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,paletteTextures:t.paletteTextures}),this.changed()},t.prototype.updateStyleVariables=function(e){(0,p.f0)(this.styleVariables_,e),this.changed()},t}(n.Z);ot.prototype.dispose;var it=ot}}]);
//# sourceMappingURL=3f0b6c87681acf238f854901f8adf7df8e1f0e8d-86e0a887d8687d063cfc.js.map