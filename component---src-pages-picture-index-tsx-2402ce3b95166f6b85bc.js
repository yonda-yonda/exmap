"use strict";(self.webpackChunkexmap=self.webpackChunkexmap||[]).push([[447],{24070:function(e){function t(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var n,r="",a=0,i=-1,l=0,o=0;o<=e.length;++o){if(o<e.length)n=e.charCodeAt(o);else{if(47===n)break;n=47}if(47===n){if(i===o-1||1===l);else if(i!==o-1&&2===l){if(r.length<2||2!==a||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2))if(r.length>2){var c=r.lastIndexOf("/");if(c!==r.length-1){-1===c?(r="",a=0):a=(r=r.slice(0,c)).length-1-r.lastIndexOf("/"),i=o,l=0;continue}}else if(2===r.length||1===r.length){r="",a=0,i=o,l=0;continue}t&&(r.length>0?r+="/..":r="..",a=2)}else r.length>0?r+="/"+e.slice(i+1,o):r=e.slice(i+1,o),a=o-i-1;i=o,l=0}else 46===n&&-1!==l?++l:l=-1}return r}var r={resolve:function(){for(var e,r="",a=!1,i=arguments.length-1;i>=-1&&!a;i--){var l;i>=0?l=arguments[i]:(void 0===e&&(e=process.cwd()),l=e),t(l),0!==l.length&&(r=l+"/"+r,a=47===l.charCodeAt(0))}return r=n(r,!a),a?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(e){if(t(e),0===e.length)return".";var r=47===e.charCodeAt(0),a=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!r)).length||r||(e="."),e.length>0&&a&&(e+="/"),r?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,n=0;n<arguments.length;++n){var a=arguments[n];t(a),a.length>0&&(void 0===e?e=a:e+="/"+a)}return void 0===e?".":r.normalize(e)},relative:function(e,n){if(t(e),t(n),e===n)return"";if((e=r.resolve(e))===(n=r.resolve(n)))return"";for(var a=1;a<e.length&&47===e.charCodeAt(a);++a);for(var i=e.length,l=i-a,o=1;o<n.length&&47===n.charCodeAt(o);++o);for(var c=n.length-o,u=l<c?l:c,s=-1,m=0;m<=u;++m){if(m===u){if(c>u){if(47===n.charCodeAt(o+m))return n.slice(o+m+1);if(0===m)return n.slice(o+m)}else l>u&&(47===e.charCodeAt(a+m)?s=m:0===m&&(s=0));break}var d=e.charCodeAt(a+m);if(d!==n.charCodeAt(o+m))break;47===d&&(s=m)}var h="";for(m=a+s+1;m<=i;++m)m!==i&&47!==e.charCodeAt(m)||(0===h.length?h+="..":h+="/..");return h.length>0?h+n.slice(o+s):(o+=s,47===n.charCodeAt(o)&&++o,n.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var n=e.charCodeAt(0),r=47===n,a=-1,i=!0,l=e.length-1;l>=1;--l)if(47===(n=e.charCodeAt(l))){if(!i){a=l;break}}else i=!1;return-1===a?r?"/":".":r&&1===a?"//":e.slice(0,a)},basename:function(e,n){if(void 0!==n&&"string"!=typeof n)throw new TypeError('"ext" argument must be a string');t(e);var r,a=0,i=-1,l=!0;if(void 0!==n&&n.length>0&&n.length<=e.length){if(n.length===e.length&&n===e)return"";var o=n.length-1,c=-1;for(r=e.length-1;r>=0;--r){var u=e.charCodeAt(r);if(47===u){if(!l){a=r+1;break}}else-1===c&&(l=!1,c=r+1),o>=0&&(u===n.charCodeAt(o)?-1==--o&&(i=r):(o=-1,i=c))}return a===i?i=c:-1===i&&(i=e.length),e.slice(a,i)}for(r=e.length-1;r>=0;--r)if(47===e.charCodeAt(r)){if(!l){a=r+1;break}}else-1===i&&(l=!1,i=r+1);return-1===i?"":e.slice(a,i)},extname:function(e){t(e);for(var n=-1,r=0,a=-1,i=!0,l=0,o=e.length-1;o>=0;--o){var c=e.charCodeAt(o);if(47!==c)-1===a&&(i=!1,a=o+1),46===c?-1===n?n=o:1!==l&&(l=1):-1!==n&&(l=-1);else if(!i){r=o+1;break}}return-1===n||-1===a||0===l||1===l&&n===a-1&&n===r+1?"":e.slice(n,a)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var n=t.dir||t.root,r=t.base||(t.name||"")+(t.ext||"");return n?n===t.root?n+r:n+e+r:r}("/",e)},parse:function(e){t(e);var n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var r,a=e.charCodeAt(0),i=47===a;i?(n.root="/",r=1):r=0;for(var l=-1,o=0,c=-1,u=!0,s=e.length-1,m=0;s>=r;--s)if(47!==(a=e.charCodeAt(s)))-1===c&&(u=!1,c=s+1),46===a?-1===l?l=s:1!==m&&(m=1):-1!==l&&(m=-1);else if(!u){o=s+1;break}return-1===l||-1===c||0===m||1===m&&l===c-1&&l===o+1?-1!==c&&(n.base=n.name=0===o&&i?e.slice(1,c):e.slice(o,c)):(0===o&&i?(n.name=e.slice(1,l),n.base=e.slice(1,c)):(n.name=e.slice(o,l),n.base=e.slice(o,c)),n.ext=e.slice(l,c)),o>0?n.dir=e.slice(0,o-1):i&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,e.exports=r},41603:function(e,t,n){n.r(t),n.d(t,{default:function(){return H}});var r=n(15861),a=n(93433),i=n(87757),l=n.n(i),o=n(67294),c=n(2055),u=n(8177),s=n(10532),m=n(24070),d=n(49308),h=n(85616),f=n(94382),g=n(4320),p=n(10026),E=n(76968),v=n(13827),x=n(14439),b=n(91570),Z=n(64682),y=n(32990),w=n(34649),M=n(41939),C=n(38737),S=n(54101),R=n(97391),k=n(45505),A=n(51842),_=n(96534),L=n(18559),j=n(97326),O=n(94578),I=n(77059),P=n(28971),z=n(50832),D=n(85338),q=n(27053);function F(e,t){var n=[(e[2]-e[0])/2+e[0],(e[3]-e[1])/2+e[1]],r=[(e[0]-n[0])*Math.cos(t)-(e[3]-n[1])*Math.sin(t),(e[0]-n[0])*Math.sin(t)+(e[3]-n[1])*Math.cos(t)],a=[(e[0]-n[0])*Math.cos(t)-(e[1]-n[1])*Math.sin(t),(e[0]-n[0])*Math.sin(t)+(e[1]-n[1])*Math.cos(t)],i=[(e[2]-n[0])*Math.cos(t)-(e[1]-n[1])*Math.sin(t),(e[2]-n[0])*Math.sin(t)+(e[1]-n[1])*Math.cos(t)],l=[(e[2]-n[0])*Math.cos(t)-(e[3]-n[1])*Math.sin(t),(e[2]-n[0])*Math.sin(t)+(e[3]-n[1])*Math.cos(t)];return[Math.min(r[0],a[0],i[0],l[0])+n[0],Math.min(r[1],a[1],i[1],l[1])+n[1],Math.max(r[0],a[0],i[0],l[0])+n[0],Math.max(r[1],a[1],i[1],l[1])+n[1]]}function G(e,t,n,r){for(var a=void 0!==t?t:P.e,i=(0,z.Cr)(e),l=(0,z.dz)(e),o=(0,D.Pq)(void 0!==n?n:P.S),c=r&&r>0?r:Math.max(l/o[0],i/o[1]),u=a+1,s=new Array(u),m=0;m<u;++m)s[m]=c/Math.pow(2,m+1);return s}var T=function(e){function t(t){var n,r=t||{},a=r.tileSize?r.tileSize:P.S,i=[-180,-90,180,90],l=new q.Z({extent:i,tileSize:a,minZoom:t.minZoom,resolutions:G(i,t.maxZoom,a,360/a)}),o=void 0===r.imageSmoothing||r.imageSmoothing;if(void 0!==r.interpolate&&(o=r.interpolate),n=e.call(this,{state:C.Z.LOADING,attributions:r.attributions,cacheSize:r.cacheSize,crossOrigin:r.crossOrigin,interpolate:o,opaque:r.opaque,projection:"EPSG:4326",reprojectionErrorThreshold:r.reprojectionErrorThreshold,tileGrid:l,tileLoadFunction:function(e,t){var r=t.split(",").map(Number),i=r[0],l=r[1],o=r[2],c=document.createElement("canvas");c.width=a,c.height=a;var u=c.getContext("2d");if(u&&n.context_){var s,m,d=function(e,t,n){var r=180/Math.pow(2,e);return[t*r-180,90-n*r,r]}(i,l,o),h=d[0],f=d[1],g=d[2],p=n.imageExtent_,E=p[0],v=p[1],x=p[2],b=p[3],Z=h,y=h+g,w=f-g,M=f;E<-180&&0<y?(Z-=360,y-=360):180<x&&Z<0&&(Z+=360,y+=360),s=[E,v,x,b],m=[Z,w,y,M],Math.max(s[0],m[0])<=Math.min(s[2],m[2])&&Math.max(s[1],m[1])<=Math.min(s[3],m[3])||e.setState(I.Z.EMPTY);var C=[(x-E)/n.context_.canvas.width,(b-v)/n.context_.canvas.height],S=[(y-Z)/a,(M-w)/a],R=[Math.max(Z,E),Math.max(v,w)],k=[Math.min(y,x),Math.min(b,M)],A=[Math.round((R[0]-Z)/S[0]),Math.round((M-k[1])/S[1]),Math.round((k[0]-Z)/S[0]),Math.round((M-R[1])/S[1])],_=[Math.round((R[0]-E)/C[0]),Math.round((b-k[1])/C[1]),Math.round((k[0]-E)/C[0]),Math.round((b-R[1])/C[1])],L=[_[2]-_[0],_[3]-_[1]],j=[A[2]-A[0],A[3]-A[1]];if(Math.min.apply(Math,L.concat(j))<=0)e.setState(I.Z.EMPTY);else{var O=document.createElement("canvas");O.width=L[0],O.height=L[1];var P=O.getContext("2d");P&&(P.clearRect(0,0,L[0],L[1]),P.putImageData(n.context_.getImageData(_[0],_[1],L[0],L[1]),0,0),u.drawImage(O,0,0,L[0],L[1],A[0],A[1],j[0],j[1])),e.getImage().src=c.toDataURL()}}else e.setState(I.Z.ERROR)},tilePixelRatio:r.tilePixelRatio,url:"{z},{x},{y}",wrapX:void 0===r.wrapX||r.wrapX,transition:r.transition,attributionsCollapsible:r.attributionsCollapsible})||this,n.imageExtent_=[1/0,1/0,-1/0,-1/0],Array.isArray(r.imageExtent)&&r.imageExtent.length>3&&(n.imageExtent_=r.imageExtent),n.imageExtent_[0]<-360||360<n.imageExtent_[0]||n.imageExtent_[1]<-90||90<n.imageExtent_[1]||n.imageExtent_[2]<-360||360<n.imageExtent_[2]||n.imageExtent_[3]<-90||90<n.imageExtent_[3]||n.imageExtent_[2]<=n.imageExtent_[0]||n.imageExtent_[0]-n.imageExtent_[2]>360)throw new Error("invalid extent.");var c=0;r.rotate&&(c=r.rotate,n.imageExtent_=F(n.imageExtent_,c));var u=document.createElement("canvas"),s=u.getContext("2d");if(!s)return n.context_=null,(0,j.Z)(n);s.imageSmoothingEnabled=void 0===o||o,n.context_=s;var m=new Image;m.crossOrigin=r.crossOrigin||"",m.addEventListener("load",(function(){var e=F([0,0,m.width,m.height],c),t=e[2]-e[0],r=e[3]-e[1];u.width=t,u.height=r,s.save(),s.translate(t/2,r/2),s.rotate(-c),s.drawImage(m,-m.width/2,-m.height/2),s.restore(),n.setState(C.Z.READY)})),m.addEventListener("error",(function(){n.setState(C.Z.ERROR)}));try{m.src=r.url}catch(d){console.log(1111111)}return n}return(0,O.Z)(t,e),t}(n(31669).Z),N=(0,M.Z)("div")({fontSize:"12px"}),U=(0,M.Z)("div")({overflow:"hidden"}),W=(0,M.Z)(d.Z)({overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"}),Y=(0,M.Z)(U)({flex:"1 1 auto"}),V=(0,M.Z)("div")({flex:"0 0 auto"}),Q=(0,M.Z)("ul")({listStyle:"none",margin:0,padding:0,"& > li":{marginTop:"5px","&:firstChild":{marginTop:0}}}),X={type:"file",files:"",url:"",extent:""},$=(0,M.Z)("div")({position:"absolute",top:0,left:0,padding:"2px 4px",fontSize:10,pointerEvents:"none"}),H=function(){var e,t,n=(0,_.e)(),i=o.useRef(null),M=o.useRef(null),j=o.useState([]),O=j[0],I=j[1],P=o.useState(null),z=P[0],D=P[1],q=o.useState(),F=q[0],G=q[1],U=(0,L.H)({defaultItems:[],mode:"topbottom",drop:function(e,t){e.index!==t.index&&I((function(n){if(t.index<0||e.index<0||e.index>n.length-1||t.index>n.length-1)return n;var r=(0,a.Z)(n),i=r[e.index];return r.splice(e.index,1),r.splice(t.index,0,i),r}))}}),H=(0,u.cI)({mode:"onSubmit",criteriaMode:"all",defaultValues:X}),J=H.control,B=H.handleSubmit,K=H.register,ee=H.reset,te=H.watch,ne=H.setValue,re=H.formState.errors,ae=o.useCallback((function(e){I((function(t){var r=(0,a.Z)(t),i=r.findIndex((function(t){return e===t.id})),l=r[i];return l&&(l.source.revoke&&URL.revokeObjectURL(l.source.url),n.map)?(n.map.removeLayer(l.layer),r.splice(i,1),r):r}))}),[n.map]),ie=U.reset;o.useEffect((function(){var e=0;O.forEach((function(t){t.layer.setZIndex(e++)})),ie((0,a.Z)(O))}),[O,ie]);var le=o.useCallback(function(){var e=(0,r.Z)(l().mark((function e(t,n,r){var i,o,c,u;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:G(!0);try{i=new T({url:r.url,imageExtent:r.extent,crossOrigin:"anonymous"}),o=i.getState(),c=function(){var e=new S.Z({source:i});t.addLayer(e),I((function(t){return[].concat((0,a.Z)(t),[{id:n,layer:e,source:r,error:null}])}));var l=r.extent;if(l){var o=(0,R.$A)(l,"EPSG:4326","EPSG:3857");o[0]>o[2]&&(o[2]+=2*(0,A.default)("EPSG:4326","EPSG:3857",[180,0])[0]),t.getView().fit(o,{padding:[40,20,40,20],maxZoom:20})}},o===C.Z.READY?(c(),G(!1)):(u=function e(){var t=i.getState();t===C.Z.ERROR&&(i.removeEventListener("change",e),D("FailedLoadSource"),G(!1)),t===C.Z.READY&&(i.removeEventListener("change",e),c(),G(!1))},i.addEventListener("change",u))}catch(l){G(!1)}case 2:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),[]),oe=o.useCallback((function(e){var t=e.source,r=e.id;n.map&&le(n.map,r,t)}),[n.map,le]);o.useEffect((function(){!1===F&&ee()}),[F,ee]);var ce=o.useCallback((function(e){for(var t=e.extent.split(",").map((function(e){return Number(e)})),n=0;n<t.length;n++){var r=t[n];if("number"!=typeof r||r-r!=0)return void D("InvalidExtent")}if(t[0]>t[2]||t[1]>t[3])D("ReversedExtent");else{var a="",i=null;switch(e.type){case"file":if(!(e.files instanceof FileList))break;var l=e.files[0];a+=l.name,i={url:URL.createObjectURL(l),revoke:!0,name:l.name,extent:t};break;case"url":var o=e.url;a+=o,i={url:o,revoke:!1,name:o.split("/").pop()||"",extent:t}}if(a+=t.join(","),i){if(O.findIndex((function(e){return a===e.id}))>=0)return void D("Duplicate");oe({id:a,source:i})}}}),[oe,O]),ue=te(),se=o.useCallback((function(){ee(),ne("type","url"),ne("url",location.origin+(0,m.join)(location.pathname,"../image/rect.png")),ne("extent","0,0,10,10"),D(null)}),[ne,D,ee]);return o.useEffect((function(){var e=null;return n.map&&M.current&&(e=new k.Z({coordinateFormat:function(e){return e?"lon: "+e[0].toFixed(4)+", lat: "+e[1].toFixed(4):""},projection:"EPSG:4326",className:"",target:M.current}),n.map.addControl(e)),function(){n.map&&e&&n.map.removeControl(e)}}),[n.map]),o.createElement(o.Fragment,null,o.createElement(s.ZP,null),o.createElement(c.Helmet,null,o.createElement("title",null,"Display Image"),o.createElement("meta",{name:"description",content:"Display Image on map."}),o.createElement("link",{rel:"canonical",href:"https://yonda-yonda.github.io/exmap/picture"}),o.createElement("link",{rel:"icon",type:"image/x-icon",href:"https://github.githubassets.com/favicon.ico"}),o.createElement("link",{rel:"stylesheet",href:"https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap"}),o.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),o.createElement("meta",{name:"twitter:title",content:"Display Image"}),o.createElement("meta",{name:"twitter:description",content:"PNG, JPEG, GIF, WEBPを表示します"}),o.createElement("meta",{property:"og:url",content:"https://yonda-yonda.github.io/exmap/picture"}),o.createElement("meta",{name:"twitter:image",content:"https://yonda-yonda.github.io/exmap/image/twitter_picture.png"})),o.createElement(h.Z,null,o.createElement(d.Z,{variant:"h2",component:"h1"},"Display Image"),o.createElement(f.Z,{my:4,spacing:4},o.createElement("div",null,o.createElement(g.ZP,{container:!0,spacing:2},o.createElement(g.ZP,{item:!0,xs:9},o.createElement("div",{style:{position:"relative"},ref:i},o.createElement("div",{ref:n.ref,style:{width:"100%",height:"340px"}}),o.createElement($,{ref:M}))),o.createElement(g.ZP,{item:!0,xs:3},O.length>0?o.createElement(Q,null,U.items.map((function(e){return o.createElement("li",Object.assign({key:e.key,ref:e.ref},e.trigger),o.createElement(f.Z,{direction:"row",spacing:1,justifyContent:"space-between",alignItems:"center"},o.createElement(Y,null,o.createElement(p.Z,{title:o.createElement(d.Z,Object.assign({variant:"caption",display:"block"},e.propagation),e.value.source.name),arrow:!0,placement:"left"},o.createElement(W,{variant:"body2"},e.value.source.name))),o.createElement(V,e.propagation,o.createElement(E.Z,{size:"small",variant:"outlined",onClick:function(){ae(e.value.id)}},"REMOVE"))))}))):o.createElement(d.Z,null,"Nothing to display.")))),o.createElement("div",null,o.createElement("form",{onSubmit:B(ce)},o.createElement(f.Z,{spacing:2},o.createElement("div",null,o.createElement(E.Z,{variant:"outlined",onClick:se,size:"small"},"sample")),o.createElement(u.Qr,{control:J,name:"type",render:function(e){var t=e.field;return o.createElement(v.Z,{fullWidth:!0},o.createElement(x.Z,Object.assign({row:!0},t),o.createElement(b.Z,{value:"file",control:o.createElement(Z.Z,{size:"small"}),label:"Local File"}),o.createElement(b.Z,{value:"url",control:o.createElement(Z.Z,{size:"small"}),label:"URL"})))}}),"file"===ue.type&&o.createElement(v.Z,{component:"fieldset",error:!(null==re||!re.files),fullWidth:!0},o.createElement("input",Object.assign({},K("files",{required:!0,validate:{length:function(e){return e instanceof FileList&&1===e.length}}}),{disabled:F,accept:".webp,.png,.jpeg,.jpg,.gif,image/webp,image/png,image/jpeg,image/svg+xml,image/gif",type:"file"})),"required"===(null==re||null===(e=re.files)||void 0===e?void 0:e.type)&&o.createElement(y.Z,null,"Required. ",o.createElement("br",null),"ファイルを選択してください。"),"length"===(null==re||null===(t=re.files)||void 0===t?void 0:t.type)&&o.createElement(y.Z,null,"Required. ",o.createElement("br",null),"ファイルを1つ選択してください。")),"url"===ue.type&&o.createElement(u.Qr,{control:J,name:"url",render:function(e){var t=e.field,n=e.fieldState,r=n.invalid,a=n.error;return o.createElement(v.Z,{component:"fieldset",error:r,fullWidth:!0},o.createElement(w.Z,Object.assign({},t,{label:"url",size:"small",error:r,placeholder:"https://",disabled:F})),"required"===(null==a?void 0:a.type)&&o.createElement(y.Z,null,"Required. ",o.createElement("br",null),"必須です。入力してください。"),"pattern"===(null==a?void 0:a.type)&&o.createElement(y.Z,null,"Not matched URL pattern.",o.createElement("br",null),"URLの形式が正しくありません。"))},rules:{required:!0,pattern:/(^(https?):\/\/[^ "]+$|(^http:\/\/localhost))/}}),o.createElement(N,null,"support: .webp, .png, .jpeg, .jpg, .gif"),o.createElement(f.Z,{direction:"row",spacing:4,sx:{mt:2,mb:1}},o.createElement(u.Qr,{control:J,name:"extent",render:function(e){var t=e.field,n=e.fieldState,r=n.invalid,a=n.error;return o.createElement(v.Z,{component:"fieldset",error:r,fullWidth:!0},o.createElement(w.Z,Object.assign({},t,{label:"Extent",size:"small",error:r,placeholder:"left laongitude, bottom latitude, right longitude, top latitude"})),"required"===(null==a?void 0:a.type)&&o.createElement(y.Z,null,"Required. ",o.createElement("br",null),"必須です。入力してください。"),"pattern"===(null==a?void 0:a.type)&&o.createElement(y.Z,null,"Must be left bottom and right top coordinates separated by commas.",o.createElement("br",null),"カンマ区切りで左下経度,左下緯度,右上経度,右上緯度を入力してください。"))},rules:{required:!0,pattern:/^(\+|-|\.|\d|e|E|,|\s)*$/}}))),o.createElement(v.Z,{error:!!z,sx:{mt:3}},o.createElement("div",null,o.createElement(E.Z,{variant:"contained",type:"submit",disabled:F,onClick:function(){D(null)}},"Add Layer")),"Duplicate"===z&&o.createElement(y.Z,{sx:{ml:0}},"Duplicate Layer. ",o.createElement("br",null),"すでに同じレイヤーが存在します。"),"InvalidExtent"===z&&o.createElement(y.Z,{sx:{ml:0}},"Extent includes Non-numbers. ",o.createElement("br",null),"Extentに数字以外の値が入力されています。"),"ReversedExtent"===z&&o.createElement(y.Z,{sx:{ml:0}},"Some values of Extent are reversed. ",o.createElement("br",null),"Extentに大小が逆の値が含まれています。"),"FailedLoadSource"===z&&o.createElement(y.Z,{sx:{ml:0}},"Failed to load source. ",o.createElement("br",null),"ファイルの読み込みに失敗しました。")))))))}}}]);
//# sourceMappingURL=component---src-pages-picture-index-tsx-2402ce3b95166f6b85bc.js.map