"use strict";(self.webpackChunkexmap=self.webpackChunkexmap||[]).push([[543],{21011:function(t,e,r){var n,o=r(34533),i=r(77059),a=(n=function(t,e){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},n(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}),s=function(t){function e(e){var r=this,n=i.Z.IDLE;return(r=t.call(this,e.tileCoord,n,{transition:e.transition,interpolate:e.interpolate})||this).loader_=e.loader,r.data_=null,r.error_=null,r}return a(e,t),e.prototype.getData=function(){return this.data_},e.prototype.getError=function(){return this.error_},e.prototype.load=function(){this.state=i.Z.LOADING,this.changed();var t=this;this.loader_().then((function(e){t.data_=e,t.state=i.Z.LOADED,t.changed()})).catch((function(e){t.error_=e,t.state=i.Z.ERROR,t.changed()}))},e}(o.Z);e.Z=s},1485:function(t,e,r){r.d(e,{Z:function(){return ge}});var n=r(15370),o=r(3286),i=r(38737),a=r(4591),s=r(76785),c=r(77059),u=r(21011),l=r(31690),f=r(50008),h=r(47037),p=r(19413),g=r(42991),d=34962,_=34963,v=35044,m=["experimental-webgl","webgl","webkit-3d","moz-webgl"];function T(t,e){for(var r=(0,g.f0)({preserveDrawingBuffer:!0},e),n=m.length,o=0;o<n;++o)try{var i=t.getContext(m[o],r);if(i)return i}catch(a){}return null}var E=r(34093),y=v,x=function(){function t(t,e){this.array=null,this.type=t,(0,E.h)(t===d||t===_,62),this.usage=void 0!==e?e:y}return t.prototype.ofSize=function(t){this.array=new(R(this.type))(t)},t.prototype.fromArray=function(t){var e=R(this.type);this.array=e.from?e.from(t):new e(t)},t.prototype.fromArrayBuffer=function(t){this.array=new(R(this.type))(t)},t.prototype.getType=function(){return this.type},t.prototype.getArray=function(){return this.array},t.prototype.getUsage=function(){return this.usage},t.prototype.getSize=function(){return this.array?this.array.length:0},t}();function R(t){switch(t){case d:return Float32Array;case _:return Uint32Array;default:return Float32Array}}var b,S=x,A=r(31938),C=r(17523),L=r(85338),w=(b=function(t,e){return b=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},b(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function r(){this.constructor=t}b(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)});function P(t,e,r){var n=r?t.LINEAR:t.NEAREST;t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n)}function U(t,e,r,n,o,i){var a=t.getGL();P(a,e,i);var s,c,u=r.byteLength/n[1],l=1;switch(u%8==0?l=8:u%4==0?l=4:u%2==0&&(l=2),o){case 1:s=a.LUMINANCE;break;case 2:s=a.LUMINANCE_ALPHA;break;case 3:s=a.RGB;break;case 4:s=a.RGBA;break;default:throw new Error("Unsupported number of bands: ".concat(o))}r instanceof Float32Array?(c=a.FLOAT,t.getExtension("OES_texture_float"),t.getExtension("OES_texture_float_linear")):c=a.UNSIGNED_BYTE;var f=a.getParameter(a.UNPACK_ALIGNMENT);a.pixelStorei(a.UNPACK_ALIGNMENT,l),a.texImage2D(a.TEXTURE_2D,0,s,n[0],n[1],0,s,c,r),a.pixelStorei(a.UNPACK_ALIGNMENT,f)}var G=null;var D=function(t){function e(e){var r=t.call(this)||this;r.tile,r.textures=[],r.handleTileChange_=r.handleTileChange_.bind(r),r.size=(0,L.Pq)(e.grid.getTileSize(e.tile.tileCoord[0])),r.tilePixelRatio_=e.tilePixelRatio||1,r.gutter_=e.gutter||0,r.bandCount=NaN,r.helper_=e.helper;var n=new S(d,v);return n.fromArray([0,1,1,1,1,0,0,0]),r.helper_.flushBufferData(n),r.coords=n,r.setTile(e.tile),r}return w(e,t),e.prototype.setTile=function(t){if(t!==this.tile)if(this.tile&&this.tile.removeEventListener(f.Z.CHANGE,this.handleTileChange_),this.tile=t,this.textures.length=0,this.loaded=t.getState()===c.Z.LOADED,this.loaded)this.uploadTile_();else{if(t instanceof h.Z){var e=t.getImage();e instanceof Image&&!e.crossOrigin&&(e.crossOrigin="anonymous")}t.addEventListener(f.Z.CHANGE,this.handleTileChange_)}},e.prototype.uploadTile_=function(){var t=this.helper_,e=t.getGL(),r=this.tile;if(r instanceof h.Z||r instanceof p.Z){var n=r.getImage();if(0!==this.gutter_){var o=this.tilePixelRatio_*this.gutter_,i=Math.round(n.width-2*o),a=Math.round(n.height-2*o),s=(0,C.E4)(i,a);r.interpolate||(0,g.f0)(s,A.$),s.drawImage(n,o,o,i,a,0,0,i,a),n=s.canvas}var c=e.createTexture();return this.textures.push(c),this.bandCount=4,void function(t,e,r,n){P(t,e,n),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)}(e,c,n,r.interpolate)}var u=[this.size[0]*this.tilePixelRatio_,this.size[1]*this.tilePixelRatio_],l=r.getData(),f=l instanceof Float32Array,d=u[0]*u[1],_=f?Float32Array:Uint8Array,v=_.BYTES_PER_ELEMENT,m=l.byteLength/u[1];this.bandCount=Math.floor(m/v/u[0]);var T=Math.ceil(this.bandCount/4);if(1===T){c=e.createTexture();return this.textures.push(c),void U(t,c,l,u,this.bandCount,r.interpolate)}for(var E=new Array(T),y=0;y<T;++y){c=e.createTexture();this.textures.push(c);var x=y<T-1?4:this.bandCount%4;E[y]=new _(d*x)}for(var R=0,b=0,S=u[0]*this.bandCount,L=0;L<u[1];++L){for(var w=0;w<S;++w){var G=l[b+w],D=Math.floor(R/this.bandCount),O=w%this.bandCount;(F=E[y=Math.floor(O/4)])[D*(x=F.length/d)+O%4]=G,++R}b+=m/v}for(y=0;y<T;++y){var F;U(t,c=this.textures[y],F=E[y],u,x=F.length/d,r.interpolate)}},e.prototype.handleTileChange_=function(){this.tile.getState()===c.Z.LOADED&&(this.loaded=!0,this.uploadTile_(),this.dispatchEvent(f.Z.CHANGE))},e.prototype.disposeInternal=function(){var t=this.helper_.getGL();this.helper_.deleteBuffer(this.coords);for(var e=0;e<this.textures.length;++e)t.deleteTexture(this.textures[e]);this.tile.removeEventListener(f.Z.CHANGE,this.handleTileChange_)},e.prototype.getPixelData=function(t,e){if(!this.loaded)return null;if(t=Math.floor(this.tilePixelRatio_*t),e=Math.floor(this.tilePixelRatio_*e),this.tile instanceof u.Z){var r=this.tile.getData(),n=Math.floor(this.tilePixelRatio_*this.size[0]);if(r instanceof DataView){var o=r.byteLength/(this.size[0]*this.size[1]),i=e*n*o+t*o,a=r.buffer.slice(i,i+o);return new DataView(a)}var s=e*n*this.bandCount+t*this.bandCount;return r.slice(s,s+this.bandCount)}var c,l;G||((c=document.createElement("canvas")).width=1,c.height=1,G=c.getContext("2d")),G.clearRect(0,0,1,1);var f=this.tile.getImage();try{G.drawImage(f,t,e,1,1,0,0,1,1),l=G.getImageData(0,0,1,1).data}catch(h){return null}return l},e}(l.Z),O=r(74237),F=r(23343),M=r(26239),N="webglcontextlost",I="webglcontextrestored",B=r(35925),X=r(90399),Z=function(){function t(t){this.gl_=t.webGlContext;var e=this.gl_;this.scaleRatio_=t.scaleRatio||1,this.renderTargetTexture_=e.createTexture(),this.renderTargetTextureSize_=null,this.frameBuffer_=e.createFramebuffer();var r=e.createShader(e.VERTEX_SHADER);e.shaderSource(r,t.vertexShader||"\n  precision mediump float;\n  \n  attribute vec2 a_position;\n  varying vec2 v_texCoord;\n  varying vec2 v_screenCoord;\n  \n  uniform vec2 u_screenSize;\n   \n  void main() {\n    v_texCoord = a_position * 0.5 + 0.5;\n    v_screenCoord = v_texCoord * u_screenSize;\n    gl_Position = vec4(a_position, 0.0, 1.0);\n  }\n"),e.compileShader(r);var n=e.createShader(e.FRAGMENT_SHADER);e.shaderSource(n,t.fragmentShader||"\n  precision mediump float;\n   \n  uniform sampler2D u_image;\n  uniform float u_opacity;\n   \n  varying vec2 v_texCoord;\n   \n  void main() {\n    gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n  }\n"),e.compileShader(n),this.renderTargetProgram_=e.createProgram(),e.attachShader(this.renderTargetProgram_,r),e.attachShader(this.renderTargetProgram_,n),e.linkProgram(this.renderTargetProgram_),this.renderTargetVerticesBuffer_=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),e.STATIC_DRAW),this.renderTargetAttribLocation_=e.getAttribLocation(this.renderTargetProgram_,"a_position"),this.renderTargetUniformLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_screenSize"),this.renderTargetOpacityLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_opacity"),this.renderTargetTextureLocation_=e.getUniformLocation(this.renderTargetProgram_,"u_image"),this.uniforms_=[],t.uniforms&&Object.keys(t.uniforms).forEach(function(r){this.uniforms_.push({value:t.uniforms[r],location:e.getUniformLocation(this.renderTargetProgram_,r)})}.bind(this))}return t.prototype.getGL=function(){return this.gl_},t.prototype.init=function(t){var e=this.getGL(),r=[e.drawingBufferWidth*this.scaleRatio_,e.drawingBufferHeight*this.scaleRatio_];if(e.bindFramebuffer(e.FRAMEBUFFER,this.getFrameBuffer()),e.viewport(0,0,r[0],r[1]),!this.renderTargetTextureSize_||this.renderTargetTextureSize_[0]!==r[0]||this.renderTargetTextureSize_[1]!==r[1]){this.renderTargetTextureSize_=r;var n=e.RGBA,o=e.RGBA,i=e.UNSIGNED_BYTE;e.bindTexture(e.TEXTURE_2D,this.renderTargetTexture_),e.texImage2D(e.TEXTURE_2D,0,n,r[0],r[1],0,o,i,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.renderTargetTexture_,0)}},t.prototype.apply=function(t,e,r,n){var o=this.getGL(),i=t.size;if(o.bindFramebuffer(o.FRAMEBUFFER,e?e.getFrameBuffer():null),o.activeTexture(o.TEXTURE0),o.bindTexture(o.TEXTURE_2D,this.renderTargetTexture_),!e){var a=(0,X.sq)(o.canvas);if(!t.renderTargets[a]){var s=o.getContextAttributes();s&&s.preserveDrawingBuffer&&(o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT)),t.renderTargets[a]=!0}}o.enable(o.BLEND),o.blendFunc(o.ONE,o.ONE_MINUS_SRC_ALPHA),o.viewport(0,0,o.drawingBufferWidth,o.drawingBufferHeight),o.bindBuffer(o.ARRAY_BUFFER,this.renderTargetVerticesBuffer_),o.useProgram(this.renderTargetProgram_),o.enableVertexAttribArray(this.renderTargetAttribLocation_),o.vertexAttribPointer(this.renderTargetAttribLocation_,2,o.FLOAT,!1,0,0),o.uniform2f(this.renderTargetUniformLocation_,i[0],i[1]),o.uniform1i(this.renderTargetTextureLocation_,0);var c=t.layerStatesArray[t.layerIndex].opacity;o.uniform1f(this.renderTargetOpacityLocation_,c),this.applyUniforms(t),r&&r(o,t),o.drawArrays(o.TRIANGLES,0,6),n&&n(o,t)},t.prototype.getFrameBuffer=function(){return this.frameBuffer_},t.prototype.applyUniforms=function(t){var e,r=this.getGL(),n=1;this.uniforms_.forEach((function(o){if((e="function"==typeof o.value?o.value(t):o.value)instanceof HTMLCanvasElement||e instanceof ImageData)o.texture||(o.texture=r.createTexture()),r.activeTexture(r["TEXTURE".concat(n)]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),e instanceof ImageData?r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,e.width,e.height,0,r.UNSIGNED_BYTE,new Uint8Array(e.data)):r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e),r.uniform1i(o.location,n++);else if(Array.isArray(e))switch(e.length){case 2:return void r.uniform2f(o.location,e[0],e[1]);case 3:return void r.uniform3f(o.location,e[0],e[1],e[2]);case 4:return void r.uniform4f(o.location,e[0],e[1],e[2],e[3]);default:return}else"number"==typeof e&&r.uniform1f(o.location,e)}))},t}(),z=Z,j=r(27083);function V(t,e){return t[0]=e[0],t[1]=e[1],t[4]=e[2],t[5]=e[3],t[12]=e[4],t[13]=e[5],t}var H=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),W="u_offsetScaleMatrix",k="u_offsetRotateMatrix",Y="u_time",K="u_zoom",q="u_resolution",J=5121,Q=5123,$=5125,tt=5126,et={};function rt(t){return"shared/"+t}var nt=0;var ot=function(t){function e(e){var r,n=t.call(this)||this,o=e||{};n.boundHandleWebGLContextLost_=n.handleWebGLContextLost.bind(n),n.boundHandleWebGLContextRestored_=n.handleWebGLContextRestored.bind(n),n.canvasCacheKey_=o.canvasCacheKey?rt(o.canvasCacheKey):(r="unique/"+nt,nt+=1,r),n.canvas_=function(t){var e=et[t];if(!e){var r=document.createElement("canvas");r.style.position="absolute",r.style.left="0",e={users:0,canvas:r},et[t]=e}return e.users+=1,e.canvas}(n.canvasCacheKey_),n.gl_=T(n.canvas_),n.bufferCache_={},n.extensionCache_={},n.currentProgram_=null,n.canvas_.addEventListener(N,n.boundHandleWebGLContextLost_),n.canvas_.addEventListener(I,n.boundHandleWebGLContextRestored_),n.offsetRotateMatrix_=(0,j.Ue)(),n.offsetScaleMatrix_=(0,j.Ue)(),n.tmpMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.uniformLocations_={},n.attribLocations_={},n.uniforms_=[],o.uniforms&&n.setUniforms(o.uniforms);var i=n.getGL();return n.postProcessPasses_=o.postProcesses?o.postProcesses.map((function(t){return new z({webGlContext:i,scaleRatio:t.scaleRatio,vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms})})):[new z({webGlContext:i})],n.shaderCompileErrors_=null,n.startTime_=Date.now(),n}return H(e,t),e.prototype.setUniforms=function(t){for(var e in this.uniforms_=[],t)this.uniforms_.push({name:e,value:t[e]});this.uniformLocations_={}},e.prototype.canvasCacheKeyMatches=function(t){return this.canvasCacheKey_===rt(t)},e.prototype.getExtension=function(t){if(t in this.extensionCache_)return this.extensionCache_[t];var e=this.gl_.getExtension(t);return this.extensionCache_[t]=e,e},e.prototype.bindBuffer=function(t){var e=this.getGL(),r=(0,X.sq)(t),n=this.bufferCache_[r];n||(n={buffer:t,webGlBuffer:e.createBuffer()},this.bufferCache_[r]=n);e.bindBuffer(t.getType(),n.webGlBuffer)},e.prototype.flushBufferData=function(t){var e=this.getGL();this.bindBuffer(t),e.bufferData(t.getType(),t.getArray(),t.getUsage())},e.prototype.deleteBuffer=function(t){var e=this.getGL(),r=(0,X.sq)(t),n=this.bufferCache_[r];n&&!e.isContextLost()&&e.deleteBuffer(n.webGlBuffer),delete this.bufferCache_[r]},e.prototype.disposeInternal=function(){this.canvas_.removeEventListener(N,this.boundHandleWebGLContextLost_),this.canvas_.removeEventListener(I,this.boundHandleWebGLContextRestored_),function(t){var e=et[t];if(e&&(e.users-=1,!(e.users>0))){var r=T(e.canvas).getExtension("WEBGL_lose_context");r&&r.loseContext(),delete et[t]}}(this.canvasCacheKey_),delete this.gl_,delete this.canvas_},e.prototype.prepareDraw=function(t,e){var r=this.getGL(),n=this.getCanvas(),o=t.size,i=t.pixelRatio;n.width=o[0]*i,n.height=o[1]*i,n.style.width=o[0]+"px",n.style.height=o[1]+"px",r.useProgram(this.currentProgram_);for(var a=this.postProcessPasses_.length-1;a>=0;a--)this.postProcessPasses_[a].init(t);r.bindTexture(r.TEXTURE_2D,null),r.clearColor(0,0,0,0),r.clear(r.COLOR_BUFFER_BIT),r.enable(r.BLEND),r.blendFunc(r.ONE,e?r.ZERO:r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.prepareDrawToRenderTarget=function(t,e,r){var n=this.getGL(),o=e.getSize();n.bindFramebuffer(n.FRAMEBUFFER,e.getFramebuffer()),n.viewport(0,0,o[0],o[1]),n.bindTexture(n.TEXTURE_2D,e.getTexture()),n.clearColor(0,0,0,0),n.clear(n.COLOR_BUFFER_BIT),n.enable(n.BLEND),n.blendFunc(n.ONE,r?n.ZERO:n.ONE_MINUS_SRC_ALPHA),n.useProgram(this.currentProgram_),this.applyFrameState(t),this.applyUniforms(t)},e.prototype.drawElements=function(t,e){var r=this.getGL();this.getExtension("OES_element_index_uint");var n=r.UNSIGNED_INT,o=e-t,i=4*t;r.drawElements(r.TRIANGLES,o,n,i)},e.prototype.finalizeDraw=function(t,e,r){for(var n=0,o=this.postProcessPasses_.length;n<o;n++)n===o-1?this.postProcessPasses_[n].apply(t,null,e,r):this.postProcessPasses_[n].apply(t,this.postProcessPasses_[n+1])},e.prototype.getCanvas=function(){return this.canvas_},e.prototype.getGL=function(){return this.gl_},e.prototype.applyFrameState=function(t){var e=t.size,r=t.viewState.rotation,n=(0,j.mc)(this.offsetScaleMatrix_);(0,j.bA)(n,2/e[0],2/e[1]);var o=(0,j.mc)(this.offsetRotateMatrix_);0!==r&&(0,j.U1)(o,-r),this.setUniformMatrixValue(W,V(this.tmpMat4_,n)),this.setUniformMatrixValue(k,V(this.tmpMat4_,o)),this.setUniformFloatValue(Y,.001*(Date.now()-this.startTime_)),this.setUniformFloatValue(K,t.viewState.zoom),this.setUniformFloatValue(q,t.viewState.resolution)},e.prototype.applyUniforms=function(t){var e,r=this.getGL(),n=0;this.uniforms_.forEach(function(o){if((e="function"==typeof o.value?o.value(t):o.value)instanceof HTMLCanvasElement||e instanceof HTMLImageElement||e instanceof ImageData)o.texture||(o.prevValue=void 0,o.texture=r.createTexture()),r.activeTexture(r["TEXTURE".concat(n)]),r.bindTexture(r.TEXTURE_2D,o.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),(!(e instanceof HTMLImageElement)||e.complete)&&o.prevValue!==e&&(o.prevValue=e,r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,e)),r.uniform1i(this.getUniformLocation(o.name),n++);else if(Array.isArray(e)&&6===e.length)this.setUniformMatrixValue(o.name,V(this.tmpMat4_,e));else if(Array.isArray(e)&&e.length<=4)switch(e.length){case 2:return void r.uniform2f(this.getUniformLocation(o.name),e[0],e[1]);case 3:return void r.uniform3f(this.getUniformLocation(o.name),e[0],e[1],e[2]);case 4:return void r.uniform4f(this.getUniformLocation(o.name),e[0],e[1],e[2],e[3]);default:return}else"number"==typeof e&&r.uniform1f(this.getUniformLocation(o.name),e)}.bind(this))},e.prototype.useProgram=function(t){return t!=this.currentProgram_&&(this.getGL().useProgram(t),this.currentProgram_=t,this.uniformLocations_={},this.attribLocations_={},!0)},e.prototype.compileShader=function(t,e){var r=this.getGL(),n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n},e.prototype.getProgram=function(t,e){var r=this.getGL(),n=this.compileShader(t,r.FRAGMENT_SHADER),o=this.compileShader(e,r.VERTEX_SHADER),i=r.createProgram();if(r.attachShader(i,n),r.attachShader(i,o),r.linkProgram(i),!r.getShaderParameter(n,r.COMPILE_STATUS)){var a="Fragment shader compliation failed: ".concat(r.getShaderInfoLog(n));throw new Error(a)}if(r.deleteShader(n),!r.getShaderParameter(o,r.COMPILE_STATUS)){a="Vertex shader compilation failed: ".concat(r.getShaderInfoLog(o));throw new Error(a)}if(r.deleteShader(o),!r.getProgramParameter(i,r.LINK_STATUS)){a="GL program linking failed: ".concat(r.getShaderInfoLog(o));throw new Error(a)}return i},e.prototype.getUniformLocation=function(t){return void 0===this.uniformLocations_[t]&&(this.uniformLocations_[t]=this.getGL().getUniformLocation(this.currentProgram_,t)),this.uniformLocations_[t]},e.prototype.getAttributeLocation=function(t){return void 0===this.attribLocations_[t]&&(this.attribLocations_[t]=this.getGL().getAttribLocation(this.currentProgram_,t)),this.attribLocations_[t]},e.prototype.makeProjectionTransform=function(t,e){var r=t.size,n=t.viewState.rotation,o=t.viewState.resolution,i=t.viewState.center;return(0,j.mc)(e),(0,j.qC)(e,0,0,2/(o*r[0]),2/(o*r[1]),-n,-i[0],-i[1]),e},e.prototype.setUniformFloatValue=function(t,e){this.getGL().uniform1f(this.getUniformLocation(t),e)},e.prototype.setUniformFloatVec4=function(t,e){this.getGL().uniform4fv(this.getUniformLocation(t),e)},e.prototype.setUniformMatrixValue=function(t,e){this.getGL().uniformMatrix4fv(this.getUniformLocation(t),!1,e)},e.prototype.enableAttributeArray_=function(t,e,r,n,o){var i=this.getAttributeLocation(t);i<0||(this.getGL().enableVertexAttribArray(i),this.getGL().vertexAttribPointer(i,e,r,!1,n,o))},e.prototype.enableAttributes=function(t){for(var e=function(t){for(var e=0,r=0;r<t.length;r++){var n=t[r];e+=n.size*it(n.type)}return e}(t),r=0,n=0;n<t.length;n++){var o=t[n];this.enableAttributeArray_(o.name,o.size,o.type||5126,e,r),r+=o.size*it(o.type)}},e.prototype.handleWebGLContextLost=function(){(0,g.ZH)(this.bufferCache_),this.currentProgram_=null},e.prototype.handleWebGLContextRestored=function(){},e.prototype.createTexture=function(t,e,r){var n=this.getGL(),o=r||n.createTexture(),i=n.RGBA,a=n.RGBA,s=n.UNSIGNED_BYTE;return n.bindTexture(n.TEXTURE_2D,o),e?n.texImage2D(n.TEXTURE_2D,0,i,a,s,e):n.texImage2D(n.TEXTURE_2D,0,i,t[0],t[1],0,a,s,null),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),o},e}(B.Z);function it(t){switch(t){case J:return Uint8Array.BYTES_PER_ELEMENT;case Q:return Uint16Array.BYTES_PER_ELEMENT;case $:return Uint32Array.BYTES_PER_ELEMENT;default:return Float32Array.BYTES_PER_ELEMENT}}var at=ot,st=r(50832),ct=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),ut=function(t){function e(e,r){var n=t.call(this,e)||this,i=r||{};return n.inversePixelTransform_=(0,j.Ue)(),n.pixelContext_=null,n.postProcesses_=i.postProcesses,n.uniforms_=i.uniforms,n.helper,e.addChangeListener(o.Z.MAP,n.removeHelper.bind(n)),n.dispatchPreComposeEvent=n.dispatchPreComposeEvent.bind(n),n.dispatchPostComposeEvent=n.dispatchPostComposeEvent.bind(n),n}return ct(e,t),e.prototype.dispatchPreComposeEvent=function(t,e){var r=this.getLayer();if(r.hasListener(M.Z.PRECOMPOSE)){var n=new F.Z(M.Z.PRECOMPOSE,void 0,e,t);r.dispatchEvent(n)}},e.prototype.dispatchPostComposeEvent=function(t,e){var r=this.getLayer();if(r.hasListener(M.Z.POSTCOMPOSE)){var n=new F.Z(M.Z.POSTCOMPOSE,void 0,e,t);r.dispatchEvent(n)}},e.prototype.reset=function(t){this.uniforms_=t.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)},e.prototype.removeHelper=function(){this.helper&&(this.helper.dispose(),delete this.helper)},e.prototype.prepareFrame=function(t){if(this.getLayer().getRenderSource()){for(var r=!0,n=-1,o=void 0,i=0,a=t.layerStatesArray.length;i<a;i++){var s=t.layerStatesArray[i].layer,c=s.getRenderer();if(c instanceof e){var u=s.getClassName();if((r||u!==o)&&(n+=1,r=!1),o=u,c===this)break}else r=!0}var l="map/"+t.mapId+"/group/"+n;this.helper&&this.helper.canvasCacheKeyMatches(l)||(this.removeHelper(),this.helper=new at({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:l}),o&&(this.helper.getCanvas().className=o),this.afterHelperCreated())}return this.prepareFrameInternal(t)},e.prototype.afterHelperCreated=function(){},e.prototype.prepareFrameInternal=function(t){return!0},e.prototype.disposeInternal=function(){this.removeHelper(),t.prototype.disposeInternal.call(this)},e.prototype.dispatchRenderEvent_=function(t,e,r){var n=this.getLayer();if(n.hasListener(t)){(0,j.qC)(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);var o=new F.Z(t,this.inversePixelTransform_,r,e);n.dispatchEvent(o)}},e.prototype.preRender=function(t,e){this.dispatchRenderEvent_(M.Z.PRERENDER,t,e)},e.prototype.postRender=function(t,e){this.dispatchRenderEvent_(M.Z.POSTRENDER,t,e)},e.prototype.getDataAtPixel=function(t,e,r){var n=(0,j.nn)([e.pixelRatio,0,0,e.pixelRatio,0,0],t.slice()),o=this.helper.getGL();if(!o)return null;var i=this.getLayer().getExtent();if(i){var a=(0,j.nn)(e.pixelToCoordinateTransform,t.slice());if(!(0,st.b8)(i,a))return null}var s=o.getContextAttributes();if(!s||!s.preserveDrawingBuffer)return new Uint8Array;var c,u=Math.round(n[0]),l=Math.round(n[1]),f=this.pixelContext_;if(!f){var h=document.createElement("canvas");h.width=1,h.height=1,f=h.getContext("2d"),this.pixelContext_=f}f.clearRect(0,0,1,1);try{f.drawImage(o.canvas,u,l,1,1,0,0,1,1),c=f.getImageData(0,0,1,1).data}catch(p){return c}return 0===c[3]?null:c},e}(O.Z);var lt=ut,ft=r(79998),ht=r(93681),pt=r(28312),gt=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}(),dt="u_tileTextures",_t="u_tileTransform",vt="u_transitionAlpha",mt="u_depth",Tt="u_texturePixelWidth",Et="u_texturePixelHeight",yt="u_textureResolution",xt="u_textureOriginX",Rt="u_textureOriginY",bt="u_renderExtent",St="u_resolution",At="u_zoom",Ct="a_textureCoord",Lt=[{name:Ct,size:2,type:tt}],wt={};function Pt(t){return 2*(1-1/(t+1))-1}function Ut(t,e,r){r in t||(t[r]=[]),t[r].push(e)}function Gt(t,e){var r=t.layerStatesArray[t.layerIndex];r.extent&&(e=(0,st.Ed)(e,(0,ht.dY)(r.extent,t.viewState.projection)));var n=r.layer.getRenderSource();if(!n.getWrapX()){var o=n.getTileGridForProjection(t.viewState.projection).getExtent();o&&(e=(0,st.Ed)(e,o))}return e}function Dt(t,e){return"".concat(t.getKey(),",").concat((0,ft.km)(e))}var Ot=function(t){function e(e,r){var n=t.call(this,e,{uniforms:r.uniforms})||this;n.renderComplete=!1,n.tileTransform_=(0,j.Ue)(),n.tempMat4_=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],n.tempTileRange_=new s.Z(0,0,0,0),n.tempTileCoord_=(0,ft.T9)(0,0,0),n.tempSize_=[0,0],n.program_,n.vertexShader_=r.vertexShader,n.fragmentShader_=r.fragmentShader,n.indices_=new S(_,v),n.indices_.fromArray([0,1,3,1,2,3]);var o=void 0!==r.cacheSize?r.cacheSize:512;return n.tileTextureCache_=new a.Z(o),n.paletteTextures_=r.paletteTextures||[],n.frameState_=null,n}return gt(e,t),e.prototype.reset=function(e){t.prototype.reset.call(this,{uniforms:e.uniforms}),this.vertexShader_=e.vertexShader,this.fragmentShader_=e.fragmentShader,this.paletteTextures_=e.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))},e.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)},e.prototype.isDrawableTile_=function(t){var e=this.getLayer(),r=t.getState(),n=e.getUseInterimTilesOnError();return r==c.Z.LOADED||r==c.Z.EMPTY||r==c.Z.ERROR&&!n},e.prototype.prepareFrameInternal=function(t){var e=this.getLayer().getRenderSource();return!!e&&(!(0,st.xb)(Gt(t,t.extent))&&e.getState()===i.Z.READY)},e.prototype.enqueueTiles=function(t,e,r,n){var o=t.viewState,i=this.getLayer(),a=i.getRenderSource(),s=a.getTileGridForProjection(o.projection),u=a.getTilePixelRatio(t.pixelRatio),l=a.getGutterForProjection(o.projection),f=(0,X.sq)(a);f in t.wantedTiles||(t.wantedTiles[f]={});for(var h=t.wantedTiles[f],p=this.tileTextureCache_,g=Math.max(r-i.getPreload(),s.getMinZoom(),i.getMinZoom()),d=r;d>=g;--d)for(var _=s.getTileRangeForExtentAndZ(e,d,this.tempTileRange_),v=s.getResolution(d),m=_.minX;m<=_.maxX;++m)for(var T=_.minY;T<=_.maxY;++T){var E=(0,ft.T9)(d,m,T,this.tempTileCoord_),y=Dt(a,E),x=void 0,R=void 0;if(p.containsKey(y)&&(R=(x=p.get(y)).tile),!x||x.tile.key!==a.getKey())if(R=a.getTile(d,m,T,t.pixelRatio,o.projection),x)if(this.isDrawableTile_(R))x.setTile(R);else{var b=R.getInterimTile();x.setTile(b)}else x=new D({tile:R,grid:s,helper:this.helper,tilePixelRatio:u,gutter:l}),p.set(y,x);Ut(n,x,d);var S=R.getKey();h[S]=!0,R.getState()===c.Z.IDLE&&(t.tileQueue.isKeyQueued(S)||t.tileQueue.enqueue([R,f,s.getTileCoordCenter(E),v]))}},e.prototype.renderFrame=function(t){this.frameState_=t,this.renderComplete=!0;var e=this.helper.getGL();this.preRender(e,t);var r=t.viewState,n=this.getLayer().getRenderSource(),o=n.getTileGridForProjection(r.projection),i=Gt(t,t.extent),a=o.getZForResolution(r.resolution,n.zDirection),s={};if(t.nextExtent){var c=o.getZForResolution(r.nextResolution,n.zDirection),u=Gt(t,t.nextExtent);this.enqueueTiles(t,u,c,s)}this.enqueueTiles(t,i,a,s);for(var l={},f=(0,X.sq)(this),h=t.time,p=!1,g=s[a],d=0,_=g.length;d<_;++d){var v=(F=(J=g[d]).tile).tileCoord;if(J.loaded){if(1===(M=F.getAlpha(f,h))){F.endTransition(f);continue}p=!0,l[N=(0,ft.km)(v)]=M}if(this.renderComplete=!1,!this.findAltTiles_(o,v,a+1,s))for(var m=o.getMinZoom(),T=a-1;T>=m;--T){if(this.findAltTiles_(o,v,T,s))break}}this.helper.useProgram(this.program_),this.helper.prepareDraw(t,!p);for(var E=Object.keys(s).map(Number).sort(pt.kK),y=r.center[0],x=r.center[1],R=0,b=E.length;R<b;++R){var S=E[R],A=o.getResolution(S),C=(0,L.Pq)(o.getTileSize(S),this.tempSize_),w=o.getOrigin(S),P=(y-w[0])/(C[0]*A),U=(w[1]-x)/(C[1]*A),G=r.resolution/A,D=Pt(S),O=s[S];for(d=0,_=O.length;d<_;++d){if((J=O[d]).loaded){v=(F=J.tile).tileCoord;var F,M,N=(0,ft.km)(v),I=v[1],B=v[2];(0,j.qC)(this.tileTransform_,0,0,2/(t.size[0]*G/C[0]),-2/(t.size[1]*G/C[1]),r.rotation,-(P-I),-(U-B)),this.helper.setUniformMatrixValue(_t,V(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(J.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(Lt);for(var Z=0;Z<J.textures.length;){var z="TEXTURE"+Z,H="".concat(dt,"[").concat(Z,"]");e.activeTexture(e[z]),e.bindTexture(e.TEXTURE_2D,J.textures[Z]),e.uniform1i(this.helper.getUniformLocation(H),Z),++Z}for(var W=0;W<this.paletteTextures_.length;++W){var k=this.paletteTextures_[W];e.activeTexture(e["TEXTURE"+Z]);var Y=k.getTexture(e);e.bindTexture(e.TEXTURE_2D,Y),e.uniform1i(this.helper.getUniformLocation(k.name),Z),++Z}(M=N in l?l[N]:1)<1&&(t.animate=!0),this.helper.setUniformFloatValue(vt,M),this.helper.setUniformFloatValue(mt,D),this.helper.setUniformFloatValue(Tt,C[0]),this.helper.setUniformFloatValue(Et,C[1]),this.helper.setUniformFloatValue(yt,A),this.helper.setUniformFloatValue(xt,w[0]+I*C[0]*A),this.helper.setUniformFloatValue(Rt,w[1]-B*C[1]*A),this.helper.setUniformFloatVec4(bt,i),this.helper.setUniformFloatValue(St,r.resolution),this.helper.setUniformFloatValue(At,r.zoom),this.helper.drawElements(0,this.indices_.getSize())}}}this.helper.finalizeDraw(t,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);for(var K=this.helper.getCanvas(),q=this.tileTextureCache_;q.canExpireCache();){var J;(J=q.pop()).dispose()}return t.postRenderFunctions.push((function(t,e){n.expireCache(e.viewState.projection,wt)})),this.postRender(e,t),K},e.prototype.getData=function(t){if(!this.helper.getGL())return null;var e=this.frameState_;if(!e)return null;var r=this.getLayer(),n=(0,j.nn)(e.pixelToCoordinateTransform,t.slice()),o=e.viewState,i=r.getExtent();if(i&&!(0,st.b8)((0,ht.dY)(i,o.projection),n))return null;var a=r.getRenderSource(),s=a.getTileGridForProjection(o.projection);if(!a.getWrapX()){var c=s.getExtent();if(c&&!(0,st.b8)(c,n))return null}for(var u=this.tileTextureCache_,l=s.getZForResolution(o.resolution);l>=s.getMinZoom();--l){var f=s.getTileCoordForCoordAndZ(n,l),h=Dt(a,f);if(u.containsKey(h)){var p=u.get(h);if(p.loaded){var g=s.getOrigin(l),d=(0,L.Pq)(s.getTileSize(l)),_=s.getResolution(l),v=(n[0]-g[0])/_-f[1]*d[0],m=(g[1]-n[1])/_-f[2]*d[1];return p.getPixelData(v,m)}}}return null},e.prototype.findAltTiles_=function(t,e,r,n){var o=t.getTileRangeForTileCoordAndZ(e,r,this.tempTileRange_);if(!o)return!1;for(var i=!0,a=this.tileTextureCache_,s=this.getLayer().getRenderSource(),c=o.minX;c<=o.maxX;++c)for(var u=o.minY;u<=o.maxY;++u){var l=Dt(s,[r,c,u]),f=!1;if(a.containsKey(l)){var h=a.get(l);h.loaded&&(Ut(n,h,r),f=!0)}f||(i=!1)}return i},e.prototype.removeHelper=function(){if(this.helper){var e=this.tileTextureCache_;e.forEach((function(t){return t.dispose()})),e.clear()}t.prototype.removeHelper.call(this)},e.prototype.disposeInternal=function(){var e=this.helper;e&&(e.getGL().deleteProgram(this.program_),delete this.program_,e.deleteBuffer(this.indices_));t.prototype.disposeInternal.call(this),delete this.indices_,delete this.tileTextureCache_,delete this.frameState_},e}(lt),Ft=function(){function t(t,e){this.name=t,this.data=e,this.texture_=null}return t.prototype.getTexture=function(t){if(!this.texture_){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.data.length/4,1,0,t.RGBA,t.UNSIGNED_BYTE,this.data),this.texture_=e}return this.texture_},t}(),Mt=r(45482),Nt=r(40125),It=1,Bt=2,Xt=4,Zt=8,zt=16,jt=31,Vt=0,Ht={};function Wt(t){if("number"==typeof t)return It;if("boolean"==typeof t)return Zt;if("string"==typeof t)return(0,Mt.e1)(t)?Xt|Bt:Bt;if(!Array.isArray(t))throw new Error("Unhandled value type: ".concat(JSON.stringify(t)));var e=t;if(e.every((function(t){return"number"==typeof t})))return 3===e.length||4===e.length?Xt|zt:zt;if("string"!=typeof e[0])throw new Error("Expected an expression operator but received: ".concat(JSON.stringify(e)));var r=Ht[e[0]];if(void 0===r)throw new Error("Unrecognized expression operator: ".concat(JSON.stringify(e)));return r.getReturnType(e.slice(1))}function kt(t){var e=t.toString();return-1===e.indexOf(".")?e+".0":e}function Yt(t){if(t.length<2||t.length>4)throw new Error("`formatArray` can only output `vec2`, `vec3` or `vec4` arrays.");return"vec".concat(t.length,"(").concat(t.map(kt).join(", "),")")}function Kt(t,e){return void 0===t.stringLiteralsMap[e]&&(t.stringLiteralsMap[e]=Object.keys(t.stringLiteralsMap).length),t.stringLiteralsMap[e]}function qt(t,e,r){if(Array.isArray(e)&&"string"==typeof e[0]){var n=Ht[e[0]];if(void 0===n)throw new Error("Unrecognized expression operator: ".concat(JSON.stringify(e)));return n.toGlsl(t,e.slice(1),r)}var o=Wt(e);if((o&It)>0)return kt(e);if((o&Zt)>0)return e.toString();if((o&Bt)>0&&(void 0===r||r==Bt))return function(t,e){return kt(Kt(t,e))}(t,e.toString());if((o&Xt)>0&&(void 0===r||r==Xt))return function(t){var e=(0,Mt._2)(t).slice();return e.length<4&&e.push(1),Yt(e.map((function(t,e){return e<3?t/255:t})))}(e);if((o&zt)>0)return Yt(e);throw new Error("Unexpected expression ".concat(e," (expected type ").concat(r,")"))}function Jt(t){if(!(Wt(t)&It))throw new Error("A numeric value was expected, got ".concat(JSON.stringify(t)," instead"))}function Qt(t){for(var e=0;e<t.length;e++)Jt(t[e])}function $t(t){if(!(Wt(t)&Bt))throw new Error("A string value was expected, got ".concat(JSON.stringify(t)," instead"))}function te(t){if(!(Wt(t)&Zt))throw new Error("A boolean value was expected, got ".concat(JSON.stringify(t)," instead"))}function ee(t,e){if(t.length!==e)throw new Error("Exactly ".concat(e," arguments were expected, got ").concat(t.length," instead"))}function re(t,e){if(t.length<e)throw new Error("At least ".concat(e," arguments were expected, got ").concat(t.length," instead"))}function ne(t,e){if(t.length>e)throw new Error("At most ".concat(e," arguments were expected, got ").concat(t.length," instead"))}function oe(t){if(t.length%2!=0)throw new Error("An even amount of arguments was expected, got ".concat(t," instead"))}function ie(t,e){if(r=e,(0,Nt.k3)(r)%1!=0)throw new Error("Could not infer only one type from the following expression: ".concat(JSON.stringify(t)));var r}function ae(t){return"u_var_"+t}Ht.get={getReturnType:function(t){return jt},toGlsl:function(t,e){ee(e,1),$t(e[0]);var r=e[0].toString();return-1===t.attributes.indexOf(r)&&t.attributes.push(r),(t.inFragmentShader?"v_":"a_")+r}},Ht.var={getReturnType:function(t){return jt},toGlsl:function(t,e){ee(e,1),$t(e[0]);var r=e[0].toString();return-1===t.variables.indexOf(r)&&t.variables.push(r),ae(r)}};var se="u_paletteTextures";Ht.palette={getReturnType:function(t){return Xt},toGlsl:function(t,e){ee(e,2),Jt(e[0]);var r=qt(t,e[0]),n=e[1];if(!Array.isArray(n))throw new Error("The second argument of palette must be an array");for(var o=n.length,i=new Uint8Array(4*o),a=0;a<o;a++){var s=n[a],c=void 0;if("string"==typeof s)c=(0,Mt.mL)(s);else{if(!Array.isArray(s))throw new Error("The second argument of palette must be an array of strings or colors");var u=s.length;if(4===u)c=s;else{if(3!==u)throw new Error("Expected palette color to have 3 or 4 values, got ".concat(u));c=[s[0],s[1],s[2],1]}}var l=4*a;i[l]=c[0],i[l+1]=c[1],i[l+2]=c[2],i[l+3]=255*c[3]}t.paletteTextures||(t.paletteTextures=[]);var f="".concat(se,"[").concat(t.paletteTextures.length,"]"),h=new Ft(f,i);return t.paletteTextures.push(h),"texture2D(".concat(f,", vec2((").concat(r," + 0.5) / ").concat(o,".0, 0.5))")}};var ce="getBandValue";function ue(t){return{getReturnType:function(t){return Zt},toGlsl:function(e,r){ee(r,2);for(var n=jt,o=0;o<r.length;o++)n&=Wt(r[o]);if(n===Vt)throw new Error("All arguments should be of compatible type, got ".concat(JSON.stringify(r)," instead"));return n&=~Xt,"(".concat(qt(e,r[0],n)," ").concat(t," ").concat(qt(e,r[1],n),")")}}}function le(t){return{getReturnType:function(t){return Zt},toGlsl:function(e,r){re(r,2);for(var n=0;n<r.length;n++)te(r[n]);var o="";return o=r.map((function(t){return qt(e,t)})).join(" ".concat(t," ")),o="(".concat(o,")")}}}Ht.band={getReturnType:function(t){return It},toGlsl:function(t,e){re(e,1),ne(e,3);var r=e[0];if(!(ce in t.functions)){for(var n="",o=t.bandCount||1,i=0;i<o;i++){var a=Math.floor(i/4),s=i%4;s===o-1&&1===s&&(s=3);var c="".concat(dt,"[").concat(a,"]");n+="\n          if (band == ".concat(i+1,".0) {\n            return texture2D(").concat(c,", v_textureCoord + vec2(dx, dy))[").concat(s,"];\n          }\n        ")}t.functions.getBandValue="\n        float getBandValue(float band, float xOffset, float yOffset) {\n          float dx = xOffset / ".concat(Tt,";\n          float dy = yOffset / ").concat(Et,";\n          ").concat(n,"\n        }\n      ")}var u=qt(t,r),l=qt(t,e[1]||0),f=qt(t,e[2]||0);return"".concat(ce,"(").concat(u,", ").concat(l,", ").concat(f,")")}},Ht.time={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,0),"u_time"}},Ht.zoom={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,0),"u_zoom"}},Ht.resolution={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,0),"u_resolution"}},Ht["*"]={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,2),Qt(e),"(".concat(qt(t,e[0])," * ").concat(qt(t,e[1]),")")}},Ht["/"]={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,2),Qt(e),"(".concat(qt(t,e[0])," / ").concat(qt(t,e[1]),")")}},Ht["+"]={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,2),Qt(e),"(".concat(qt(t,e[0])," + ").concat(qt(t,e[1]),")")}},Ht["-"]={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,2),Qt(e),"(".concat(qt(t,e[0])," - ").concat(qt(t,e[1]),")")}},Ht.clamp={getReturnType:function(t){return It},toGlsl:function(t,e){ee(e,3),Qt(e);var r=qt(t,e[1]),n=qt(t,e[2]);return"clamp(".concat(qt(t,e[0]),", ").concat(r,", ").concat(n,")")}},Ht["%"]={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,2),Qt(e),"mod(".concat(qt(t,e[0]),", ").concat(qt(t,e[1]),")")}},Ht["^"]={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,2),Qt(e),"pow(".concat(qt(t,e[0]),", ").concat(qt(t,e[1]),")")}},Ht.abs={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,1),Qt(e),"abs(".concat(qt(t,e[0]),")")}},Ht.floor={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,1),Qt(e),"floor(".concat(qt(t,e[0]),")")}},Ht.round={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,1),Qt(e),"floor(".concat(qt(t,e[0])," + 0.5)")}},Ht.ceil={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,1),Qt(e),"ceil(".concat(qt(t,e[0]),")")}},Ht.sin={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,1),Qt(e),"sin(".concat(qt(t,e[0]),")")}},Ht.cos={getReturnType:function(t){return It},toGlsl:function(t,e){return ee(e,1),Qt(e),"cos(".concat(qt(t,e[0]),")")}},Ht.atan={getReturnType:function(t){return It},toGlsl:function(t,e){return re(e,1),ne(e,2),Qt(e),2===e.length?"atan(".concat(qt(t,e[0]),", ").concat(qt(t,e[1]),")"):"atan(".concat(qt(t,e[0]),")")}},Ht[">"]={getReturnType:function(t){return Zt},toGlsl:function(t,e){return ee(e,2),Qt(e),"(".concat(qt(t,e[0])," > ").concat(qt(t,e[1]),")")}},Ht[">="]={getReturnType:function(t){return Zt},toGlsl:function(t,e){return ee(e,2),Qt(e),"(".concat(qt(t,e[0])," >= ").concat(qt(t,e[1]),")")}},Ht["<"]={getReturnType:function(t){return Zt},toGlsl:function(t,e){return ee(e,2),Qt(e),"(".concat(qt(t,e[0])," < ").concat(qt(t,e[1]),")")}},Ht["<="]={getReturnType:function(t){return Zt},toGlsl:function(t,e){return ee(e,2),Qt(e),"(".concat(qt(t,e[0])," <= ").concat(qt(t,e[1]),")")}},Ht["=="]=ue("=="),Ht["!="]=ue("!="),Ht["!"]={getReturnType:function(t){return Zt},toGlsl:function(t,e){return ee(e,1),te(e[0]),"(!".concat(qt(t,e[0]),")")}},Ht.all=le("&&"),Ht.any=le("||"),Ht.between={getReturnType:function(t){return Zt},toGlsl:function(t,e){ee(e,3),Qt(e);var r=qt(t,e[1]),n=qt(t,e[2]),o=qt(t,e[0]);return"(".concat(o," >= ").concat(r," && ").concat(o," <= ").concat(n,")")}},Ht.array={getReturnType:function(t){return zt},toGlsl:function(t,e){re(e,2),ne(e,4),Qt(e);var r=e.map((function(e){return qt(t,e,It)}));return"vec".concat(e.length,"(").concat(r.join(", "),")")}},Ht.color={getReturnType:function(t){return Xt},toGlsl:function(t,e){re(e,3),ne(e,4),Qt(e);var r=e;3===e.length&&r.push(1);var n=e.map((function(e,r){return qt(t,e,It)+(r<3?" / 255.0":"")}));return"vec".concat(e.length,"(").concat(n.join(", "),")")}},Ht.interpolate={getReturnType:function(t){for(var e=Xt|It,r=3;r<t.length;r+=2)e&=Wt(t[r]);return e},toGlsl:function(t,e,r){oe(e),re(e,6);var n,o=e[0];switch(o[0]){case"linear":n=1;break;case"exponential":n=o[1];break;default:n=null}if(!n)throw new Error('Invalid interpolation type for "interpolate" operator, received: '.concat(JSON.stringify(o)));var i=void 0!==r?r:jt,a=Ht.interpolate.getReturnType(e)&i;ie(e,a);for(var s=qt(t,e[1]),c=kt(n),u="",l=2;l<e.length-2;l+=2){var f=qt(t,e[l]),h=u||qt(t,e[l+1],a),p=qt(t,e[l+2]),g=qt(t,e[l+3],a);u="mix(".concat(h,", ").concat(g,", pow(clamp((").concat(s," - ").concat(f,") / (").concat(p," - ").concat(f,"), 0.0, 1.0), ").concat(c,"))")}return u}},Ht.match={getReturnType:function(t){for(var e=jt,r=2;r<t.length;r+=2)e&=Wt(t[r]);return e&=Wt(t[t.length-1])},toGlsl:function(t,e,r){oe(e),re(e,4);var n=void 0!==r?r:jt,o=Ht.match.getReturnType(e)&n;ie(e,o);for(var i=qt(t,e[0]),a=qt(t,e[e.length-1],o),s=null,c=e.length-3;c>=1;c-=2){var u=qt(t,e[c]),l=qt(t,e[c+1],o);s="(".concat(i," == ").concat(u," ? ").concat(l," : ").concat(s||a,")")}return s}},Ht.case={getReturnType:function(t){for(var e=jt,r=1;r<t.length;r+=2)e&=Wt(t[r]);return e&=Wt(t[t.length-1])},toGlsl:function(t,e,r){!function(t){if(t.length%2==0)throw new Error("An odd amount of arguments was expected, got ".concat(t," instead"))}(e),re(e,3);var n=void 0!==r?r:jt,o=Ht.case.getReturnType(e)&n;ie(e,o);for(var i=0;i<e.length-1;i+=2)te(e[i]);var a=qt(t,e[e.length-1],o),s=null;for(i=e.length-3;i>=0;i-=2){var c=qt(t,e[i]),u=qt(t,e[i+1],o);s="(".concat(c," ? ").concat(u," : ").concat(s||a,")")}return s}};var fe=function(){var t=function(e,r){return t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])},t(e,r)};return function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=e}t(e,r),e.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}}();function he(t,e){var r="\n    attribute vec2 ".concat(Ct,";\n    uniform mat4 ").concat(_t,";\n    uniform float ").concat(Tt,";\n    uniform float ").concat(Et,";\n    uniform float ").concat(yt,";\n    uniform float ").concat(xt,";\n    uniform float ").concat(Rt,";\n    uniform float ").concat(mt,";\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n\n    void main() {\n      v_textureCoord = ").concat(Ct,";\n      v_mapCoord = vec2(\n        ").concat(xt," + ").concat(yt," * ").concat(Tt," * v_textureCoord[0],\n        ").concat(Rt," - ").concat(yt," * ").concat(Et," * v_textureCoord[1]\n      );\n      gl_Position = ").concat(_t," * vec4(").concat(Ct,", ").concat(mt,", 1.0);\n    }\n  "),n={inFragmentShader:!0,variables:[],attributes:[],stringLiteralsMap:{},functions:{},bandCount:e},o=[];if(void 0!==t.color){var i=qt(n,t.color,Xt);o.push("color = ".concat(i,";"))}if(void 0!==t.contrast){var a=qt(n,t.contrast,It);o.push("color.rgb = clamp((".concat(a," + 1.0) * color.rgb - (").concat(a," / 2.0), vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));"))}if(void 0!==t.exposure){var s=qt(n,t.exposure,It);o.push("color.rgb = clamp((".concat(s," + 1.0) * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));"))}if(void 0!==t.saturation){var c=qt(n,t.saturation,It);o.push("\n      float saturation = ".concat(c," + 1.0;\n      float sr = (1.0 - saturation) * 0.2126;\n      float sg = (1.0 - saturation) * 0.7152;\n      float sb = (1.0 - saturation) * 0.0722;\n      mat3 saturationMatrix = mat3(\n        sr + saturation, sr, sr,\n        sg, sg + saturation, sg,\n        sb, sb, sb + saturation\n      );\n      color.rgb = clamp(saturationMatrix * color.rgb, vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));\n    "))}if(void 0!==t.gamma){var u=qt(n,t.gamma,It);o.push("color.rgb = pow(color.rgb, vec3(1.0 / ".concat(u,"));"))}if(void 0!==t.brightness){var l=qt(n,t.brightness,It);o.push("color.rgb = clamp(color.rgb + ".concat(l,", vec3(0.0, 0.0, 0.0), vec3(1.0, 1.0, 1.0));"))}var f={},h=n.variables.length;if(h>1&&!t.variables)throw new Error("Missing variables in style (expected ".concat(n.variables,")"));for(var p=function(e){var r=n.variables[e];if(!(r in t.variables))throw new Error("Missing '".concat(r,"' in style variables"));var o=ae(r);f[o]=function(){var e=t.variables[r];return"string"==typeof e&&(e=Kt(n,e)),void 0!==e?e:-9999999}},g=0;g<h;++g)p(g);var d=Object.keys(f).map((function(t){return"uniform float ".concat(t,";")})),_=Math.ceil(e/4);d.push("uniform sampler2D ".concat(dt,"[").concat(_,"];")),n.paletteTextures&&d.push("uniform sampler2D ".concat(se,"[").concat(n.paletteTextures.length,"];"));var v=Object.keys(n.functions).map((function(t){return n.functions[t]}));return{vertexShader:r,fragmentShader:"\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n    precision highp float;\n    #else\n    precision mediump float;\n    #endif\n\n    varying vec2 v_textureCoord;\n    varying vec2 v_mapCoord;\n    uniform vec4 ".concat(bt,";\n    uniform float ").concat(vt,";\n    uniform float ").concat(Tt,";\n    uniform float ").concat(Et,";\n    uniform float ").concat(St,";\n    uniform float ").concat(At,";\n\n    ").concat(d.join("\n"),"\n\n    ").concat(v.join("\n"),"\n\n    void main() {\n      if (\n        v_mapCoord[0] < ").concat(bt,"[0] ||\n        v_mapCoord[1] < ").concat(bt,"[1] ||\n        v_mapCoord[0] > ").concat(bt,"[2] ||\n        v_mapCoord[1] > ").concat(bt,"[3]\n      ) {\n        discard;\n      }\n\n      vec4 color = texture2D(").concat(dt,"[0],  v_textureCoord);\n\n      ").concat(o.join("\n"),"\n\n      if (color.a == 0.0) {\n        discard;\n      }\n\n      gl_FragColor = color;\n      gl_FragColor.rgb *= gl_FragColor.a;\n      gl_FragColor *= ").concat(vt,";\n    }"),uniforms:f,paletteTextures:n.paletteTextures}}var pe=function(t){function e(e){var r=this,n=e?(0,g.f0)({},e):{},i=n.style||{};delete n.style;var a=n.cacheSize;return delete n.cacheSize,(r=t.call(this,n)||this).sources_=n.sources,r.renderedResolution_=NaN,r.style_=i,r.cacheSize_=a,r.styleVariables_=r.style_.variables||{},r.addChangeListener(o.Z.SOURCE,r.handleSourceUpdate_),r}return fe(e,t),e.prototype.getSources=function(t,e){var r=this.getSource();return this.sources_?"function"==typeof this.sources_?this.sources_(t,e):this.sources_:r?[r]:[]},e.prototype.getRenderSource=function(){return this.getLayerState().source||this.getSource()},e.prototype.getSourceState=function(){var t=this.getRenderSource();return t?t.getState():i.Z.UNDEFINED},e.prototype.handleSourceUpdate_=function(){this.getSource()&&this.setStyle(this.style_)},e.prototype.getSourceBandCount_=function(){var t=this.getSource();return t&&"bandCount"in t?t.bandCount:4},e.prototype.createRenderer=function(){var t=he(this.style_,this.getSourceBandCount_());return new Ot(this,{vertexShader:t.vertexShader,fragmentShader:t.fragmentShader,uniforms:t.uniforms,cacheSize:this.cacheSize_,paletteTextures:t.paletteTextures})},e.prototype.renderSources=function(t,e){for(var r,n=this.getRenderer(),o=0,i=e.length;o<i;++o)this.getLayerState().source=e[o],n.prepareFrame(t)&&(r=n.renderFrame(t));return r},e.prototype.render=function(t,e){var r=this;this.rendered=!0;for(var n=t.viewState,o=this.getSources(t.extent,n.resolution),a=!0,s=function(t,e){var n=o[t],s=n.getState();if(s==i.Z.LOADING){n.addEventListener("change",(function t(){n.getState()==i.Z.READY&&(n.removeEventListener("change",t),r.changed())}))}a=a&&s==i.Z.READY},c=0,u=o.length;c<u;++c)s(c);var l=this.renderSources(t,o);if(this.getRenderer().renderComplete&&a)return this.renderedResolution_=n.resolution,l;if(this.renderedResolution_>.5*n.resolution){var f=this.getSources(t.extent,this.renderedResolution_).filter((function(t){return!o.includes(t)}));if(f.length>0)return this.renderSources(t,f)}return l},e.prototype.setStyle=function(t){this.styleVariables_=t.variables||{},this.style_=t;var e=he(this.style_,this.getSourceBandCount_());this.getRenderer().reset({vertexShader:e.vertexShader,fragmentShader:e.fragmentShader,uniforms:e.uniforms,paletteTextures:e.paletteTextures}),this.changed()},e.prototype.updateStyleVariables=function(t){(0,g.f0)(this.styleVariables_,t),this.changed()},e}(n.Z);pe.prototype.dispose;var ge=pe}}]);
//# sourceMappingURL=0ca780ad695cf1158c38cfd2a2fb35b624e274ba-41d870ffec3bfe086cb0.js.map