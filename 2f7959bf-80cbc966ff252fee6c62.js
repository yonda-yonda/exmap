"use strict";(self.webpackChunkexmap=self.webpackChunkexmap||[]).push([[7285],{97582:function(e,t,r){var i=r(41248),n=r(57536),a=r(72607),o=r(90708),s=r(78499),u=r(62136),c=r(20127),l=r(23865),d=r(20924),h=r(21312),m=r(60735),f=r(28200),p=r(40769),_=r(34426),g=r(33147),Z=r(31040),v=r(42306),x=r(65171),y=r(36678),S=r(96190),R=r(91069),C=r(87215),M=r(41916),b=r(77882),E=r(584),w=r(56951),A=r(64256),T=r(79139),P=r(30468),L=r(49640),I=r(80646),B=r(33227),N=r(32339),D=r(21168),O=r(39433),F=r(48293),U=r(33931),q=r(97817),z=r(11654),V=r(21122),k=r(9168),H=r(75114),G=r(22504),W=r(48090),K=r(38774),j=r(36908),Y=r(2232),J=r(53946),X=r(97538),Q=r(14636),$=r(7193),ee=r(19173),te=r(66210),re=r(35542),ie=r(1912),ne=r(38927),ae=r(15318),oe=r(46306),se=r(87544),ue=r(84075),ce=r(22227),le=r(77459),de=r(43632),he=r(34940),me=r(43908),fe=r(8074),pe=r(82535),_e=r(79676),ge=r(66131),Ze=r(51815),ve=r(6201),xe=r(24915),ye=r(94170),Se=r(7388),Re=r(18369),Ce=r(40296),Me=r(88077),be=r(46661),Ee=new a.Z,we=xe.Z.ModelState,Ae=E.Z.EPSILON16;function Te(e,t){e._cachedGltf=t}function Pe(e){this._gltf=e.gltf,this.ready=e.ready,this.modelsToLoad=[],this.count=0}Object.defineProperties(Pe.prototype,{gltf:{set:function(e){this._gltf=e},get:function(){return this._gltf}}}),Pe.prototype.makeReady=function(e){this.gltf=e;for(var t=this.modelsToLoad,r=t.length,i=0;i<r;++i){var n=t[i];n.isDestroyed()||Te(n,this)}this.modelsToLoad=void 0,this.ready=!0};var Le={},Ie={};function Be(e){var t,r=(e=(0,f.Z)(e,f.Z.EMPTY_OBJECT)).cacheKey;if(this._cacheKey=r,this._cachedGltf=void 0,this._releaseGltfJson=(0,f.Z)(e.releaseGltfJson,!1),(0,p.Z)(r)&&(0,p.Z)(Le[r])&&Le[r].ready)++(t=Le[r]).count;else{var o=e.gltf;if((0,p.Z)(o)){if(o instanceof ArrayBuffer&&(o=new Uint8Array(o)),o instanceof Uint8Array)t=new Pe({gltf:(0,ee.Z)(o),ready:!0});else t=new Pe({gltf:e.gltf,ready:!0});t.count=1,(0,p.Z)(r)&&(Le[r]=t)}}Te(this,t);var s=(0,f.Z)(e.basePath,"");this._resource=I.Z.createIfNeeded(s);var u=e.credit;"string"==typeof u&&(u=new m.Z(u)),this._credit=u,this._resourceCredits=[],this.show=(0,f.Z)(e.show,!0),this.silhouetteColor=(0,f.Z)(e.silhouetteColor,l.Z.RED),this._silhouetteColor=new l.Z,this._silhouetteColorPreviousAlpha=1,this._normalAttributeName=void 0,this.silhouetteSize=(0,f.Z)(e.silhouetteSize,0),this.modelMatrix=A.Z.clone((0,f.Z)(e.modelMatrix,A.Z.IDENTITY)),this._modelMatrix=A.Z.clone(this.modelMatrix),this._clampedModelMatrix=void 0,this.scale=(0,f.Z)(e.scale,1),this._scale=this.scale,this.minimumPixelSize=(0,f.Z)(e.minimumPixelSize,0),this._minimumPixelSize=this.minimumPixelSize,this.maximumScale=e.maximumScale,this._maximumScale=this.maximumScale,this.id=e.id,this._id=e.id,this.heightReference=(0,f.Z)(e.heightReference,de.Z.NONE),this._heightReference=this.heightReference,this._heightChanged=!1,this._removeUpdateHeightCallback=void 0;var c=e.scene;this._scene=c,(0,p.Z)(c)&&(0,p.Z)(c.terrainProviderChanged)&&(this._terrainProviderChangedCallback=c.terrainProviderChanged.addEventListener((function(){this._heightChanged=!0}),this)),this._pickObject=e.pickObject,this._allowPicking=(0,f.Z)(e.allowPicking,!0),this._ready=!1,this._readyPromise=re.Z.defer(),this.activeAnimations=new fe.Z(this),this.clampAnimations=(0,f.Z)(e.clampAnimations,!0),this._defaultTexture=void 0,this._incrementallyLoadTextures=(0,f.Z)(e.incrementallyLoadTextures,!0),this._asynchronous=(0,f.Z)(e.asynchronous,!0),this.shadows=(0,f.Z)(e.shadows,Me.Z.ENABLED),this._shadows=this.shadows,this.color=l.Z.clone((0,f.Z)(e.color,l.Z.WHITE)),this._colorPreviousAlpha=1,this.colorBlendMode=(0,f.Z)(e.colorBlendMode,oe.Z.HIGHLIGHT),this.colorBlendAmount=(0,f.Z)(e.colorBlendAmount,.5),this._colorShadingEnabled=!1,this._clippingPlanes=void 0,this.clippingPlanes=e.clippingPlanes,this._clippingPlanesState=0,this.referenceMatrix=void 0,this.backFaceCulling=(0,f.Z)(e.backFaceCulling,!0),this.showOutline=(0,f.Z)(e.showOutline,!0),this.debugShowBoundingVolume=(0,f.Z)(e.debugShowBoundingVolume,!1),this._debugShowBoundingVolume=!1,this.debugWireframe=(0,f.Z)(e.debugWireframe,!1),this._debugWireframe=!1,this._distanceDisplayCondition=e.distanceDisplayCondition,this._addBatchIdToGeneratedShaders=e.addBatchIdToGeneratedShaders,this._precreatedAttributes=e.precreatedAttributes,this._vertexShaderLoaded=e.vertexShaderLoaded,this._fragmentShaderLoaded=e.fragmentShaderLoaded,this._uniformMapLoaded=e.uniformMapLoaded,this._pickIdLoaded=e.pickIdLoaded,this._ignoreCommands=(0,f.Z)(e.ignoreCommands,!1),this._requestType=e.requestType,this._upAxis=(0,f.Z)(e.upAxis,ie.Z.Y),this._gltfForwardAxis=ie.Z.Z,this._forwardAxis=e.forwardAxis,this.cull=(0,f.Z)(e.cull,!0),this.opaquePass=(0,f.Z)(e.opaquePass,U.Z.OPAQUE),this._computedModelMatrix=new A.Z,this._clippingPlanesMatrix=A.Z.clone(A.Z.IDENTITY),this._iblReferenceFrameMatrix=w.Z.clone(w.Z.IDENTITY),this._initialRadius=void 0,this._boundingSphere=void 0,this._scaledBoundingSphere=new i.Z,this._state=we.NEEDS_LOAD,this._loadResources=void 0,this._mode=void 0,this._perNodeShowDirty=!1,this._cesiumAnimationsDirty=!1,this._dirty=!1,this._maxDirtyNumber=0,this._runtime={animations:void 0,articulationsByName:void 0,articulationsByStageKey:void 0,stagesByKey:void 0,rootNodes:void 0,nodes:void 0,nodesByName:void 0,skinnedNodes:void 0,meshesByName:void 0,materialsByName:void 0,materialsById:void 0},this._uniformMaps={},this._extensionsUsed=void 0,this._extensionsRequired=void 0,this._quantizedUniforms={},this._programPrimitives={},this._rendererResources={buffers:{},vertexArrays:{},programs:{},sourceShaders:{},silhouettePrograms:{},textures:{},samplers:{},renderStates:{}},this._cachedRendererResources=void 0,this._loadRendererResourcesFromCache=!1,this._dequantizeInShader=(0,f.Z)(e.dequantizeInShader,!0),this._decodedData={},this._cachedGeometryByteLength=0,this._cachedTexturesByteLength=0,this._geometryByteLength=0,this._texturesByteLength=0,this._trianglesLength=0,this._pointsLength=0,this._sourceTechniques={},this._sourcePrograms={},this._quantizedVertexShaders={},this._nodeCommands=[],this._pickIds=[],this._rtcCenter=void 0,this._rtcCenterEye=void 0,this._rtcCenter3D=void 0,this._rtcCenter2D=void 0,this._sourceVersion=void 0,this._sourceKHRTechniquesWebGL=void 0,this._imageBasedLightingFactor=new n.Z(1,1),n.Z.clone(e.imageBasedLightingFactor,this._imageBasedLightingFactor),this._lightColor=a.Z.clone(e.lightColor),this._luminanceAtZenith=void 0,this.luminanceAtZenith=(0,f.Z)(e.luminanceAtZenith,.2),this._sphericalHarmonicCoefficients=e.sphericalHarmonicCoefficients,this._specularEnvironmentMaps=e.specularEnvironmentMaps,this._shouldUpdateSpecularMapAtlas=!0,this._specularEnvironmentMapAtlas=void 0,this._useDefaultSphericalHarmonics=!1,this._useDefaultSpecularMaps=!1,this._shouldRegenerateShaders=!1}function Ne(e){return e.stencilBuffer}function De(e){return!l.Z.equals(e.color,l.Z.WHITE)||e.colorBlendMode!==oe.Z.HIGHLIGHT}function Oe(e){var t=e._clippingPlanes;return(0,p.Z)(t)&&t.enabled&&0!==t.length}function Fe(e,t,r){if(e._state!==we.LOADED)throw new g.Z("The model is not loaded.  Use Model.readyPromise or wait for Model.ready to be true.");if(!(0,p.Z)(r))throw new g.Z("name is required.");return e._runtime[t][r]}Object.defineProperties(Be.prototype,{gltf:{get:function(){return(0,p.Z)(this._cachedGltf)?this._cachedGltf.gltf:void 0}},releaseGltfJson:{get:function(){return this._releaseGltfJson}},cacheKey:{get:function(){return this._cacheKey}},basePath:{get:function(){return this._resource.url}},boundingSphere:{get:function(){if(this._state!==we.LOADED)throw new g.Z("The model is not loaded.  Use Model.readyPromise or wait for Model.ready to be true.");var e=this.modelMatrix;this.heightReference!==de.Z.NONE&&this._clampedModelMatrix&&(e=this._clampedModelMatrix);var t=A.Z.getScale(e,Ee),r=(0,p.Z)(this.maximumScale)?Math.min(this.maximumScale,this.scale):this.scale;a.Z.multiplyByScalar(t,r,t);var i=this._scaledBoundingSphere;return i.center=a.Z.multiplyComponents(this._boundingSphere.center,t,i.center),i.radius=a.Z.maximumComponent(t)*this._initialRadius,(0,p.Z)(this._rtcCenter)&&a.Z.add(this._rtcCenter,i.center,i.center),i}},ready:{get:function(){return this._ready}},readyPromise:{get:function(){return this._readyPromise.promise}},asynchronous:{get:function(){return this._asynchronous}},allowPicking:{get:function(){return this._allowPicking}},incrementallyLoadTextures:{get:function(){return this._incrementallyLoadTextures}},pendingTextureLoads:{get:function(){return(0,p.Z)(this._loadResources)?this._loadResources.pendingTextureLoads:0}},dirty:{get:function(){return this._dirty}},distanceDisplayCondition:{get:function(){return this._distanceDisplayCondition},set:function(e){if((0,p.Z)(e)&&e.far<=e.near)throw new g.Z("far must be greater than near");this._distanceDisplayCondition=Z.Z.clone(e,this._distanceDisplayCondition)}},extensionsUsed:{get:function(){return(0,p.Z)(this._extensionsUsed)||(this._extensionsUsed=xe.Z.getUsedExtensions(this.gltf)),this._extensionsUsed}},extensionsRequired:{get:function(){return(0,p.Z)(this._extensionsRequired)||(this._extensionsRequired=xe.Z.getRequiredExtensions(this.gltf)),this._extensionsRequired}},upAxis:{get:function(){return this._upAxis}},forwardAxis:{get:function(){return(0,p.Z)(this._forwardAxis)?this._forwardAxis:this._gltfForwardAxis}},trianglesLength:{get:function(){return this._trianglesLength}},pointsLength:{get:function(){return this._pointsLength}},geometryByteLength:{get:function(){return this._geometryByteLength}},texturesByteLength:{get:function(){return this._texturesByteLength}},cachedGeometryByteLength:{get:function(){return this._cachedGeometryByteLength}},cachedTexturesByteLength:{get:function(){return this._cachedTexturesByteLength}},clippingPlanes:{get:function(){return this._clippingPlanes},set:function(e){e!==this._clippingPlanes&&ae.Z.setOwner(e,this,"_clippingPlanes")}},pickIds:{get:function(){return this._pickIds}},imageBasedLightingFactor:{get:function(){return this._imageBasedLightingFactor},set:function(e){u.Z.typeOf.object("imageBasedLightingFactor",e),u.Z.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.x",e.x,0),u.Z.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.x",e.x,1),u.Z.typeOf.number.greaterThanOrEquals("imageBasedLightingFactor.y",e.y,0),u.Z.typeOf.number.lessThanOrEquals("imageBasedLightingFactor.y",e.y,1);var t=this._imageBasedLightingFactor;e===t||n.Z.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.x>0&&0===e.x||0===this._imageBasedLightingFactor.x&&e.x>0,this._shouldRegenerateShaders=this._shouldRegenerateShaders||this._imageBasedLightingFactor.y>0&&0===e.y||0===this._imageBasedLightingFactor.y&&e.y>0,n.Z.clone(e,this._imageBasedLightingFactor))}},lightColor:{get:function(){return this._lightColor},set:function(e){var t=this._lightColor;e===t||a.Z.equals(e,t)||(this._shouldRegenerateShaders=this._shouldRegenerateShaders||(0,p.Z)(t)&&!(0,p.Z)(e)||(0,p.Z)(e)&&!(0,p.Z)(t),this._lightColor=a.Z.clone(e,t))}},luminanceAtZenith:{get:function(){return this._luminanceAtZenith},set:function(e){var t=this._luminanceAtZenith;e!==t&&(this._shouldRegenerateShaders=this._shouldRegenerateShaders||(0,p.Z)(t)&&!(0,p.Z)(e)||(0,p.Z)(e)&&!(0,p.Z)(t),this._luminanceAtZenith=e)}},sphericalHarmonicCoefficients:{get:function(){return this._sphericalHarmonicCoefficients},set:function(e){if((0,p.Z)(e)&&(!Array.isArray(e)||9!==e.length))throw new g.Z("sphericalHarmonicCoefficients must be an array of 9 Cartesian3 values.");e!==this._sphericalHarmonicCoefficients&&(this._sphericalHarmonicCoefficients=e,this._shouldRegenerateShaders=!0)}},specularEnvironmentMaps:{get:function(){return this._specularEnvironmentMaps},set:function(e){this._shouldUpdateSpecularMapAtlas=this._shouldUpdateSpecularMapAtlas||e!==this._specularEnvironmentMaps,this._specularEnvironmentMaps=e}},credit:{get:function(){return this._credit}}}),Be.silhouetteSupported=function(e){return Ne(e.context)},Be.fromGltf=function(e){if(!(0,p.Z)(e)||!(0,p.Z)(e.url))throw new g.Z("options.url is required");var t=e.url;e=(0,c.Z)(e);var r=I.Z.createIfNeeded(t),i=(0,f.Z)(e.basePath,r.clone()),n=I.Z.createIfNeeded(i),a=(0,f.Z)(e.cacheKey,Ie[(0,x.Z)(r.url)]);(0,p.Z)(a)||(a=(0,h.Z)(),Ie[(0,x.Z)(r.url)]=a),(0,p.Z)(e.basePath)&&!(0,p.Z)(e.cacheKey)&&(a+=n.url),e.cacheKey=a,e.basePath=n;var o=new Be(e),s=Le[a];return(0,p.Z)(s)?s.ready||(++s.count,s.modelsToLoad.push(o)):((s=new Pe({ready:!1})).count=1,s.modelsToLoad.push(o),Te(o,s),Le[a]=s,(0,p.Z)(r.headers.Accept)||(r.headers.Accept="model/gltf-binary,model/gltf+json;q=0.8,application/json;q=0.2,*/*;q=0.01"),r.fetchArrayBuffer().then((function(e){var t,i=new Uint8Array(e);if(t=i,"glTF"===(0,S.Z)(t)){var n=(0,ee.Z)(i);s.makeReady(n)}else{var a=(0,y.Z)(i);s.makeReady(a)}var u=o._resourceCredits,c=r.credits;if((0,p.Z)(c))for(var l=c.length,d=0;d<l;d++)u.push(c[d])})).otherwise(xe.Z.getFailedLoadFunction(o,"model",r.url))),o},Be._gltfCache=Le,Be.prototype.getNode=function(e){var t=Fe(this,"nodesByName",e);return(0,p.Z)(t)?t.publicNode:void 0},Be.prototype.getMesh=function(e){return Fe(this,"meshesByName",e)},Be.prototype.getMaterial=function(e){return Fe(this,"materialsByName",e)},Be.prototype.setArticulationStage=function(e,t){u.Z.typeOf.number("value",t);var r=Fe(this,"stagesByKey",e),i=Fe(this,"articulationsByStageKey",e);(0,p.Z)(r)&&(0,p.Z)(i)&&(t=E.Z.clamp(t,r.minimumValue,r.maximumValue),E.Z.equalsEpsilon(r.currentValue,t,Ae)||(r.currentValue=t,i.isDirty=!0))};var Ue=new a.Z,qe=new w.Z;function ze(e,t){u.Z.typeOf.object("stage",e),u.Z.typeOf.object("result",t);var r,i=e.currentValue,n=Ue;switch(e.type){case"xRotate":r=w.Z.fromRotationX(E.Z.toRadians(i),qe),A.Z.multiplyByMatrix3(t,r,t);break;case"yRotate":r=w.Z.fromRotationY(E.Z.toRadians(i),qe),A.Z.multiplyByMatrix3(t,r,t);break;case"zRotate":r=w.Z.fromRotationZ(E.Z.toRadians(i),qe),A.Z.multiplyByMatrix3(t,r,t);break;case"xTranslate":n.x=i,n.y=0,n.z=0,A.Z.multiplyByTranslation(t,n,t);break;case"yTranslate":n.x=0,n.y=i,n.z=0,A.Z.multiplyByTranslation(t,n,t);break;case"zTranslate":n.x=0,n.y=0,n.z=i,A.Z.multiplyByTranslation(t,n,t);break;case"xScale":n.x=i,n.y=1,n.z=1,A.Z.multiplyByScale(t,n,t);break;case"yScale":n.x=1,n.y=i,n.z=1,A.Z.multiplyByScale(t,n,t);break;case"zScale":n.x=1,n.y=1,n.z=i,A.Z.multiplyByScale(t,n,t);break;case"uniformScale":A.Z.multiplyByUniformScale(t,i,t)}return t}var Ve=new A.Z;function ke(e,t){return function(r){var i=e._loadResources,n=new Uint8Array(r);--i.pendingBufferLoads,e.gltf.buffers[t].extras._pipeline.source=n}}function He(e,t){return function(r){var i,n=e._loadResources;--n.pendingTextureLoads,Array.isArray(r)&&(i=r.slice(1,r.length).map((function(e){return e.bufferView})),r=r[0]),n.texturesToCreate.enqueue({id:t,image:r,bufferView:r.bufferView,width:r.width,height:r.height,internalFormat:r.internalFormat,mipLevels:i})}}Be.prototype.applyArticulations=function(){var e=this._runtime.articulationsByName;for(var t in e)if(e.hasOwnProperty(t)){var r=e[t];if(r.isDirty){r.isDirty=!1;for(var i=r.nodes.length,n=0;n<i;++n){for(var a=r.nodes[n],o=A.Z.clone(a.originalMatrix,Ve),s=r.stages.length,u=0;u<s;++u){o=ze(r.stages[u],o)}a.matrix=o}}}};var Ge=/(^data:image\/ktx2)|(\.ktx2$)/i;var We=new A.Z;var Ke=function(){this.id=void 0,this.model=void 0,this.context=void 0};function je(e,t,r){var i=t._loadResources,n=t.gltf.bufferViews[e];(0,p.Z)(n)||(n=i.createdBufferViews[e]);var a=D.Z.createVertexBuffer({context:r,typedArray:i.getBuffer(n),usage:O.Z.STATIC_DRAW});a.vertexArrayDestroyable=!1,t._rendererResources.buffers[e]=a,t._geometryByteLength+=a.sizeInBytes}Ke.prototype.set=function(e,t,r){this.id=e,this.model=t,this.context=r},Ke.prototype.execute=function(){je(this.id,this.model,this.context)};var Ye=function(){this.id=void 0,this.componentType=void 0,this.model=void 0,this.context=void 0};function Je(e,t,r,i){var n=r._loadResources,a=r.gltf.bufferViews[e];(0,p.Z)(a)||(a=n.createdBufferViews[e]);var o=D.Z.createIndexBuffer({context:i,typedArray:n.getBuffer(a),usage:O.Z.STATIC_DRAW,indexDatatype:t});o.vertexArrayDestroyable=!1,r._rendererResources.buffers[e]=o,r._geometryByteLength+=o.sizeInBytes}Ye.prototype.set=function(e,t,r,i){this.id=e,this.componentType=t,this.model=r,this.context=i},Ye.prototype.execute=function(){Je(this.id,this.componentType,this.model,this.context)};var Xe=new Ke,Qe=new Ye;function $e(e,t){var r=e._runtime.materialsById[t.material];if((0,p.Z)(r))return r._program}function et(e,t,r){var i,n,a,o=r._programPrimitives[t];if(!(0,p.Z)(o))return e;for(n in o)if(o.hasOwnProperty(n)&&$e(r,i=o[n])===t)break;if(r._programPrimitives[t]=void 0,r.extensionsUsed.WEB3D_quantized_attributes)a=xe.Z.modifyShaderForQuantizedAttributes(r.gltf,i,e),r._quantizedUniforms[t]=a.uniforms;else{var s=r._decodedData[n];if(!(0,p.Z)(s))return e;a=xe.Z.modifyShaderForDracoQuantizedAttributes(r.gltf,i,e,s.attributes)}return a.shader}function tt(e,t,r){return(0,p.Z)(r)&&(e=r(e,t)),e}var rt=function(){this.programToCreate=void 0,this.model=void 0,this.context=void 0};function it(e,t,r){var i=e.programId,n=e.techniqueId,a=t._sourcePrograms[i],o=t._rendererResources.sourceShaders,s=o[a.vertexShader],u=o[a.fragmentShader],c=t._quantizedVertexShaders;if(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader){var l=c[i];(0,p.Z)(l)||(l=et(s,i,t),c[i]=l),s=l}var d=tt(s,i,t._vertexShaderLoaded),h=tt(u,i,t._fragmentShaderLoaded);(0,p.Z)(t._uniformMapLoaded)||(h="uniform vec4 czm_pickColor;\n"+h);var m=t._imageBasedLightingFactor.x>0||t._imageBasedLightingFactor.y>0;if(m&&(h="#define USE_IBL_LIGHTING \n\n"+h),(0,p.Z)(t._lightColor)&&(h="#define USE_CUSTOM_LIGHT_COLOR \n\n"+h),("2.0"!==t._sourceVersion||t._sourceKHRTechniquesWebGL)&&(h=k.Z.replaceMain(h,"non_gamma_corrected_main"),h+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),ye.Z.isSupported(r)){var f=(0,p.Z)(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,_=(0,p.Z)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps;(f||_||m)&&(h="uniform mat3 gltf_iblReferenceFrameMatrix; \n"+h),(0,p.Z)(t._sphericalHarmonicCoefficients)?h="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+h:t._useDefaultSphericalHarmonics&&(h="#define DIFFUSE_IBL \n"+h),(0,p.Z)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?h="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+h:t._useDefaultSpecularMaps&&(h="#define SPECULAR_IBL \n"+h)}(0,p.Z)(t._luminanceAtZenith)&&(h="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+h),at(i,n,h,d,t,r)}function nt(e,t,r){var i=e.programId,n=e.techniqueId,a=t._sourcePrograms[i],o=t._rendererResources.sourceShaders,s=t._quantizedVertexShaders,u=t.clippingPlanes,c=Oe(t),l=o[a.vertexShader],d=o[a.fragmentShader];(t.extensionsUsed.WEB3D_quantized_attributes||t._dequantizeInShader)&&(l=s[i]);var h=d;De(t)&&(h=Be._modifyShaderForColor(h)),c&&(h=function(e,t,r){return e=k.Z.replaceMain(e,"gltf_clip_main"),e+=Be._getClippingFunction(t,r)+"\n",e+="uniform highp sampler2D gltf_clippingPlanes; \nuniform mat4 gltf_clippingPlanesMatrix; \nuniform vec4 gltf_clippingPlanesEdgeStyle; \nvoid main() \n{ \n    gltf_clip_main(); \n"+(0,ce.Z)("gltf_clippingPlanes","gltf_clippingPlanesMatrix","gltf_clippingPlanesEdgeStyle")+"} \n"}(h,u,r));var m=tt(l,i,t._vertexShaderLoaded),f=tt(h,i,t._fragmentShaderLoaded);(0,p.Z)(t._uniformMapLoaded)||(f="uniform vec4 czm_pickColor;\n"+f);var _=t._imageBasedLightingFactor.x>0||t._imageBasedLightingFactor.y>0;if(_&&(f="#define USE_IBL_LIGHTING \n\n"+f),(0,p.Z)(t._lightColor)&&(f="#define USE_CUSTOM_LIGHT_COLOR \n\n"+f),("2.0"!==t._sourceVersion||t._sourceKHRTechniquesWebGL)&&(f=k.Z.replaceMain(f,"non_gamma_corrected_main"),f+="\nvoid main() { \n    non_gamma_corrected_main(); \n    gl_FragColor = czm_gammaCorrect(gl_FragColor); \n} \n"),ye.Z.isSupported(r)){var g=(0,p.Z)(t._sphericalHarmonicCoefficients)||t._useDefaultSphericalHarmonics,Z=(0,p.Z)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready||t._useDefaultSpecularMaps;(g||Z||_)&&(f="uniform mat3 gltf_iblReferenceFrameMatrix; \n"+f),(0,p.Z)(t._sphericalHarmonicCoefficients)?f="#define DIFFUSE_IBL \n#define CUSTOM_SPHERICAL_HARMONICS \nuniform vec3 gltf_sphericalHarmonicCoefficients[9]; \n"+f:t._useDefaultSphericalHarmonics&&(f="#define DIFFUSE_IBL \n"+f),(0,p.Z)(t._specularEnvironmentMapAtlas)&&t._specularEnvironmentMapAtlas.ready?f="#define SPECULAR_IBL \n#define CUSTOM_SPECULAR_IBL \nuniform sampler2D gltf_specularMap; \nuniform vec2 gltf_specularMapSize; \nuniform float gltf_maxSpecularLOD; \n"+f:t._useDefaultSpecularMaps&&(f="#define SPECULAR_IBL \n"+f)}(0,p.Z)(t._luminanceAtZenith)&&(f="#define USE_SUN_LUMINANCE \nuniform float gltf_luminanceAtZenith;\n"+f),at(i,n,f,m,t,r)}function at(e,t,r,i,n,a){var o=n._sourceTechniques[t],s=xe.Z.createAttributeLocations(o,n._precreatedAttributes);n._rendererResources.programs[e]=V.Z.fromCache({context:a,vertexShaderSource:i,fragmentShaderSource:r,attributeLocations:s})}rt.prototype.set=function(e,t,r){this.programToCreate=e,this.model=t,this.context=r},rt.prototype.execute=function(){it(this.programToCreate,this.model,this.context)};var ot=new rt;function st(e,t){return function(r){e.texturesToCreate.enqueue({id:t.id,image:r,bufferView:void 0}),--e.pendingBufferViewToImage}}var ut=function(){this.gltfTexture=void 0,this.model=void 0,this.context=void 0};function ct(e,t,r){var i=t.gltf.textures[e.id],n=t._rendererResources.samplers[i.sampler];(0,p.Z)(n)||(n=new z.Z({wrapS:W.Z.REPEAT,wrapT:W.Z.REPEAT}));for(var a=!1,o=t.gltf.materials,s=o.length,u=0;u<s;++u){var c=o[u];if((0,p.Z)(c.extensions)&&(0,p.Z)(c.extensions.KHR_techniques_webgl)){var l=c.extensions.KHR_techniques_webgl.values;for(var d in l)if(l.hasOwnProperty(d)&&-1!==d.indexOf("Texture")){var h=l[d];if(h.index===e.id&&(0,p.Z)(h.extensions)&&(0,p.Z)(h.extensions.KHR_texture_transform)){a=!0;break}}}if(a)break}var m=n.wrapS,f=n.wrapT,_=n.minificationFilter;a&&_!==G.Z.LINEAR&&_!==G.Z.NEAREST&&(_=_===G.Z.NEAREST_MIPMAP_NEAREST||_===G.Z.NEAREST_MIPMAP_LINEAR?G.Z.NEAREST:G.Z.LINEAR,n=new z.Z({wrapS:n.wrapS,wrapT:n.wrapT,minificationFilter:_,magnificationFilter:n.magnificationFilter}));var g,Z,v=e.internalFormat,x=!((0,p.Z)(v)&&T.Z.isCompressedFormat(v)||_!==G.Z.NEAREST_MIPMAP_NEAREST&&_!==G.Z.NEAREST_MIPMAP_LINEAR&&_!==G.Z.LINEAR_MIPMAP_NEAREST&&_!==G.Z.LINEAR_MIPMAP_LINEAR),y=x||m===W.Z.REPEAT||m===W.Z.MIRRORED_REPEAT||f===W.Z.REPEAT||f===W.Z.MIRRORED_REPEAT,S=e.image;if((0,p.Z)(v)){g=!E.Z.isPowerOfTwo(e.width)||!E.Z.isPowerOfTwo(e.height),!r.webgl2&&T.Z.isCompressedFormat(v)&&g&&y&&console.warn("Compressed texture uses REPEAT or MIRRORED_REPEAT texture wrap mode and dimensions are not powers of two. The texture may be rendered incorrectly. See the Model.js constructor documentation for more information.");var R=n.minificationFilter;(0,p.Z)(e.mipLevels)||_!==G.Z.NEAREST_MIPMAP_NEAREST&&_!==G.Z.NEAREST_MIPMAP_LINEAR?(0,p.Z)(e.mipLevels)||_!==G.Z.LINEAR_MIPMAP_NEAREST&&_!==G.Z.LINEAR_MIPMAP_LINEAR||(R=G.Z.LINEAR):R=G.Z.NEAREST,n=new z.Z({wrapS:n.wrapS,wrapT:n.wrapT,minificationFilter:R,magnificationFilter:n.magnificationFilter}),Z=new H.Z({context:r,source:{arrayBufferView:e.bufferView,mipLevels:e.mipLevels},width:e.width,height:e.height,pixelFormat:v,sampler:n})}else if((0,p.Z)(S)){if(g=!E.Z.isPowerOfTwo(S.width)||!E.Z.isPowerOfTwo(S.height),y&&g){var C=document.createElement("canvas");C.width=E.Z.nextPowerOfTwo(S.width),C.height=E.Z.nextPowerOfTwo(S.height),C.getContext("2d").drawImage(S,0,0,S.width,S.height,0,0,C.width,C.height),S=C}Z=new H.Z({context:r,source:S,pixelFormat:i.internalFormat,pixelDatatype:i.type,sampler:n,flipY:!1,skipColorSpaceConversion:!0}),x&&Z.generateMipmap()}(0,p.Z)(Z)&&(t._rendererResources.textures[e.id]=Z,t._texturesByteLength+=Z.sizeInBytes)}ut.prototype.set=function(e,t,r){this.gltfTexture=e,this.model=t,this.context=r},ut.prototype.execute=function(){ct(this.gltfTexture,this.model,this.context)};var lt=new ut;function dt(e,t,r,i){return function(n){(0,p.Z)(i)&&(n=e.clampAnimations?i.clampTime(n):i.wrapTime(n),t[r]=i.evaluate(n,t[r]),t.dirtyNumber=e._maxDirtyNumber)}}function ht(e,t){var r=e._loadResources;if(r.finishedBuffersCreation()&&r.finishedProgramCreation()&&r.createVertexArrays){r.createVertexArrays=!1;var i=e._rendererResources.buffers,n=e._rendererResources.vertexArrays,a=e.gltf,o=a.accessors;J.Z.mesh(a,(function(r,s){J.Z.meshPrimitive(r,(function(r,u){var c,l,d,h=[],m=function(e,t){var r,i,n=e._sourceTechniques,a={},o=e._runtime.materialsById[t.material];if(!(0,p.Z)(o))return a;var s=n[o._technique];if(!(0,p.Z)(s))return a;var u=s.attributes,c=e._rendererResources.programs[s.program]._attributeLocations;for(r in c)if(c.hasOwnProperty(r)){var l=u[r];(0,p.Z)(l)&&(i=c[r],a[l.semantic]=i)}var d=e._precreatedAttributes;if((0,p.Z)(d))for(r in d)d.hasOwnProperty(r)&&(i=c[r],a[r]=i);return a}(e,r),f=e._decodedData[s+".primitive."+u];J.Z.meshPrimitiveAttribute(r,(function(e,t){if(c=m[t],(0,p.Z)(c)){if((0,p.Z)(f)){var r=f.attributes;if(r.hasOwnProperty(t)){var n=r[t];return void h.push({index:c,vertexBuffer:i[n.bufferView],componentsPerAttribute:n.componentsPerAttribute,componentDatatype:n.componentDatatype,normalize:n.normalized,offsetInBytes:n.byteOffset,strideInBytes:n.byteStride})}}var s=o[e],u=(0,p.Z)(s.normalized)&&s.normalized;h.push({index:c,vertexBuffer:i[s.bufferView],componentsPerAttribute:(0,$.Z)(s.type),componentDatatype:s.componentType,normalize:u,offsetInBytes:s.byteOffset,strideInBytes:(0,X.Z)(a,s)})}}));var _,g=e._precreatedAttributes;if((0,p.Z)(g))for(d in g)g.hasOwnProperty(d)&&(c=m[d],(0,p.Z)(c)&&((l=g[d]).index=c,h.push(l)));if((0,p.Z)(r.indices)){var Z=o[r.indices].bufferView;(0,p.Z)(f)&&(Z=f.bufferView),_=i[Z]}n[s+".primitive."+u]=new K.Z({context:t,attributes:h,indexBuffer:_})}))}))}}function mt(e){var t=e._loadResources;t.createRenderStates&&(t.createRenderStates=!1,J.Z.material(e.gltf,(function(t,r){!function(e,t,r){var i=e._rendererResources.renderStates,n=[N.Z.FUNC_ADD,N.Z.FUNC_ADD],a=[N.Z.ONE,N.Z.ONE_MINUS_SRC_ALPHA,N.Z.ONE,N.Z.ONE_MINUS_SRC_ALPHA];(0,p.Z)(t.extensions)&&(0,p.Z)(t.extensions.KHR_blend)&&(n=t.extensions.KHR_blend.blendEquation,a=t.extensions.KHR_blend.blendFactors);var o=!t.doubleSided,s="BLEND"===t.alphaMode;i[r]=q.Z.fromCache({cull:{enabled:o},depthTest:{enabled:!0,func:se.Z.LESS_OR_EQUAL},depthMask:!s,blending:{enabled:s,equationRgb:n[0],equationAlpha:n[1],functionSourceRgb:a[0],functionDestinationRgb:a[1],functionSourceAlpha:a[2],functionDestinationAlpha:a[3]}})}(e,t,r)})))}var ft={MODEL:function(e,t,r){return function(){return r.computedMatrix}},VIEW:function(e,t,r){return function(){return e.view}},PROJECTION:function(e,t,r){return function(){return e.projection}},MODELVIEW:function(e,t,r){var i=new A.Z;return function(){return A.Z.multiplyTransformation(e.view,r.computedMatrix,i)}},CESIUM_RTC_MODELVIEW:function(e,t,r){var i=new A.Z;return function(){return A.Z.multiplyTransformation(e.view,r.computedMatrix,i),A.Z.setTranslation(i,t._rtcCenterEye,i)}},MODELVIEWPROJECTION:function(e,t,r){var i=new A.Z;return function(){return A.Z.multiplyTransformation(e.view,r.computedMatrix,i),A.Z.multiply(e._projection,i,i)}},MODELINVERSE:function(e,t,r){var i=new A.Z;return function(){return A.Z.inverse(r.computedMatrix,i)}},VIEWINVERSE:function(e,t){return function(){return e.inverseView}},PROJECTIONINVERSE:function(e,t,r){return function(){return e.inverseProjection}},MODELVIEWINVERSE:function(e,t,r){var i=new A.Z,n=new A.Z;return function(){return A.Z.multiplyTransformation(e.view,r.computedMatrix,i),A.Z.inverse(i,n)}},MODELVIEWPROJECTIONINVERSE:function(e,t,r){var i=new A.Z,n=new A.Z;return function(){return A.Z.multiplyTransformation(e.view,r.computedMatrix,i),A.Z.multiply(e._projection,i,i),A.Z.inverse(i,n)}},MODELINVERSETRANSPOSE:function(e,t,r){var i=new A.Z,n=new w.Z;return function(){return A.Z.inverse(r.computedMatrix,i),A.Z.getMatrix3(i,n),w.Z.transpose(n,n)}},MODELVIEWINVERSETRANSPOSE:function(e,t,r){var i=new A.Z,n=new A.Z,a=new w.Z;return function(){return A.Z.multiplyTransformation(e.view,r.computedMatrix,i),A.Z.inverse(i,n),A.Z.getMatrix3(n,a),w.Z.transpose(a,a)}},VIEWPORT:function(e,t,r){return function(){return e.viewportCartesian4}}};function pt(e,t,r,i,n,a,o){var s,u,c={},l={};return J.Z.techniqueUniform(r,(function(r,d){var h;if((0,p.Z)(i)&&(0,p.Z)(i[d]))h=xe.Z.createUniformFunction(r.type,i[d],a,o),c[d]=h.func,l[d]=h;else if((0,p.Z)(r.node))c[d]=function(e,t,r,i){var n=t._runtime.nodes[e];return ft[r](i,t,n)}(r.node,e,r.semantic,n.uniformState);else if((0,p.Z)(r.semantic))if("JOINTMATRIX"===r.semantic)s=d;else if("MORPHWEIGHTS"===r.semantic)u=d;else if("ALPHACUTOFF"===r.semantic){var m=t.alphaMode;if((0,p.Z)(m)&&"MASK"===m){var _=(0,f.Z)(t.alphaCutoff,.5);h=xe.Z.createUniformFunction(r.type,_,a,o),c[d]=h.func,l[d]=h}}else c[d]=xe.Z.getGltfSemanticUniforms()[r.semantic](n.uniformState,e);else if((0,p.Z)(r.value)){var g=xe.Z.createUniformFunction(r.type,r.value,a,o);c[d]=g.func,l[d]=g}})),{map:c,values:l,jointMatrixUniformName:s,morphWeightsUniformName:u}}function _t(e){return xe.Z.createUniformsForDracoQuantizedAttributes(e.attributes)}function gt(e,t){var r=$e(e,t),i=e._quantizedUniforms[r];return xe.Z.createUniformsForQuantizedAttributes(e.gltf,t,i)}function Zt(e){return function(){return e}}function vt(e){return function(){return e.computedJointMatrices}}function xt(e){return function(){return e.weights}}function yt(e){return function(){return e.silhouetteColor}}function St(e){return function(){return e.silhouetteSize}}function Rt(e){return function(){return e.color}}function Ct(e){return function(){return e._clippingPlanesMatrix}}function Mt(e){return function(){return e._iblReferenceFrameMatrix}}function bt(e){return function(){var t=e.clippingPlanes;return(0,p.Z)(t)&&t.enabled?t.texture:e._defaultTexture}}function Et(e){return function(){var t=e.clippingPlanes;if(!(0,p.Z)(t))return l.Z.WHITE.withAlpha(0);var r=l.Z.clone(t.edgeColor);return r.alpha=t.edgeWidth,r}}function wt(e){return function(){return oe.Z.getColorBlend(e.colorBlendMode,e.colorBlendAmount)}}function At(e){return function(){return e._imageBasedLightingFactor}}function Tt(e){return function(){return e._lightColor}}function Pt(e){return function(){return e.luminanceAtZenith}}function Lt(e){return function(){return e._sphericalHarmonicCoefficients}}function It(e){return function(){return e._specularEnvironmentMapAtlas.texture}}function Bt(e){return function(){return e._specularEnvironmentMapAtlas.texture.dimensions}}function Nt(e){return function(){return e._specularEnvironmentMapAtlas.maximumMipmapLevel}}function Dt(e,t){switch(e.mode){case P.Z.TRIANGLES:return t/3;case P.Z.TRIANGLE_STRIP:case P.Z.TRIANGLE_FAN:return Math.max(t-2,0);default:return 0}}function Ot(e,t,r,n,o){for(var s=e._nodeCommands,u=e._pickIds,c=e.allowPicking,l=e._runtime.meshesByName,h=e._rendererResources,m=h.vertexArrays,f=h.programs,_=h.renderStates,g=e._uniformMaps,Z=e.gltf,v=Z.accessors,x=Z.meshes,y=t.mesh,S=x[y],R=S.primitives,M=R.length,b=0;b<M;++b){var E=R[b],w=v[E.indices],T=e._runtime.materialsById[E.material]._program,L=e._decodedData[y+".primitive."+b],I=void 0,B=E.attributes.POSITION;if((0,p.Z)(B)){var N=xe.Z.getAccessorMinMax(Z,B);I=i.Z.fromCornerPoints(a.Z.fromArray(N.min),a.Z.fromArray(N.max))}var D=m[y+".primitive."+b],O=void 0,q=void 0;if((0,p.Z)(L))q=L.numberOfIndices,O=0;else if((0,p.Z)(w))q=w.count,O=w.byteOffset/C.Z.getSizeInBytes(w.componentType);else{q=v[E.attributes.POSITION].count,O=0}e._trianglesLength+=Dt(E,q),E.mode===P.Z.POINTS&&(e._pointsLength+=q);var z=g[E.material],V=z.uniformMap;if((0,p.Z)(z.jointMatrixUniformName)){var k={};k[z.jointMatrixUniformName]=vt(r),V=(0,d.Z)(V,k)}if((0,p.Z)(z.morphWeightsUniformName)){var H={};H[z.morphWeightsUniformName]=xt(r),V=(0,d.Z)(V,H)}V=(0,d.Z)(V,{gltf_color:Rt(e),gltf_colorBlend:wt(e),gltf_clippingPlanes:bt(e),gltf_clippingPlanesEdgeStyle:Et(e),gltf_clippingPlanesMatrix:Ct(e),gltf_iblReferenceFrameMatrix:Mt(e),gltf_iblFactor:At(e),gltf_lightColor:Tt(e),gltf_sphericalHarmonicCoefficients:Lt(e),gltf_specularMap:It(e),gltf_specularMapSize:Bt(e),gltf_maxSpecularLOD:Nt(e),gltf_luminanceAtZenith:Pt(e)}),(0,p.Z)(e._uniformMapLoaded)&&(V=e._uniformMapLoaded(V,T,r));var G={};e.extensionsUsed.WEB3D_quantized_attributes?G=gt(e,E):e._dequantizeInShader&&(0,p.Z)(L)&&(G=_t(L)),V=(0,d.Z)(V,G);var W=_[E.material],K=W.blending.enabled,j=e._pickObject;(0,p.Z)(j)||(j={primitive:e,id:e.id,node:r.publicNode,mesh:l[S.name]});var Y=Me.Z.castShadows(e._shadows),J=Me.Z.receiveShadows(e._shadows),X=void 0;if(c&&!(0,p.Z)(e._uniformMapLoaded)){X=n.createPickId(j),u.push(X);var Q={czm_pickColor:Zt(X.color)};V=(0,d.Z)(V,Q)}c&&(X=(0,p.Z)(e._pickIdLoaded)&&(0,p.Z)(e._uniformMapLoaded)?e._pickIdLoaded():"czm_pickColor");var $=new F.Z({boundingVolume:new i.Z,cull:e.cull,modelMatrix:new A.Z,primitiveType:E.mode,vertexArray:D,count:q,offset:O,shaderProgram:f[T],castShadows:Y,receiveShadows:J,uniformMap:V,renderState:W,owner:j,pass:K?U.Z.TRANSLUCENT:e.opaquePass,pickId:X}),ee=void 0;o||((ee=F.Z.shallowClone($)).boundingVolume=new i.Z,ee.modelMatrix=new A.Z);var te={show:!0,boundingSphere:I,command:$,command2D:ee,silhouetteModelCommand:void 0,silhouetteModelCommand2D:void 0,silhouetteColorCommand:void 0,silhouetteColorCommand2D:void 0,translucentCommand:void 0,translucentCommand2D:void 0,disableCullingCommand:void 0,disableCullingCommand2D:void 0,programId:T};r.commands.push(te),s.push(te)}}function Ft(e,t){var r=t.context,i=t.scene3DOnly,n=e._quantizedVertexShaders,o=e._sourceTechniques,s=e._sourcePrograms,u=e._rendererResources,c=u.sourceShaders;for(var l in e._loadRendererResourcesFromCache&&(c=u.sourceShaders=e._cachedRendererResources.sourceShaders),o)if(o.hasOwnProperty(l)){var d=o[l].program,h=s[d],m=c[h.vertexShader];if(xe.Z.checkSupportedGlExtensions(h.glExtensions,r),e.extensionsUsed.WEB3D_quantized_attributes||e._dequantizeInShader){var f=n[d];(0,p.Z)(f)||(f=et(m,d,e),n[d]=f),m=f}m=tt(m,d,e._vertexShaderLoaded)}if(e._loadRendererResourcesFromCache){var _=e._cachedRendererResources;u.buffers=_.buffers,u.vertexArrays=_.vertexArrays,u.programs=_.programs,u.silhouettePrograms=_.silhouettePrograms,u.textures=_.textures,u.samplers=_.samplers,u.renderStates=_.renderStates,(0,p.Z)(e._precreatedAttributes)&&ht(e,r),e._cachedGeometryByteLength+=function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&(t+=e[r].sizeInBytes);return t}(_.buffers),e._cachedTexturesByteLength+=function(e){var t=0;for(var r in e)e.hasOwnProperty(r)&&(t+=e[r].sizeInBytes);return t}(_.textures)}else!function(e,t){var r=e._loadResources;if(0===r.pendingBufferLoads){var i,n=t.context,a=r.vertexBuffersToCreate,o=r.indexBuffersToCreate;if(e.asynchronous){for(;a.length>0&&(Xe.set(a.peek(),e,n),t.jobScheduler.execute(Xe,he.Z.BUFFER));)a.dequeue();for(;o.length>0&&(i=o.peek(),Qe.set(i.id,i.componentType,e,n),t.jobScheduler.execute(Qe,he.Z.BUFFER));)o.dequeue()}else{for(;a.length>0;)je(a.dequeue(),e,n);for(;o.length>0;)Je((i=o.dequeue()).id,i.componentType,e,n)}}}(e,t),function(e,t){var r=e._loadResources,i=r.programsToCreate;if(0===r.pendingShaderLoads&&0===r.pendingBufferLoads){var n=t.context;if(e.asynchronous)for(;i.length>0&&(ot.set(i.peek(),e,n),t.jobScheduler.execute(ot,he.Z.PROGRAM));)i.dequeue();else for(;i.length>0;)it(i.dequeue(),e,n)}}(e,t),function(e){var t=e._loadResources;if(t.createSamplers){t.createSamplers=!1;var r=e._rendererResources.samplers;J.Z.sampler(e.gltf,(function(e,t){r[t]=new z.Z({wrapS:e.wrapS,wrapT:e.wrapT,minificationFilter:e.minFilter,magnificationFilter:e.magFilter})}))}}(e),function(e){var t=e._loadResources;if(0===t.pendingBufferLoads)for(;t.texturesToCreateFromBufferView.length>0;){var r=t.texturesToCreateFromBufferView.dequeue(),i=e.gltf,n=i.bufferViews[r.bufferView],a=(i.textures[r.id].source,xe.Z.getFailedLoadFunction(e,"image","id: "+r.id+", bufferView: "+r.bufferView));if("image/ktx2"===r.mimeType){var o=new Uint8Array(t.getBuffer(n));(0,b.Z)(o).then(He(e,r.id)).otherwise(a),++e._loadResources.pendingTextureLoads}else{var s=st(t,r);(0,M.Z)({uint8Array:t.getBuffer(n),format:r.mimeType,flipY:!1,skipColorSpaceConversion:!0}).then(s).otherwise(a),++t.pendingBufferViewToImage}}}(e),function(e,t){var r=t.context,i=e._loadResources.texturesToCreate;if(e.asynchronous)for(;i.length>0&&(lt.set(i.peek(),e,r),t.jobScheduler.execute(lt,he.Z.TEXTURE));)i.dequeue();else for(;i.length>0;)ct(i.dequeue(),e,r)}(e,t);!function(e){var t=e._loadResources;if(0===t.pendingBufferLoads&&t.createSkins){t.createSkins=!1;var r=e.gltf,i=r.accessors,n={};J.Z.skin(r,(function(t,r){var a,o=i[t.inverseBindMatrices];A.Z.equals(t.bindShapeMatrix,A.Z.IDENTITY)||(a=A.Z.clone(t.bindShapeMatrix)),n[r]={inverseBindMatrices:me.Z.getSkinInverseBindMatrices(e,o),bindShapeMatrix:a}})),function(e,t){for(var r=e.gltf,i=r.skins,n=r.nodes,a=e._runtime.nodes,o=e._loadResources.skinnedNodesIds,s=o.length,u=0;u<s;++u){var c=o[u],l=a[c],d=n[c],h=t[d.skin];l.inverseBindMatrices=h.inverseBindMatrices,l.bindShapeMatrix=h.bindShapeMatrix;for(var m=i[d.skin].joints,f=m.length,p=0;p<f;++p){var _=a[m[p]];l.joints.push(_)}}}(e,n)}}(e),function(e){var t=e._loadResources;if(t.finishedPendingBufferLoads()&&t.createRuntimeAnimations){t.createRuntimeAnimations=!1,e._runtime.animations=[];var r=e._runtime.nodes,i=e.gltf.accessors;J.Z.animation(e.gltf,(function(t,n){for(var a=t.channels,o=t.samplers,s=Number.MAX_VALUE,u=-Number.MAX_VALUE,c=a.length,l=new Array(c),d=0;d<c;++d){var h=a[d],m=h.target,f=m.path,p=o[h.sampler],_=me.Z.getAnimationParameterValues(e,i[p.input]),g=me.Z.getAnimationParameterValues(e,i[p.output]);s=Math.min(s,_[0]),u=Math.max(u,_[_.length-1]);var Z=me.Z.getAnimationSpline(e,n,t,h.sampler,p,_,f,g);l[d]=dt(e,r[m.node],m.path,Z)}e._runtime.animations[n]={name:t.name,startTime:s,stopTime:u,channelEvaluators:l}}))}}(e),e._loadRendererResourcesFromCache||(ht(e,r),mt(e)),function(e,t){var r=e._loadResources;if(r.finishedProgramCreation()&&r.createUniformMaps){r.createUniformMaps=!1;var i=e.gltf,n=e._sourceTechniques,a=e._uniformMaps,o=e._rendererResources.textures,s=e._defaultTexture;J.Z.material(i,(function(r,i){var u=e._runtime.materialsById[i],c=n[u._technique],l=u._values,d=pt(e,r,c,l,t,o,s),h=a[i];if(h.uniformMap=d.map,h.values=d.values,h.jointMatrixUniformName=d.jointMatrixUniformName,h.morphWeightsUniformName=d.morphWeightsUniformName,(0,p.Z)(c.attributes.a_outlineCoordinates)){var m=ve.Z.createTexture(e,t);h.uniformMap.u_outlineTexture=function(){return m}}}))}}(e,r),function(e,t,r){var i=e._loadResources;if(i.finishedEverythingButTextureCreation()&&i.createRuntimeNodes){i.createRuntimeNodes=!1;for(var n=[],o=e._runtime.nodes,s=e.gltf,u=s.nodes,c=s.scenes[s.scene].nodes,l=c.length,d=[],h={},m=0;m<l;++m)for(d.push({parentRuntimeNode:void 0,gltfNode:u[c[m]],id:c[m]});d.length>0;){var f=d.pop();h[f.id]=!0;var _=f.parentRuntimeNode,g=f.gltfNode,Z=o[f.id];if(0===Z.parents.length)if((0,p.Z)(g.matrix))Z.matrix=A.Z.fromColumnMajorArray(g.matrix);else{var v=g.rotation;Z.translation=a.Z.fromArray(g.translation),Z.rotation=L.Z.unpack(v),Z.scale=a.Z.fromArray(g.scale)}(0,p.Z)(_)?(_.children.push(Z),Z.parents.push(_)):n.push(Z),(0,p.Z)(g.mesh)&&Ot(e,g,Z,t,r);var x=g.children;if((0,p.Z)(x))for(var y=x.length,S=0;S<y;S++){var R=x[S];h[R]||d.push({parentRuntimeNode:Z,gltfNode:u[R],id:x[S]})}}e._runtime.rootNodes=n,e._runtime.nodes=o}}(e,r,i)}function Ut(e,t){var r=e.publicNode,i=r.matrix;r.useMatrix&&(0,p.Z)(i)?A.Z.clone(i,t):(0,p.Z)(e.matrix)?A.Z.clone(e.matrix,t):(A.Z.fromTranslationQuaternionRotationScale(e.translation,e.rotation,e.scale,t),r.setMatrix(t))}var qt=[],zt=new o.Z,Vt=new A.Z;var kt=new A.Z;function Ht(e,t){var r=F.Z.shallowClone(t);return r.pass=U.Z.TRANSLUCENT,r.renderState=function(e,t){var r=(0,c.Z)(t,!0);return r.cull.enabled=!1,r.depthTest.enabled=!0,r.depthMask=!1,r.blending=ne.Z.ALPHA_BLEND,e.opaquePass===U.Z.CESIUM_3D_TILE&&(r.stencilTest=be.Z.setCesium3DTileBit(),r.stencilMask=be.Z.CESIUM_3D_TILE_MASK),q.Z.fromCache(r)}(e,t.renderState),r}function Gt(e,t,r){var i=t.scene3DOnly,n=e.color.alpha;if(n>0&&n<1){var a=e._nodeCommands,o=a.length;if(o>0&&(!(0,p.Z)(a[0].translucentCommand)||r))for(var s=0;s<o;++s){var u=a[s],c=u.command;if(u.translucentCommand=Ht(e,c),!i){var l=u.command2D;u.translucentCommand2D=Ht(e,l)}}}}function Wt(e){var t,r,i=F.Z.shallowClone(e);return i.renderState=(t=e.renderState,(r=(0,c.Z)(t,!0)).cull.enabled=!1,q.Z.fromCache(r)),i}function Kt(e,t,r){var i=t.scene3DOnly;if(!e.backFaceCulling){var n=e._nodeCommands,a=n.length;if(a>0&&(!(0,p.Z)(n[0].disableCullingCommand)||r))for(var o=0;o<a;++o){var s=n[o],u=s.command;if(s.disableCullingCommand=Wt(u),!i){var c=s.command2D;s.disableCullingCommand2D=Wt(c)}}}}function jt(e,t){var r=e._rendererResources.programs;for(var i in r)if(r.hasOwnProperty(i)&&r[i]===t)return i}function Yt(e,t,r){var i=t.vertexShaderSource.sources[0],n=t._attributeLocations,a=e._normalAttributeName;i=k.Z.replaceMain(i,"gltf_silhouette_main"),i+="uniform float gltf_silhouetteSize; \nvoid main() \n{ \n    gltf_silhouette_main(); \n    vec3 n = normalize(czm_normal3D * "+a+"); \n    n.x *= czm_projection[0][0]; \n    n.y *= czm_projection[1][1]; \n    vec4 clip = gl_Position; \n    clip.xy += n.xy * clip.w * gltf_silhouetteSize * czm_pixelRatio / czm_viewport.z; \n    gl_Position = clip; \n}";return V.Z.fromCache({context:r.context,vertexShaderSource:i,fragmentShaderSource:"uniform vec4 gltf_silhouetteColor; \nvoid main() \n{ \n    gl_FragColor = czm_gammaCorrect(gltf_silhouetteColor); \n}",attributeLocations:n})}function Jt(e,t){return Ne(t.context)&&e.silhouetteSize>0&&e.silhouetteColor.alpha>0&&(0,p.Z)(e._normalAttributeName)}function Xt(e){return e.color.alpha>0&&e.color.alpha<1}function Qt(e){return 0===e.color.alpha}function $t(e,t){return Math.floor(e)!==Math.floor(t)||Math.ceil(e)!==Math.ceil(t)}var er=0;function tr(e,t){for(var r=++er%255,i=function(e){for(var t=e._nodeCommands,r=t.length,i=0;i<r;++i)if(t[i].command.pass===U.Z.TRANSLUCENT)return!0;return!1}(e)||Xt(e)||e.silhouetteColor.alpha<1,n=e._rendererResources.silhouettePrograms,a=t.scene3DOnly,o=e._nodeCommands,s=o.length,u=0;u<s;++u){var l=o[u],h=l.command,m=Xt(e)?l.translucentCommand:h,f=F.Z.shallowClone(m),_=(0,c.Z)(m.renderState);_.stencilTest={enabled:!0,frontFunction:N.Z.ALWAYS,backFunction:N.Z.ALWAYS,reference:r,mask:-1,frontOperation:{fail:N.Z.KEEP,zFail:N.Z.KEEP,zPass:N.Z.REPLACE},backOperation:{fail:N.Z.KEEP,zFail:N.Z.KEEP,zPass:N.Z.REPLACE}},Qt(e)&&(_.colorMask={red:!1,green:!1,blue:!1,alpha:!1},_.depthMask=!1),_=q.Z.fromCache(_),f.renderState=_,l.silhouetteModelCommand=f;var g=F.Z.shallowClone(h);(_=(0,c.Z)(h.renderState,!0)).depthTest.enabled=!0,_.cull.enabled=!1,i&&(g.pass=U.Z.TRANSLUCENT,_.depthMask=!1,_.blending=ne.Z.ALPHA_BLEND),_.stencilTest={enabled:!0,frontFunction:N.Z.NOTEQUAL,backFunction:N.Z.NOTEQUAL,reference:r,mask:-1,frontOperation:{fail:N.Z.KEEP,zFail:N.Z.KEEP,zPass:N.Z.KEEP},backOperation:{fail:N.Z.KEEP,zFail:N.Z.KEEP,zPass:N.Z.KEEP}},_=q.Z.fromCache(_);var Z=h.shaderProgram,v=jt(e,Z),x=n[v];(0,p.Z)(x)||(x=Yt(e,Z,t),n[v]=x);var y=(0,d.Z)(h.uniformMap,{gltf_silhouetteColor:yt(e),gltf_silhouetteSize:St(e)});if(g.renderState=_,g.shaderProgram=x,g.uniformMap=y,g.castShadows=!1,g.receiveShadows=!1,l.silhouetteColorCommand=g,!a){var S=l.command2D,R=F.Z.shallowClone(f);R.boundingVolume=S.boundingVolume,R.modelMatrix=S.modelMatrix,l.silhouetteModelCommand2D=R;var C=F.Z.shallowClone(g);R.boundingVolume=S.boundingVolume,R.modelMatrix=S.modelMatrix,l.silhouetteColorCommand2D=C}}}function rr(e,t,r){if(Jt(e,t)){var i=e._nodeCommands,n=i.length>0&&($t(e.color.alpha,e._colorPreviousAlpha)||$t(e.silhouetteColor.alpha,e._silhouetteColorPreviousAlpha)||!(0,p.Z)(i[0].silhouetteModelCommand));e._colorPreviousAlpha=e.color.alpha,e._silhouetteColorPreviousAlpha=e.silhouetteColor.alpha,(n||r)&&tr(e,t)}}var ir=new i.Z;var nr=new a.Z,ar=new s.Z;function or(e,t){var r=e.scale;if(0!==e.minimumPixelSize){var i=t.context,n=Math.max(i.drawingBufferWidth,i.drawingBufferHeight),o=(0,p.Z)(e._clampedModelMatrix)?e._clampedModelMatrix:e.modelMatrix;if(nr.x=o[12],nr.y=o[13],nr.z=o[14],(0,p.Z)(e._rtcCenter)&&a.Z.add(e._rtcCenter,nr,nr),e._mode!==Ce.Z.SCENE3D){var s=t.mapProjection,u=s.ellipsoid.cartesianToCartographic(nr,ar);s.project(u,nr),a.Z.fromElements(nr.z,nr.x,nr.y,nr)}var c=e.boundingSphere.radius,l=function(e,t,r){return ir.center=e,ir.radius=t,r.camera.getPixelSize(ir,r.context.drawingBufferWidth,r.context.drawingBufferHeight)}(nr,c,t),d=1/l;Math.min(d*(2*c),n)<e.minimumPixelSize&&(r=e.minimumPixelSize*l/(2*e._initialRadius))}return(0,p.Z)(e.maximumScale)?Math.min(e.maximumScale,r):r}function sr(e){(0,p.Z)(e._cacheKey)&&(0,p.Z)(e._cachedGltf)&&0==--e._cachedGltf.count&&delete Le[e._cacheKey],e._cachedGltf=void 0}function ur(e,t){this.buffers=void 0,this.vertexArrays=void 0,this.programs=void 0,this.sourceShaders=void 0,this.silhouettePrograms=void 0,this.textures=void 0,this.samplers=void 0,this.renderStates=void 0,this.ready=!1,this.context=e,this.cacheKey=t,this.count=0}function cr(e){for(var t in e)e.hasOwnProperty(t)&&e[t].destroy()}function lr(e,t,r){return function(i){if(e.heightReference===de.Z.RELATIVE_TO_GROUND){var n=t.cartesianToCartographic(i,ar);n.height+=r.height,t.cartographicToCartesian(n,i)}var a=e._clampedModelMatrix;A.Z.clone(e.modelMatrix,a),a[12]=i.x,a[13]=i.y,a[14]=i.z,e._heightChanged=!0}}ur.prototype.release=function(){if(0==--this.count)return(0,p.Z)(this.cacheKey)&&delete this.context.cache.modelRendererResourceCache[this.cacheKey],cr((e=this).buffers),cr(e.vertexArrays),cr(e.programs),cr(e.silhouettePrograms),cr(e.textures),(0,_.Z)(this);var e};var dr=new a.Z,hr=new s.Z;var mr=new A.Z,fr=new A.Z,pr=new w.Z;function _r(e,t){e.programs!==t.programs&&cr(e.programs),e.silhouettePrograms!==t.silhouettePrograms&&cr(e.silhouettePrograms)}Be.prototype.update=function(e){if(e.mode!==Ce.Z.MORPHING)if(v.Z.supportsWebP.initialized){var t=e.context;this._defaultTexture=t.defaultTexture;var r=v.Z.supportsWebP();if(this._state===we.NEEDS_LOAD&&(0,p.Z)(this.gltf)){var n,u=this.cacheKey;if((0,p.Z)(u)){t.cache.modelRendererResourceCache=(0,f.Z)(t.cache.modelRendererResourceCache,{});var l=t.cache.modelRendererResourceCache;if(n=l[this.cacheKey],(0,p.Z)(n)){if(!n.ready)return;++n.count,this._loadRendererResourcesFromCache=!0}else(n=new ur(t,u)).count=1,l[this.cacheKey]=n;this._cachedRendererResources=n}else(n=new ur(t)).count=1,this._cachedRendererResources=n;if(this._state=we.LOADING,this._state!==we.FAILED){var d=this.gltf.extensions;if((0,p.Z)(d)&&(0,p.Z)(d.CESIUM_RTC)){var h=a.Z.fromArray(d.CESIUM_RTC.center);if(!a.Z.equals(h,a.Z.ZERO)){this._rtcCenter3D=h;var m=e.mapProjection,_=m.ellipsoid.cartesianToCartographic(this._rtcCenter3D),Z=m.project(_);a.Z.fromElements(Z.z,Z.x,Z.y,Z),this._rtcCenter2D=Z,this._rtcCenterEye=new a.Z,this._rtcCenter=this._rtcCenter3D}}(0,Y.Z)(this.gltf),this._loadResources=new pe.Z,this._loadRendererResourcesFromCache||xe.Z.parseBuffers(this,ke)}}var x=this._loadResources,y=this._incrementallyLoadTextures,S=!1;if(this._state===we.LOADING){if(0===x.pendingBufferLoads){if(!x.initialized){if(e.brdfLutGenerator.update(e),xe.Z.checkSupportedExtensions(this.extensionsRequired,r),xe.Z.updateForwardAxis(this),!(0,p.Z)(this.gltf.extras.sourceVersion)){var C=this.gltf;C.extras.sourceVersion=xe.Z.getAssetVersion(C),C.extras.sourceKHRTechniquesWebGL=(0,p.Z)(xe.Z.getUsedExtensions(C).KHR_techniques_webgl),this._sourceVersion=C.extras.sourceVersion,this._sourceKHRTechniquesWebGL=C.extras.sourceKHRTechniquesWebGL,(0,te.Z)(C),(0,j.Z)(C);var M={addBatchIdToGeneratedShaders:this._addBatchIdToGeneratedShaders};(0,Se.Z)(C,M),(0,Re.Z)(C,M)}this._sourceVersion=this.gltf.extras.sourceVersion,this._sourceKHRTechniquesWebGL=this.gltf.extras.sourceKHRTechniquesWebGL,this._dequantizeInShader=this._dequantizeInShader&&ue.Z.hasExtension(this),function(e){var t=e.gltf,r=e._loadResources;J.Z.buffer(t,(function(e,t){r.buffers[t]=e.extras._pipeline.source}))}(this),function(e){var t={},r={},i={};e._runtime.articulationsByName=t,e._runtime.articulationsByStageKey=r,e._runtime.stagesByKey=i;var n=e.gltf;if((0,Q.Z)(n,"AGI_articulations")&&(0,p.Z)(n.extensions)&&(0,p.Z)(n.extensions.AGI_articulations)){var a=n.extensions.AGI_articulations.articulations;if((0,p.Z)(a))for(var o=a.length,s=0;s<o;++s){var u=(0,c.Z)(a[s]);u.nodes=[],u.isDirty=!0,t[u.name]=u;for(var l=u.stages.length,d=0;d<l;++d){var h=u.stages[d];h.currentValue=h.initialValue;var m=u.name+" "+h.name;r[m]=u,i[m]=h}}}}(this),function(e){var t=e.gltf;if((0,Q.Z)(t,"KHR_techniques_webgl")){var r=e._sourcePrograms,i=e._sourceTechniques,n=t.extensions.KHR_techniques_webgl.programs;J.Z.technique(t,(function(e,t){i[t]=(0,c.Z)(e);var a=e.program;(0,p.Z)(r[a])||(r[a]=(0,c.Z)(n[a]))}))}}(this),this._loadRendererResourcesFromCache||(function(e){var t=e.gltf.bufferViews,r=e._loadResources.vertexBuffersToCreate;J.Z.bufferView(e.gltf,(function(e,t){e.target===N.Z.ARRAY_BUFFER&&r.enqueue(t)}));var i=e._loadResources.indexBuffersToCreate,n={};J.Z.accessor(e.gltf,(function(e){var r=e.bufferView;(0,p.Z)(r)&&(t[r].target!==N.Z.ELEMENT_ARRAY_BUFFER||(0,p.Z)(n[r])||(n[r]=!0,i.enqueue({id:r,componentType:e.componentType})))}))}(this),function(e){var t=e.gltf,r=t.buffers,i=t.bufferViews,n=e._rendererResources.sourceShaders;J.Z.shader(t,(function(t,a){if((0,p.Z)(t.bufferView)){var o=t.bufferView,s=i[o],u=s.buffer,c=r[u],l=(0,R.Z)(c.extras._pipeline.source,s.byteOffset,s.byteLength);n[a]=l}else if((0,p.Z)(t.extras._pipeline.source))n[a]=t.extras._pipeline.source;else{++e._loadResources.pendingShaderLoads;var d=e._resource.getDerivedResource({url:t.uri});d.fetchText().then(function(e,t,r){return function(i){var n=e._loadResources;n.shaders[r]={source:i,type:t,bufferView:void 0},--n.pendingShaderLoads,e._rendererResources.sourceShaders[r]=i}}(e,t.type,a)).otherwise(xe.Z.getFailedLoadFunction(e,"shader",d.url))}}))}(this),function(e){var t=e._sourceTechniques;for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];e._loadResources.programsToCreate.enqueue({programId:i.program,techniqueId:r})}}(this),function(e,t,r){var i,n=e.gltf,a=n.images;J.Z.texture(n,(function(n,o){var s=n.source;(0,p.Z)(n.extensions)&&(0,p.Z)(n.extensions.EXT_texture_webp)&&r?s=n.extensions.EXT_texture_webp.source:(0,p.Z)(n.extensions)&&(0,p.Z)(n.extensions.KHR_texture_basisu)&&t.supportsBasis&&(s=n.extensions.KHR_texture_basisu.source);var u=a[s],c=u.bufferView,l=u.mimeType;if(i=u.uri,(0,p.Z)(c))e._loadResources.texturesToCreateFromBufferView.enqueue({id:o,image:void 0,bufferView:c,mimeType:l});else{++e._loadResources.pendingTextureLoads;var d=e._resource.getDerivedResource({url:i});(Ge.test(i)?(0,b.Z)(d):d.fetchImage({skipColorSpaceConversion:!0,preferImageBitmap:!0})).then(He(e,o)).otherwise(xe.Z.getFailedLoadFunction(e,"image",d.url))}}))}(this,t,r)),function(e){var t=e.gltf,r=e._sourceTechniques,i={},n={},a=e._uniformMaps;J.Z.material(t,(function(t,o){a[o]={uniformMap:void 0,values:void 0,jointMatrixUniformName:void 0,morphWeightsUniformName:void 0};var s=new _e.Z(e,t,o);if((0,p.Z)(t.extensions)&&(0,p.Z)(t.extensions.KHR_techniques_webgl)){var u=t.extensions.KHR_techniques_webgl.technique;s._technique=u,s._program=r[u].program,J.Z.materialValue(t,(function(e,t){(0,p.Z)(s._values)||(s._values={}),s._values[t]=(0,c.Z)(e)}))}i[t.name]=s,n[o]=s})),e._runtime.materialsByName=i,e._runtime.materialsById=n}(this),function(e){var t={},r=e._runtime.materialsById;J.Z.mesh(e.gltf,(function(i,n){t[i.name]=new ge.Z(i,r,n),((0,p.Z)(e.extensionsUsed.WEB3D_quantized_attributes)||e._dequantizeInShader)&&J.Z.meshPrimitive(i,(function(t,r){var i=$e(e,t),a=e._programPrimitives[i];(0,p.Z)(a)||(a={},e._programPrimitives[i]=a),a[n+".primitive."+r]=t}))})),e._runtime.meshesByName=t}(this),function(e){var t={},r={},i=[],n=e._loadResources.skinnedNodesIds,a=e._runtime.articulationsByName;J.Z.node(e.gltf,(function(o,s){var u={matrix:void 0,translation:void 0,rotation:void 0,scale:void 0,computedShow:!0,transformToRoot:new A.Z,computedMatrix:new A.Z,dirtyNumber:0,commands:[],inverseBindMatrices:void 0,bindShapeMatrix:void 0,joints:[],computedJointMatrices:[],jointName:o.jointName,weights:[],children:[],parents:[],publicNode:void 0};if(u.publicNode=new Ze.Z(e,o,u,s,xe.Z.getTransform(o)),t[s]=u,r[o.name]=u,(0,p.Z)(o.skin)&&(n.push(s),i.push(u)),(0,p.Z)(o.extensions)&&(0,p.Z)(o.extensions.AGI_articulations)){var c=o.extensions.AGI_articulations.articulationName;if((0,p.Z)(c)){var l=A.Z.clone(u.publicNode.originalMatrix,We),d=a[c];d.nodes.push(u.publicNode);for(var h=d.stages.length,m=0;m<h;++m)l=ze(d.stages[m],l);u.publicNode.matrix=l}}})),e._runtime.nodes=t,e._runtime.nodesByName=r,e._runtime.skinnedNodes=i}(this),ue.Z.parse(this,t),x.initialized=!0}x.finishedDecoding()||ue.Z.decodeModel(this,t).otherwise(xe.Z.getFailedLoadFunction(this,"model",this.basePath)),x.finishedDecoding()&&!x.resourcesParsed&&(this._boundingSphere=xe.Z.computeBoundingSphere(this),this._initialRadius=this._boundingSphere.radius,ue.Z.cacheDataForModel(this),x.resourcesParsed=!0),x.resourcesParsed&&0===x.pendingShaderLoads&&(this.showOutline&&ve.Z.outlinePrimitives(this),Ft(this,e))}(x.finished()||y&&x.finishedEverythingButTextureCreation())&&(this._state=we.LOADED,S=!0)}if((0,p.Z)(x)&&this._state===we.LOADED&&(y&&!S&&Ft(this,e),x.finished())){this._loadResources=void 0;var T=this._rendererResources,L=this._cachedRendererResources;L.buffers=T.buffers,L.vertexArrays=T.vertexArrays,L.programs=T.programs,L.sourceShaders=T.sourceShaders,L.silhouettePrograms=T.silhouettePrograms,L.textures=T.textures,L.samplers=T.samplers,L.renderStates=T.renderStates,L.ready=!0,this._normalAttributeName=xe.Z.getAttributeOrUniformBySemantic(this.gltf,"NORMAL"),(0,p.Z)(this._precreatedAttributes)&&(L.vertexArrays={}),this.releaseGltfJson&&sr(this)}var I=ye.Z.isSupported(t);if(this._shouldUpdateSpecularMapAtlas&&I){if(this._shouldUpdateSpecularMapAtlas=!1,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),this._specularEnvironmentMapAtlas=void 0,(0,p.Z)(this._specularEnvironmentMaps)){this._specularEnvironmentMapAtlas=new ye.Z(this._specularEnvironmentMaps);var D=this;this._specularEnvironmentMapAtlas.readyPromise.then((function(){D._shouldRegenerateShaders=!0})).otherwise((function(e){console.error("Error loading specularEnvironmentMaps: "+e)}))}this._shouldRegenerateShaders=!0}(0,p.Z)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.update(e);var O=!(0,p.Z)(this._specularEnvironmentMapAtlas)&&(0,p.Z)(e.specularEnvironmentMaps)&&!this._useDefaultSpecularMaps,F=!(0,p.Z)(e.specularEnvironmentMaps)&&this._useDefaultSpecularMaps,U=!(0,p.Z)(this._sphericalHarmonicCoefficients)&&(0,p.Z)(e.sphericalHarmonicCoefficients)&&!this._useDefaultSphericalHarmonics,q=!(0,p.Z)(e.sphericalHarmonicCoefficients)&&this._useDefaultSphericalHarmonics;this._shouldRegenerateShaders=this._shouldRegenerateShaders||O||F||U||q,this._useDefaultSpecularMaps=!(0,p.Z)(this._specularEnvironmentMapAtlas)&&(0,p.Z)(e.specularEnvironmentMaps),this._useDefaultSphericalHarmonics=!(0,p.Z)(this._sphericalHarmonicCoefficients)&&(0,p.Z)(e.sphericalHarmonicCoefficients);var z=Jt(this,e),V=Xt(this),k=Qt(this),H=this.backFaceCulling,G=!(0,p.Z)(this.distanceDisplayCondition)||function(e,t){var r,i=e.distanceDisplayCondition,n=i.near*i.near,o=i.far*i.far;if(t.mode===Ce.Z.SCENE2D)r=.5*(t.camera.frustum.right-t.camera.frustum.left),r*=r;else{var s=A.Z.getTranslation(e.modelMatrix,dr);if(t.mode===Ce.Z.COLUMBUS_VIEW){var u=t.mapProjection,c=u.ellipsoid.cartesianToCartographic(s,hr);s=u.project(c,s),a.Z.fromElements(s.z,s.x,s.y,s)}r=a.Z.distanceSquared(s,t.camera.positionWC)}return r>=n&&r<=o}(this,e),W=this.show&&G&&0!==this.scale&&(!k||z);if(W&&this._state===we.LOADED||S){var K=this.activeAnimations.update(e)||this._cesiumAnimationsDirty;this._cesiumAnimationsDirty=!1,this._dirty=!1;var X=this.modelMatrix,$=e.mode!==this._mode;this._mode=e.mode;var ee=!A.Z.equals(this._modelMatrix,X)||this._scale!==this.scale||this._minimumPixelSize!==this.minimumPixelSize||0!==this.minimumPixelSize||this._maximumScale!==this.maximumScale||this._heightReference!==this.heightReference||this._heightChanged||$;if(ee||S){A.Z.clone(X,this._modelMatrix),function(e){(0,p.Z)(e._removeUpdateHeightCallback)&&(e._removeUpdateHeightCallback(),e._removeUpdateHeightCallback=void 0);var t=e._scene;if((0,p.Z)(t)&&(0,p.Z)(t.globe)&&e.heightReference!==de.Z.NONE){var r=t.globe,i=r.ellipsoid,n=e.modelMatrix;nr.x=n[12],nr.y=n[13],nr.z=n[14];var a=i.cartesianToCartographic(nr);(0,p.Z)(e._clampedModelMatrix)||(e._clampedModelMatrix=A.Z.clone(n,new A.Z));var o=r._surface;e._removeUpdateHeightCallback=o.updateHeight(a,lr(e,i,a));var u=r.getHeight(a);if((0,p.Z)(u)){var c=lr(e,i,a);s.Z.clone(a,ar),ar.height=u,i.cartographicToCartesian(ar,nr),c(nr)}}else{if(e.heightReference!==de.Z.NONE)throw new g.Z("Height reference is not supported without a scene and globe.");e._clampedModelMatrix=void 0}}(this),(0,p.Z)(this._clampedModelMatrix)&&(X=this._clampedModelMatrix),this._scale=this.scale,this._minimumPixelSize=this.minimumPixelSize,this._maximumScale=this.maximumScale,this._heightReference=this.heightReference,this._heightChanged=!1;var re=or(this,e),ne=this._computedModelMatrix;A.Z.multiplyByUniformScale(X,re,ne),this._upAxis===ie.Z.Y?A.Z.multiplyTransformation(ne,ie.Z.Y_UP_TO_Z_UP,ne):this._upAxis===ie.Z.X&&A.Z.multiplyTransformation(ne,ie.Z.X_UP_TO_Z_UP,ne),this.forwardAxis===ie.Z.Z&&A.Z.multiplyTransformation(ne,ie.Z.Z_UP_TO_X_UP,ne)}(K||ee||S)&&(function(e,t,r,n){var s=e._maxDirtyNumber,u=e._runtime.rootNodes,c=u.length,l=qt,d=e._computedModelMatrix;if(e._mode!==Ce.Z.SCENE3D&&!e._ignoreCommands){var h=A.Z.getColumn(d,3,zt);if(o.Z.equals(h,o.Z.UNIT_W)){var m=e.boundingSphere.center,f=B.Z.wgs84To2DModelMatrix(n,m,Vt);d=A.Z.multiply(f,d,Vt),(0,p.Z)(e._rtcCenter)&&(A.Z.setTranslation(d,o.Z.UNIT_W,d),e._rtcCenter=e._rtcCenter2D)}else d=B.Z.basisTo2D(n,d,Vt),e._rtcCenter=e._rtcCenter3D}for(var _=0;_<c;++_){var g=u[_];for(Ut(g,g.transformToRoot),l.push(g);l.length>0;){var Z=(g=l.pop()).transformToRoot,v=g.commands;if(g.dirtyNumber===s||t||r){var x=A.Z.multiplyTransformation(d,Z,g.computedMatrix),y=v.length;if(y>0)for(var S=0;S<y;++S){var R=v[S],C=R.command;A.Z.clone(x,C.modelMatrix),i.Z.transform(R.boundingSphere,C.modelMatrix,C.boundingVolume),(0,p.Z)(e._rtcCenter)&&a.Z.add(e._rtcCenter,C.boundingVolume.center,C.boundingVolume.center),C=R.command2D,(0,p.Z)(C)&&e._mode===Ce.Z.SCENE2D&&(A.Z.clone(x,C.modelMatrix),C.modelMatrix[13]-=2*E.Z.sign(C.modelMatrix[13])*E.Z.PI*n.ellipsoid.maximumRadius,i.Z.transform(R.boundingSphere,C.modelMatrix,C.boundingVolume))}}var M=g.children;if((0,p.Z)(M))for(var b=M.length,w=0;w<b;++w){var T=M[w];T.dirtyNumber=Math.max(T.dirtyNumber,g.dirtyNumber),(T.dirtyNumber===s||r)&&(Ut(T,T.transformToRoot),A.Z.multiplyTransformation(Z,T.transformToRoot,T.transformToRoot)),l.push(T)}}}++e._maxDirtyNumber}(this,ee,S,e.mapProjection),this._dirty=!0,(K||S)&&function(e){for(var t=e._runtime.skinnedNodes,r=t.length,i=0;i<r;++i){var n=t[i];kt=A.Z.inverseTransformation(n.transformToRoot,kt);for(var a=n.computedJointMatrices,o=n.joints,s=n.bindShapeMatrix,u=n.inverseBindMatrices,c=u.length,l=0;l<c;++l)(0,p.Z)(a[l])||(a[l]=new A.Z),a[l]=A.Z.multiplyTransformation(kt,o[l].transformToRoot,a[l]),a[l]=A.Z.multiplyTransformation(a[l],u[l],a[l]),(0,p.Z)(s)&&(a[l]=A.Z.multiplyTransformation(a[l],s,a[l]))}}(this)),this._perNodeShowDirty&&(this._perNodeShowDirty=!1,function(e){for(var t=e._runtime.rootNodes,r=t.length,i=qt,n=0;n<r;++n){var a=t[n];for(a.computedShow=a.publicNode.show,i.push(a);i.length>0;){for(var o=(a=i.pop()).computedShow,s=a.commands,u=s.length,c=0;c<u;++c)s[c].show=o;var l=a.children;if((0,p.Z)(l))for(var d=l.length,h=0;h<d;++h){var m=l[h];m.computedShow=o&&m.publicNode.show,i.push(m)}}}}(this)),function(e,t){var r=e.id;if(e._id!==r){e._id=r;for(var i=e._pickIds,n=i.length,a=0;a<n;++a)i[a].object.id=r}}(this),function(e){if(e._debugWireframe!==e.debugWireframe){e._debugWireframe=e.debugWireframe;for(var t=e.debugWireframe?P.Z.LINES:P.Z.TRIANGLES,r=e._nodeCommands,i=r.length,n=0;n<i;++n)r[n].command.primitiveType=t}}(this),function(e){if(e.debugShowBoundingVolume!==e._debugShowBoundingVolume){e._debugShowBoundingVolume=e.debugShowBoundingVolume;for(var t=e.debugShowBoundingVolume,r=e._nodeCommands,i=r.length,n=0;n<i;++n)r[n].command.debugShowBoundingVolume=t}}(this),function(e){if(e.shadows!==e._shadows){e._shadows=e.shadows;for(var t=Me.Z.castShadows(e.shadows),r=Me.Z.receiveShadows(e.shadows),i=e._nodeCommands,n=i.length,a=0;a<n;a++){var o=i[a];o.command.castShadows=t,o.command.receiveShadows=r}}}(this),function(e,t){var r=e._clippingPlanes;(0,p.Z)(r)&&r.owner===e&&r.enabled&&r.update(t)}(this,e);var ae=this._clippingPlanes,oe=0,se=(0,f.Z)(this.referenceMatrix,X);if(Oe(this)){var ce=mr;ce=A.Z.multiply(t.uniformState.view3D,se,ce),ce=A.Z.multiply(ce,ae.modelMatrix,ce),this._clippingPlanesMatrix=A.Z.inverseTranspose(ce,this._clippingPlanesMatrix),oe=ae.clippingPlanesState}var le=(0,p.Z)(this._sphericalHarmonicCoefficients)||this._useDefaultSphericalHarmonics,he=(0,p.Z)(this._specularEnvironmentMapAtlas)&&this._specularEnvironmentMapAtlas.ready||this._useDefaultSpecularMaps;if(le||he){var me=pr,fe=fr;fe=A.Z.multiply(t.uniformState.view3D,se,fe),me=A.Z.getMatrix3(fe,me),me=w.Z.getRotation(me,me),this._iblReferenceFrameMatrix=w.Z.transpose(me,this._iblReferenceFrameMatrix)}var be=this._shouldRegenerateShaders;be=be||this._clippingPlanesState!==oe,this._clippingPlanesState=oe;var Ee=De(this);Ee!==this._colorShadingEnabled&&(this._colorShadingEnabled=Ee,be=!0),be?function(e,t){var r,i=e._rendererResources,n=e._cachedRendererResources;if(_r(i,n),Oe(e)||De(e)||e._shouldRegenerateShaders){e._shouldRegenerateShaders=!1,i.programs={},i.silhouettePrograms={};var a={},o=e._sourceTechniques;for(var s in o)o.hasOwnProperty(s)&&(a[r=o[s].program]||(a[r]=!0,nt({programId:r,techniqueId:s},e,t.context)))}else i.programs=n.programs,i.silhouettePrograms=n.silhouettePrograms;for(var u=i.programs,c=e._nodeCommands,l=c.length,d=0;d<l;++d){var h=c[d],m=u[r=h.programId];h.command.shaderProgram=m,(0,p.Z)(h.command2D)&&(h.command2D.shaderProgram=m)}Gt(e,t,!0),Kt(e,t,!0),rr(e,t,!0)}(this,e):(Gt(this,e,!1),Kt(this,e,!1),rr(this,e,!1))}if(S){var Ae=this;e.afterRender.push((function(){Ae._ready=!0,Ae._readyPromise.resolve(Ae)}))}else{if(W&&!this._ignoreCommands){var Te,Pe,Le,Ie=e.commandList,Be=e.passes,Ne=this._nodeCommands,Fe=Ne.length,Ue=e.mapProjection.ellipsoid.maximumRadius*E.Z.PI;if(Be.render||Be.pick&&this.allowPicking){for(Te=0;Te<Fe;++Te)if((Pe=Ne[Te]).show){var qe=Pe.command;if(z?qe=Pe.silhouetteModelCommand:V?qe=Pe.translucentCommand:H||(qe=Pe.disableCullingCommand),Ie.push(qe),Le=Pe.command.boundingVolume,e.mode===Ce.Z.SCENE2D&&(Le.center.y+Le.radius>Ue||Le.center.y-Le.radius<Ue)){var Ve=Pe.command2D;z?Ve=Pe.silhouetteModelCommand2D:V?Ve=Pe.translucentCommand2D:H||(Ve=Pe.disableCullingCommand2D),Ie.push(Ve)}}if(z&&!Be.pick)for(Te=0;Te<Fe;++Te)(Pe=Ne[Te]).show&&(Ie.push(Pe.silhouetteColorCommand),Le=Pe.command.boundingVolume,e.mode===Ce.Z.SCENE2D&&(Le.center.y+Le.radius>Ue||Le.center.y-Le.radius<Ue)&&Ie.push(Pe.silhouetteColorCommand2D))}}var Ke=this._credit;(0,p.Z)(Ke)&&e.creditDisplay.addCredit(Ke);for(var je=this._resourceCredits,Ye=je.length,Je=0;Je<Ye;Je++)e.creditDisplay.addCredit(je[Je])}}else v.Z.supportsWebP.initialize()},Be.prototype.isDestroyed=function(){return!1},Be.prototype.destroy=function(){(0,p.Z)(this._precreatedAttributes)&&cr(this._rendererResources.vertexArrays),(0,p.Z)(this._removeUpdateHeightCallback)&&(this._removeUpdateHeightCallback(),this._removeUpdateHeightCallback=void 0),(0,p.Z)(this._terrainProviderChangedCallback)&&(this._terrainProviderChangedCallback(),this._terrainProviderChangedCallback=void 0),(0,p.Z)(this._cachedRendererResources)&&_r(this._rendererResources,this._cachedRendererResources),this._rendererResources=void 0,this._cachedRendererResources=this._cachedRendererResources&&this._cachedRendererResources.release(),ue.Z.destroyCachedDataForModel(this);for(var e=this._pickIds,t=e.length,r=0;r<t;++r)e[r].destroy();sr(this),this._quantizedVertexShaders=void 0;var i=this._clippingPlanes;return(0,p.Z)(i)&&!i.isDestroyed()&&i.owner===this&&i.destroy(),this._clippingPlanes=void 0,this._specularEnvironmentMapAtlas=this._specularEnvironmentMapAtlas&&this._specularEnvironmentMapAtlas.destroy(),(0,_.Z)(this)},Be._getClippingFunction=le.Z,Be._modifyShaderForColor=function(e){return e=k.Z.replaceMain(e,"gltf_blend_main"),e+="uniform vec4 gltf_color; \nuniform float gltf_colorBlend; \nvoid main() \n{ \n    gltf_blend_main(); \n    gl_FragColor.rgb = mix(gl_FragColor.rgb, gltf_color.rgb, gltf_colorBlend); \n    float highlight = ceil(gltf_colorBlend); \n    gl_FragColor.rgb *= mix(gltf_color.rgb, vec3(1.0), highlight); \n    gl_FragColor.a *= gltf_color.a; \n} \n"},t.Z=Be}}]);
//# sourceMappingURL=2f7959bf-80cbc966ff252fee6c62.js.map